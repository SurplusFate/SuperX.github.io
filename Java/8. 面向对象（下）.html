<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.51" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://SurplusFate.github.io/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html"><meta property="og:site_name" content="空~"><meta property="og:title" content="8. 面向对象（下）"><meta property="og:type" content="article"><meta property="og:updated_time" content="2022-09-25T11:50:22.000Z"><meta property="og:locale" content="zh-CN"><meta property="article:published_time" content="2022-07-12T00:00:00.000Z"><meta property="article:modified_time" content="2022-09-25T11:50:22.000Z"><link rel="icon" href="/logo.png"><title>8. 面向对象（下） | 空~</title><meta name="description" content="学习记录">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background-color: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="stylesheet" href="/assets/style.d49e8f0d.css">
    <link rel="modulepreload" href="/assets/app.8334b441.js"><link rel="modulepreload" href="/assets/8. 面向对象（下）.html.4a37dafc.js"><link rel="modulepreload" href="/assets/_plugin-vue_export-helper.cdc0426e.js"><link rel="modulepreload" href="/assets/8. 面向对象（下）.html.66e50ea7.js"><link rel="prefetch" href="/assets/index.html.b761b5d6.js"><link rel="prefetch" href="/assets/1. Java语言概述与开发环境.html.9924e05f.js"><link rel="prefetch" href="/assets/10. 数组的常见算法.html.7ed3f727.js"><link rel="prefetch" href="/assets/11. 与运行环境交互.html.a34bc285.js"><link rel="prefetch" href="/assets/12. Java集合.html.a73fc571.js"><link rel="prefetch" href="/assets/13. 泛型.html.e158f009.js"><link rel="prefetch" href="/assets/14. 函数式编程.html.e15b6320.js"><link rel="prefetch" href="/assets/15. 异常处理.html.8d12fc13.js"><link rel="prefetch" href="/assets/16. 注解.html.ea75b50e.js"><link rel="prefetch" href="/assets/17. IO流.html.15269f4c.js"><link rel="prefetch" href="/assets/18. 多线程.html.30000920.js"><link rel="prefetch" href="/assets/19. 类加载机制与反射.html.efad3edf.js"><link rel="prefetch" href="/assets/2. 第一个java程序.html.f311bf8a.js"><link rel="prefetch" href="/assets/3. Java程序的基本规则.html.be3ea4f9.js"><link rel="prefetch" href="/assets/4. 数据类型.html.0ae7f9dc.js"><link rel="prefetch" href="/assets/5. 运算符.html.8adbd3dd.js"><link rel="prefetch" href="/assets/6. 流程控制.html.00bb84a8.js"><link rel="prefetch" href="/assets/7. 面向对象（上）.html.4018d400.js"><link rel="prefetch" href="/assets/9. 数组.html.90dd411a.js"><link rel="prefetch" href="/assets/1. 创建与管理数据库.html.31ff32d7.js"><link rel="prefetch" href="/assets/2. 创建与管理数据表.html.1ea0c176.js"><link rel="prefetch" href="/assets/3. 约束管理.html.0f62251b.js"><link rel="prefetch" href="/assets/4. 数据表的基本操作.html.b66f2f7c.js"><link rel="prefetch" href="/assets/5. 视图.html.38dd7a08.js"><link rel="prefetch" href="/assets/6. 索引.html.68c71fd5.js"><link rel="prefetch" href="/assets/7. 事务.html.46a7ab27.js"><link rel="prefetch" href="/assets/1. SpringBoot.html.73502707.js"><link rel="prefetch" href="/assets/2. JavaConfig.html.bc4e62e3.js"><link rel="prefetch" href="/assets/3. Web组件.html.c1f4b114.js"><link rel="prefetch" href="/assets/4. ORM 操作 MySQL.html.fe5b9b12.js"><link rel="prefetch" href="/assets/5. 接口架构风格 —RESTful.html.c23834cc.js"><link rel="prefetch" href="/assets/index.html.9092aa53.js"><link rel="prefetch" href="/assets/index.html.af5da71c.js"><link rel="prefetch" href="/assets/0. Maven.html.5b7ad003.js"><link rel="prefetch" href="/assets/1. HTML.html.6995de43.js"><link rel="prefetch" href="/assets/10. JavaBean.html.07059ce8.js"><link rel="prefetch" href="/assets/11. MVC 模式与三层架构的区别.html.1f27dbdf.js"><link rel="prefetch" href="/assets/12. Filter.html.22e6469d.js"><link rel="prefetch" href="/assets/13. 监听器.html.c0bbd199.js"><link rel="prefetch" href="/assets/14. 过滤器、监听器常见应用.html.98a50f0f.js"><link rel="prefetch" href="/assets/15. JDBC.html.3a967699.js"><link rel="prefetch" href="/assets/16. Ajax.html.316ba56c.js"><link rel="prefetch" href="/assets/2. CSS.html.09dcc021.js"><link rel="prefetch" href="/assets/3. JavaScript.html.2ad166b3.js"><link rel="prefetch" href="/assets/4. jQuery.html.864c71ca.js"><link rel="prefetch" href="/assets/5. xml 和 json.html.cb07d4e5.js"><link rel="prefetch" href="/assets/6. tomcat.html.5a0b2be3.js"><link rel="prefetch" href="/assets/7. Servlet.html.34687279.js"><link rel="prefetch" href="/assets/8. Cookie 和 Session.html.7e235e74.js"><link rel="prefetch" href="/assets/9. JSP.html.bf928df7.js"><link rel="prefetch" href="/assets/index.html.575395eb.js"><link rel="prefetch" href="/assets/1. 准备.html.383769f1.js"><link rel="prefetch" href="/assets/10. 注解.html.7398efc0.js"><link rel="prefetch" href="/assets/11. 复杂查询环境搭建.html.e52cb744.js"><link rel="prefetch" href="/assets/12. 动态 SQL.html.f1d6781e.js"><link rel="prefetch" href="/assets/2. 使用.html.235daf28.js"><link rel="prefetch" href="/assets/3. 主要类介绍.html.7e2d1316.js"><link rel="prefetch" href="/assets/4. 配置文件详解.html.beb2090d.js"><link rel="prefetch" href="/assets/5. CRUD.html.293c8136.js"><link rel="prefetch" href="/assets/6. 配置 environments.html.d8bf2316.js"><link rel="prefetch" href="/assets/7. ResultMap 结果集映射.html.df5da85c.js"><link rel="prefetch" href="/assets/8. 日志.html.e97fdfed.js"><link rel="prefetch" href="/assets/9. 分页.html.c863ad7d.js"><link rel="prefetch" href="/assets/index.html.597c475c.js"><link rel="prefetch" href="/assets/1. SSM项目练习总结.html.c0025e5e.js"><link rel="prefetch" href="/assets/2. 环境搭建.html.46d2f09e.js"><link rel="prefetch" href="/assets/3. 自动登录问题记录.html.87f8b7b9.js"><link rel="prefetch" href="/assets/4. xxmapping.html.5125218f.js"><link rel="prefetch" href="/assets/5. 处理器方法的返回值.html.7c46a561.js"><link rel="prefetch" href="/assets/6. 请求转发与请求重定向.html.0afd1555.js"><link rel="prefetch" href="/assets/1. IOC.html.9e24c597.js"><link rel="prefetch" href="/assets/10. 整合Mybatis.html.4350e23c.js"><link rel="prefetch" href="/assets/11. 事务.html.b71dccd0.js"><link rel="prefetch" href="/assets/12.  web项目中怎么使用容器对象.html.74fcfd9d.js"><link rel="prefetch" href="/assets/2. Spring创建对象.html.4ae39964.js"><link rel="prefetch" href="/assets/3. DI 依赖注入.html.f83748f3.js"><link rel="prefetch" href="/assets/4. Spring配置.html.591a8c2a.js"><link rel="prefetch" href="/assets/5. Bean自动装配.html.b9ff8579.js"><link rel="prefetch" href="/assets/6. 使用注解开发.html.1b075bf4.js"><link rel="prefetch" href="/assets/7. 使用java方式配置Spring.html.35e7af40.js"><link rel="prefetch" href="/assets/8. 代理模式.html.52716258.js"><link rel="prefetch" href="/assets/9. Spring AOP.html.87757298.js"><link rel="prefetch" href="/assets/1. 第一个SpringMVC程序.html.e99d70d9.js"><link rel="prefetch" href="/assets/10. 拦截器.html.4147e7f5.js"><link rel="prefetch" href="/assets/2. 配置视图解析器.html.0c963ca1.js"><link rel="prefetch" href="/assets/3. 控制请求方式.html.a78edd2e.js"><link rel="prefetch" href="/assets/4. 处理器方法的参数.html.25536106.js"><link rel="prefetch" href="/assets/5. 处理器方法的返回值.html.b85cb91c.js"><link rel="prefetch" href="/assets/6. url-pattern.html.3e9826fa.js"><link rel="prefetch" href="/assets/7. SSM整合.html.21169879.js"><link rel="prefetch" href="/assets/8. 请求重定向和转发.html.cb881c78.js"><link rel="prefetch" href="/assets/9. 异常处理.html.49af17a9.js"><link rel="prefetch" href="/assets/index.html.ac087aec.js"><link rel="prefetch" href="/assets/404.html.a240fd26.js"><link rel="prefetch" href="/assets/index.html.24758dfe.js"><link rel="prefetch" href="/assets/1. Java语言概述与开发环境.html.6a611468.js"><link rel="prefetch" href="/assets/10. 数组的常见算法.html.7ab8fd66.js"><link rel="prefetch" href="/assets/11. 与运行环境交互.html.de00bfad.js"><link rel="prefetch" href="/assets/12. Java集合.html.63fd0fe8.js"><link rel="prefetch" href="/assets/13. 泛型.html.8bd50bc4.js"><link rel="prefetch" href="/assets/14. 函数式编程.html.32101cc6.js"><link rel="prefetch" href="/assets/15. 异常处理.html.b41e5e2a.js"><link rel="prefetch" href="/assets/16. 注解.html.e6cd2c98.js"><link rel="prefetch" href="/assets/17. IO流.html.1daf5f5d.js"><link rel="prefetch" href="/assets/18. 多线程.html.752e52fd.js"><link rel="prefetch" href="/assets/19. 类加载机制与反射.html.73dbd87c.js"><link rel="prefetch" href="/assets/2. 第一个java程序.html.e846e77b.js"><link rel="prefetch" href="/assets/3. Java程序的基本规则.html.dfe03d1e.js"><link rel="prefetch" href="/assets/4. 数据类型.html.31d60825.js"><link rel="prefetch" href="/assets/5. 运算符.html.bc9b4ca3.js"><link rel="prefetch" href="/assets/6. 流程控制.html.bb8c4252.js"><link rel="prefetch" href="/assets/7. 面向对象（上）.html.d21ca28f.js"><link rel="prefetch" href="/assets/9. 数组.html.6bb5de98.js"><link rel="prefetch" href="/assets/1. 创建与管理数据库.html.329836d8.js"><link rel="prefetch" href="/assets/2. 创建与管理数据表.html.7436e8c4.js"><link rel="prefetch" href="/assets/3. 约束管理.html.f09931a4.js"><link rel="prefetch" href="/assets/4. 数据表的基本操作.html.0f725ad1.js"><link rel="prefetch" href="/assets/5. 视图.html.999867cc.js"><link rel="prefetch" href="/assets/6. 索引.html.76caf0e4.js"><link rel="prefetch" href="/assets/7. 事务.html.d8b963ba.js"><link rel="prefetch" href="/assets/1. SpringBoot.html.0546efa2.js"><link rel="prefetch" href="/assets/2. JavaConfig.html.58b5dd67.js"><link rel="prefetch" href="/assets/3. Web组件.html.40e35a2e.js"><link rel="prefetch" href="/assets/4. ORM 操作 MySQL.html.82b0a0ff.js"><link rel="prefetch" href="/assets/5. 接口架构风格 —RESTful.html.b2c5ce84.js"><link rel="prefetch" href="/assets/index.html.37ffdd0a.js"><link rel="prefetch" href="/assets/index.html.33d42682.js"><link rel="prefetch" href="/assets/0. Maven.html.7b38e6b6.js"><link rel="prefetch" href="/assets/1. HTML.html.daa149ac.js"><link rel="prefetch" href="/assets/10. JavaBean.html.dd581cef.js"><link rel="prefetch" href="/assets/11. MVC 模式与三层架构的区别.html.6a0859e6.js"><link rel="prefetch" href="/assets/12. Filter.html.d07c23d9.js"><link rel="prefetch" href="/assets/13. 监听器.html.a31bfbf4.js"><link rel="prefetch" href="/assets/14. 过滤器、监听器常见应用.html.b2113e87.js"><link rel="prefetch" href="/assets/15. JDBC.html.f8d2ccd4.js"><link rel="prefetch" href="/assets/16. Ajax.html.a9ebbec5.js"><link rel="prefetch" href="/assets/2. CSS.html.324dede5.js"><link rel="prefetch" href="/assets/3. JavaScript.html.606da09f.js"><link rel="prefetch" href="/assets/4. jQuery.html.8a08cb88.js"><link rel="prefetch" href="/assets/5. xml 和 json.html.3f128ade.js"><link rel="prefetch" href="/assets/6. tomcat.html.9bc68c09.js"><link rel="prefetch" href="/assets/7. Servlet.html.e7a46105.js"><link rel="prefetch" href="/assets/8. Cookie 和 Session.html.25e52fe8.js"><link rel="prefetch" href="/assets/9. JSP.html.1952e8be.js"><link rel="prefetch" href="/assets/index.html.4a2aedc1.js"><link rel="prefetch" href="/assets/1. 准备.html.fb9c4d8f.js"><link rel="prefetch" href="/assets/10. 注解.html.e82b70dc.js"><link rel="prefetch" href="/assets/11. 复杂查询环境搭建.html.d163952e.js"><link rel="prefetch" href="/assets/12. 动态 SQL.html.7b17a8cc.js"><link rel="prefetch" href="/assets/2. 使用.html.f1575530.js"><link rel="prefetch" href="/assets/3. 主要类介绍.html.c2150be6.js"><link rel="prefetch" href="/assets/4. 配置文件详解.html.566e6455.js"><link rel="prefetch" href="/assets/5. CRUD.html.c618dc66.js"><link rel="prefetch" href="/assets/6. 配置 environments.html.cb005db5.js"><link rel="prefetch" href="/assets/7. ResultMap 结果集映射.html.337b8606.js"><link rel="prefetch" href="/assets/8. 日志.html.ce060598.js"><link rel="prefetch" href="/assets/9. 分页.html.03aedab5.js"><link rel="prefetch" href="/assets/index.html.16815f3f.js"><link rel="prefetch" href="/assets/1. SSM项目练习总结.html.a3be0610.js"><link rel="prefetch" href="/assets/2. 环境搭建.html.40753ebb.js"><link rel="prefetch" href="/assets/3. 自动登录问题记录.html.dd2fe4f1.js"><link rel="prefetch" href="/assets/4. xxmapping.html.a37dafb9.js"><link rel="prefetch" href="/assets/5. 处理器方法的返回值.html.90c48eff.js"><link rel="prefetch" href="/assets/6. 请求转发与请求重定向.html.44d1178e.js"><link rel="prefetch" href="/assets/1. IOC.html.a4314bc7.js"><link rel="prefetch" href="/assets/10. 整合Mybatis.html.0f6ac468.js"><link rel="prefetch" href="/assets/11. 事务.html.4a58c224.js"><link rel="prefetch" href="/assets/12.  web项目中怎么使用容器对象.html.7a5d2a0f.js"><link rel="prefetch" href="/assets/2. Spring创建对象.html.c4d0020b.js"><link rel="prefetch" href="/assets/3. DI 依赖注入.html.5a7f05b6.js"><link rel="prefetch" href="/assets/4. Spring配置.html.a8c2c4f9.js"><link rel="prefetch" href="/assets/5. Bean自动装配.html.7e521850.js"><link rel="prefetch" href="/assets/6. 使用注解开发.html.1de6a395.js"><link rel="prefetch" href="/assets/7. 使用java方式配置Spring.html.75048393.js"><link rel="prefetch" href="/assets/8. 代理模式.html.86e389f6.js"><link rel="prefetch" href="/assets/9. Spring AOP.html.a029e208.js"><link rel="prefetch" href="/assets/1. 第一个SpringMVC程序.html.53138e70.js"><link rel="prefetch" href="/assets/10. 拦截器.html.0ec8f3db.js"><link rel="prefetch" href="/assets/2. 配置视图解析器.html.ee1b10c3.js"><link rel="prefetch" href="/assets/3. 控制请求方式.html.e603b4d6.js"><link rel="prefetch" href="/assets/4. 处理器方法的参数.html.d2ae00f5.js"><link rel="prefetch" href="/assets/5. 处理器方法的返回值.html.1287110e.js"><link rel="prefetch" href="/assets/6. url-pattern.html.6cabd660.js"><link rel="prefetch" href="/assets/7. SSM整合.html.fef188b8.js"><link rel="prefetch" href="/assets/8. 请求重定向和转发.html.03d67524.js"><link rel="prefetch" href="/assets/9. 异常处理.html.7b4874c6.js"><link rel="prefetch" href="/assets/index.html.33663ae0.js"><link rel="prefetch" href="/assets/404.html.ac0f5095.js"><link rel="prefetch" href="/assets/photoswipe.esm.f594e77b.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to content</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><a href="/" class="brand"><img class="logo" src="/logo.svg" alt="空~"><!----><span class="site-name hide-in-pad">空~</span></a><!----></div><div class="navbar-center"><!----><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/" class="nav-link" aria-label="主页"><span class="icon iconfont icon-home"></span>主页<!----></a></div><div class="nav-item hide-in-mobile"><a href="/guide/" class="nav-link" aria-label="学习指南"><span class="icon iconfont icon-creative"></span>学习指南<!----></a></div><div class="nav-item hide-in-mobile"><a href="/Java/1.%20Java%E8%AF%AD%E8%A8%80%E6%A6%82%E8%BF%B0%E4%B8%8E%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83.html" class="nav-link" aria-label="Java"><span class="icon iconfont icon-java"></span>Java<!----></a></div><div class="nav-item hide-in-mobile"><a href="/MySQL/1.%20%E5%88%9B%E5%BB%BA%E4%B8%8E%E7%AE%A1%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93.html" class="nav-link" aria-label="MySQL"><span class="icon iconfont icon-mysql"></span>MySQL<!----></a></div><div class="nav-item hide-in-mobile"><a href="/javaWeb/0.%20Maven.html" class="nav-link" aria-label="Java Web"><span class="icon iconfont icon-Apache"></span>Java Web<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="SSM"><span class="title"><span class="icon iconfont icon-tag"></span>SSM</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/SSM/Mybatis/" class="nav-link" aria-label="Mybatis"><span class="icon iconfont icon-stack"></span>Mybatis<!----></a></li><li class="dropdown-item"><a href="/SSM/Spring/1.%20IOC.html" class="nav-link" aria-label="Spring"><span class="icon iconfont icon-leaf"></span>Spring<!----></a></li><li class="dropdown-item"><a href="/SSM/SpringMVC/" class="nav-link" aria-label="SpringMVC"><span class="icon iconfont icon-module"></span>SpringMVC<!----></a></li><li class="dropdown-item"><a href="/SSM/SSM%E6%80%BB%E7%BB%93/1.%20SSM%E9%A1%B9%E7%9B%AE%E7%BB%83%E4%B9%A0%E6%80%BB%E7%BB%93.html" class="nav-link" aria-label="SSM总结"><span class="icon iconfont icon-write"></span>SSM总结<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="/SpringBoot/" class="nav-link" aria-label="SpringBoot"><span class="icon iconfont icon-stack"></span>SpringBoot<!----></a></div><div class="nav-item hide-in-mobile"><a href="/SpringCloud/" class="nav-link" aria-label="SpringCloud"><span class="icon iconfont icon-stack"></span>SpringCloud<!----></a></div><div class="nav-item hide-in-mobile"><a href="/%E5%B0%8F%E8%AE%B0/" class="nav-link" aria-label="小记"><span class="icon iconfont icon-write"></span>小记<!----></a></div></nav><!----></div><div class="navbar-right"><!----><!----><div class="nav-item"><a class="repo-link" href="https://github.com/SurplusFate/SurplusFate.github.io" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button class="outlook-button" tabindex="-1" ariahidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><form class="search-box" role="search"><input type="search" placeholder="搜索" autocomplete="off" spellcheck="false" value><!----></form><!----><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><a href="/Java/1.%20Java%E8%AF%AD%E8%A8%80%E6%A6%82%E8%BF%B0%E4%B8%8E%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83.html" class="nav-link sidebar-link sidebar-page" aria-label="1. Java 语言概述与开发环境"><span class="icon iconfont icon-note"></span>1. Java 语言概述与开发环境<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/Java/2.%20%E7%AC%AC%E4%B8%80%E4%B8%AAjava%E7%A8%8B%E5%BA%8F.html" class="nav-link sidebar-link sidebar-page" aria-label="2. 第一个 java 程序"><span class="icon iconfont icon-note"></span>2. 第一个 java 程序<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/Java/3.%20Java%E7%A8%8B%E5%BA%8F%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%A7%84%E5%88%99.html" class="nav-link sidebar-link sidebar-page" aria-label="3. Java 程序的基本规则"><span class="icon iconfont icon-note"></span>3. Java 程序的基本规则<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/Java/4.%20%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B.html" class="nav-link sidebar-link sidebar-page" aria-label="4. 数据类型"><span class="icon iconfont icon-note"></span>4. 数据类型<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/Java/5.%20%E8%BF%90%E7%AE%97%E7%AC%A6.html" class="nav-link sidebar-link sidebar-page" aria-label="5. 运算符"><span class="icon iconfont icon-note"></span>5. 运算符<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/Java/6.%20%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6.html" class="nav-link sidebar-link sidebar-page" aria-label="6. 流程控制"><span class="icon iconfont icon-note"></span>6. 流程控制<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/Java/7.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8A%EF%BC%89.html" class="nav-link sidebar-link sidebar-page" aria-label="7. 面向对象（上）"><span class="icon iconfont icon-note"></span>7. 面向对象（上）<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="8. 面向对象（下）"><span class="icon iconfont icon-note"></span>8. 面向对象（下）<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#java-7-增强的包装类" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Java 7 增强的包装类"><!---->Java 7 增强的包装类<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#处理对象" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="处理对象"><!---->处理对象<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#打印对象和tostring方法" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="打印对象和toString方法"><!---->打印对象和toString方法<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#和-equals-方法" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="==和 equals 方法"><!---->==和 equals 方法<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#类成员" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="类成员"><!---->类成员<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#理解类成员" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="理解类成员"><!---->理解类成员<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#单例-singleton-类" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="单例（Singleton）类"><!---->单例（Singleton）类<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#final-修饰符" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="final 修饰符"><!---->final 修饰符<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#final-成员变量" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="final 成员变量"><!---->final 成员变量<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#final-局部变量" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="final 局部变量"><!---->final 局部变量<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#final-修饰基本类型变量和引用类型变量的区别" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="final 修饰基本类型变量和引用类型变量的区别"><!---->final 修饰基本类型变量和引用类型变量的区别<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#可执行-宏替换-的-final-变量" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="可执行“宏替换”的 final 变量"><!---->可执行“宏替换”的 final 变量<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#final-方法" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="final 方法"><!---->final 方法<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#final-类" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="final 类"><!---->final 类<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#不可变类" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="不可变类"><!---->不可变类<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#缓存实例的不可变类" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="缓存实例的不可变类"><!---->缓存实例的不可变类<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#抽象类" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="抽象类"><!---->抽象类<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#抽象方法和抽象类" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="抽象方法和抽象类"><!---->抽象方法和抽象类<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#抽象类的作用" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="抽象类的作用"><!---->抽象类的作用<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#接口" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="接口"><!---->接口<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#接口的概念" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="接口的概念"><!---->接口的概念<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#接口的定义" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="接口的定义"><!---->接口的定义<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#接口的继承" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="接口的继承"><!---->接口的继承<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#使用接口" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="使用接口"><!---->使用接口<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#接口和抽象类" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="接口和抽象类"><!---->接口和抽象类<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#面向接口编程" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="面向接口编程"><!---->面向接口编程<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#内部类" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="内部类"><!---->内部类<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#非静态内部类" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="非静态内部类"><!---->非静态内部类<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#静态内部类" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="静态内部类"><!---->静态内部类<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#使用内部类" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="使用内部类"><!---->使用内部类<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#局部内部类" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="局部内部类"><!---->局部内部类<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#匿名内部类" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="匿名内部类"><!---->匿名内部类<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#闭包-closure-和回调" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="闭包（Closure）和回调"><!---->闭包（Closure）和回调<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#枚举类" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="枚举类"><!---->枚举类<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#手动实现枚举类" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="手动实现枚举类"><!---->手动实现枚举类<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#枚举类入门" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="枚举类入门"><!---->枚举类入门<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#枚举类的-field、方法和构造器" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="枚举类的 Field、方法和构造器"><!---->枚举类的 Field、方法和构造器<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#实现接口的枚举类" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="实现接口的枚举类"><!---->实现接口的枚举类<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#包含抽象方法的枚举类" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="包含抽象方法的枚举类"><!---->包含抽象方法的枚举类<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#对象与垃圾回收" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="对象与垃圾回收"><!---->对象与垃圾回收<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#对象在内存中的状态" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="对象在内存中的状态"><!---->对象在内存中的状态<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#强制垃圾回收" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="强制垃圾回收"><!---->强制垃圾回收<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#finalize-方法" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="finalize 方法"><!---->finalize 方法<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#对象的软、弱和虚引用" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="对象的软、弱和虚引用"><!---->对象的软、弱和虚引用<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#修饰符的适用范围" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="修饰符的适用范围"><!---->修饰符的适用范围<!----></a><ul class="sidebar-sub-headers"></ul></li></ul><!--]--></li><li><!--[--><a href="/Java/9.%20%E6%95%B0%E7%BB%84.html" class="nav-link sidebar-link sidebar-page" aria-label="9. 数组"><span class="icon iconfont icon-note"></span>9. 数组<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/Java/10.%20%E6%95%B0%E7%BB%84%E7%9A%84%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95.html" class="nav-link sidebar-link sidebar-page" aria-label="10. 数组的常见算法"><span class="icon iconfont icon-note"></span>10. 数组的常见算法<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/Java/11.%20%E4%B8%8E%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83%E4%BA%A4%E4%BA%92.html" class="nav-link sidebar-link sidebar-page" aria-label="11. 与运行环境交互"><span class="icon iconfont icon-note"></span>11. 与运行环境交互<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/Java/12.%20Java%E9%9B%86%E5%90%88.html" class="nav-link sidebar-link sidebar-page" aria-label="12. Java 集合"><span class="icon iconfont icon-note"></span>12. Java 集合<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/Java/13.%20%E6%B3%9B%E5%9E%8B.html" class="nav-link sidebar-link sidebar-page" aria-label="13. 泛型"><span class="icon iconfont icon-note"></span>13. 泛型<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/Java/14.%20%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B.html" class="nav-link sidebar-link sidebar-page" aria-label="14. 函数式编程"><span class="icon iconfont icon-note"></span>14. 函数式编程<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/Java/15.%20%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86.html" class="nav-link sidebar-link sidebar-page" aria-label="15. 异常处理"><span class="icon iconfont icon-note"></span>15. 异常处理<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/Java/16.%20%E6%B3%A8%E8%A7%A3.html" class="nav-link sidebar-link sidebar-page" aria-label="16. 注解"><span class="icon iconfont icon-note"></span>16. 注解<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/Java/17.%20IO%E6%B5%81.html" class="nav-link sidebar-link sidebar-page" aria-label="17. IO 流"><span class="icon iconfont icon-note"></span>17. IO 流<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/Java/18.%20%E5%A4%9A%E7%BA%BF%E7%A8%8B.html" class="nav-link sidebar-link sidebar-page" aria-label="18. 多线程"><span class="icon iconfont icon-note"></span>18. 多线程<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/Java/19.%20%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6%E4%B8%8E%E5%8F%8D%E5%B0%84.html" class="nav-link sidebar-link sidebar-page" aria-label="19. 类加载机制与反射"><span class="icon iconfont icon-note"></span>19. 类加载机制与反射<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><span class="icon iconfont icon-note"></span>8. 面向对象（下）</h1><div class="page-info"><span class="author-info" aria-label="作者🖊" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="author-item" href="https://SurplusFate.github.io" target="_blank" rel="noopener noreferrer">空~</a></span><span property="author" content="空~"></span></span><!----><span class="date-info" aria-label="写作日期📅" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span>2022年7月12日</span><meta property="datePublished" content="2022-07-12T00:00:00.000Z"></span><span class="category-info" aria-label="分类🌈" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><ul class="categories-wrapper"><li class="category category6" role>java</li><meta property="articleSection" content="java"></ul></span><!----><span class="reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 117 分钟</span><meta property="timeRequired" content="PT117M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">此页内容</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#java-7-增强的包装类" class="router-link-active router-link-exact-active toc-link level2">Java 7 增强的包装类</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#处理对象" class="router-link-active router-link-exact-active toc-link level2">处理对象</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#打印对象和tostring方法" class="router-link-active router-link-exact-active toc-link level3">打印对象和toString方法</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#和-equals-方法" class="router-link-active router-link-exact-active toc-link level3">==和 equals 方法</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#类成员" class="router-link-active router-link-exact-active toc-link level2">类成员</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#理解类成员" class="router-link-active router-link-exact-active toc-link level3">理解类成员</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#单例-singleton-类" class="router-link-active router-link-exact-active toc-link level3">单例（Singleton）类</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#final-修饰符" class="router-link-active router-link-exact-active toc-link level2">final 修饰符</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#final-成员变量" class="router-link-active router-link-exact-active toc-link level3">final 成员变量</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#final-局部变量" class="router-link-active router-link-exact-active toc-link level3">final 局部变量</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#final-修饰基本类型变量和引用类型变量的区别" class="router-link-active router-link-exact-active toc-link level3">final 修饰基本类型变量和引用类型变量的区别</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#可执行-宏替换-的-final-变量" class="router-link-active router-link-exact-active toc-link level3">可执行“宏替换”的 final 变量</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#final-方法" class="router-link-active router-link-exact-active toc-link level3">final 方法</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#final-类" class="router-link-active router-link-exact-active toc-link level3">final 类</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#不可变类" class="router-link-active router-link-exact-active toc-link level3">不可变类</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#缓存实例的不可变类" class="router-link-active router-link-exact-active toc-link level3">缓存实例的不可变类</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#抽象类" class="router-link-active router-link-exact-active toc-link level2">抽象类</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#抽象方法和抽象类" class="router-link-active router-link-exact-active toc-link level3">抽象方法和抽象类</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#抽象类的作用" class="router-link-active router-link-exact-active toc-link level3">抽象类的作用</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#接口" class="router-link-active router-link-exact-active toc-link level2">接口</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#接口的概念" class="router-link-active router-link-exact-active toc-link level3">接口的概念</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#接口的定义" class="router-link-active router-link-exact-active toc-link level3">接口的定义</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#接口的继承" class="router-link-active router-link-exact-active toc-link level3">接口的继承</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#使用接口" class="router-link-active router-link-exact-active toc-link level3">使用接口</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#接口和抽象类" class="router-link-active router-link-exact-active toc-link level3">接口和抽象类</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#面向接口编程" class="router-link-active router-link-exact-active toc-link level3">面向接口编程</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#内部类" class="router-link-active router-link-exact-active toc-link level2">内部类</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#非静态内部类" class="router-link-active router-link-exact-active toc-link level3">非静态内部类</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#静态内部类" class="router-link-active router-link-exact-active toc-link level3">静态内部类</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#使用内部类" class="router-link-active router-link-exact-active toc-link level3">使用内部类</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#局部内部类" class="router-link-active router-link-exact-active toc-link level3">局部内部类</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#匿名内部类" class="router-link-active router-link-exact-active toc-link level3">匿名内部类</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#闭包-closure-和回调" class="router-link-active router-link-exact-active toc-link level3">闭包（Closure）和回调</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#枚举类" class="router-link-active router-link-exact-active toc-link level2">枚举类</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#手动实现枚举类" class="router-link-active router-link-exact-active toc-link level3">手动实现枚举类</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#枚举类入门" class="router-link-active router-link-exact-active toc-link level3">枚举类入门</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#枚举类的-field、方法和构造器" class="router-link-active router-link-exact-active toc-link level3">枚举类的 Field、方法和构造器</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#实现接口的枚举类" class="router-link-active router-link-exact-active toc-link level3">实现接口的枚举类</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#包含抽象方法的枚举类" class="router-link-active router-link-exact-active toc-link level3">包含抽象方法的枚举类</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#对象与垃圾回收" class="router-link-active router-link-exact-active toc-link level2">对象与垃圾回收</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#对象在内存中的状态" class="router-link-active router-link-exact-active toc-link level3">对象在内存中的状态</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#强制垃圾回收" class="router-link-active router-link-exact-active toc-link level3">强制垃圾回收</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#finalize-方法" class="router-link-active router-link-exact-active toc-link level3">finalize 方法</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#对象的软、弱和虚引用" class="router-link-active router-link-exact-active toc-link level3">对象的软、弱和虚引用</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/8.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8B%EF%BC%89.html#修饰符的适用范围" class="router-link-active router-link-exact-active toc-link level2">修饰符的适用范围</a></li><!----><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h1 id="_8-面向对象-下" tabindex="-1"><a class="header-anchor" href="#_8-面向对象-下" aria-hidden="true">#</a> 8. 面向对象（下）</h1><h2 id="java-7-增强的包装类" tabindex="-1"><a class="header-anchor" href="#java-7-增强的包装类" aria-hidden="true">#</a> Java 7 增强的包装类</h2><p>Java 的 8 种基本数据类型不支持面向对象的编程机制，基本数据类型的数据也不具备“对象”的特性：没有 Field、方法可以被调用。</p><p>在某些时候，基本数据类型会有一些制约，例如所有引用类型的变量都继承了 Object 类，都可当成 Object 类型变量使用。但基本数据类型的变量就不可以，如果有个方法需要 Object 类型的参数，但实际需要的值却是 2、3 等数值，这可能就比较难以处理。</p><p>为了解决 8 种基本数据类型的变量不能当成 Object 类型变量使用的问题，Java 提供了包装类（Wrapper Class）的概念，为 8 种基本数据类型分别定义了相应的引用类型，并称之为基本数据类型的包装类。</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202207121505498.jpeg" alt="img"></p><p>把基本数据类型变量包装成包装类实例是通过对应包装类的构造器来实现的，8 个包装类中除了 Character 之外，还可以通过传入一个字符串参数来构建包装类对象。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Primitive2Wrapper</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">boolean</span> bl <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token comment">// 通过构造器把b1基本类型变量包装成包装类对象</span>
        <span class="token class-name">Boolean</span> blObj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Boolean</span><span class="token punctuation">(</span>bl<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> it <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
        <span class="token comment">// 通过构造器把it基本类型变量包装成包装类对象</span>
        <span class="token class-name">Integer</span> itObj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 把一个字符串转换成Float对象</span>
        <span class="token class-name">Float</span> fl <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float</span><span class="token punctuation">(</span><span class="token string">&quot;4.56&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 把一个字符串转换成Boolean对象</span>
        <span class="token class-name">Boolean</span> bObj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Boolean</span><span class="token punctuation">(</span><span class="token string">&quot;false&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 下面程序运行时将出现java.lang.NumberFormatException异常</span>
        <span class="token comment">// Long lObj=new Long(&quot;ddd&quot;);</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>当试图使用一个字符串来创建 Boolean 对象时，如果传入的字符串是&quot;true&quot;，或是此字符串不同字母的大小写变化形式，如&quot;True&quot;，都将创建 true 对应的 Boolean 对象；如果传入其他字符串，则会创建 false 对应的 Boolean 对象。</p><p>如果希望获得包装类对象中包装的基本类型变量，则可以使用包装类提供的<code>xxxValue()</code>实例方法。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 取出Boolean对象里的boolean变量</span>
<span class="token keyword">boolean</span> bb <span class="token operator">=</span> bObj<span class="token punctuation">.</span><span class="token function">booleanValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 取出Integer对象里的int变量</span>
<span class="token keyword">int</span> i <span class="token operator">=</span> itObj<span class="token punctuation">.</span><span class="token function">intValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 取出Float对象里的float变量</span>
<span class="token keyword">float</span> f <span class="token operator">=</span> fl<span class="token punctuation">.</span><span class="token function">floatValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>基本类型变量和包装类对象之间的转换关系如图：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202207121606801.jpeg" alt="img"></p><p>JDK 1.5 提供了自动装箱（Autoboxing）和自动拆箱（AutoUnboxing）功能。所谓自动装箱，就是可以把一个基本类型变量直接赋给对应的包装类变量，或者赋给 Object 变量（Object 是所有类的父类，子类对象可以直接赋给父类变量）；自动拆箱则与之相反，允许直接把包装类对象直接赋给一个对应的基本类型变量。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AutoBoxingUnboxing</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 直接把一个基本类型变量赋给Integer对象</span>
        <span class="token class-name">Integer</span> inObj <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
        <span class="token comment">// 直接把一个boolean类型变量赋给一个Object类型变量</span>
        <span class="token class-name">Object</span> boolObj <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token comment">// 直接把一个Integer对象赋给int类型变量</span>
        <span class="token keyword">int</span> it <span class="token operator">=</span> inObj<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>boolObj <span class="token keyword">instanceof</span> <span class="token class-name">Boolean</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 先把0bject对象强制类型转换为Boolean类型，再赋给boolean变量</span>
            <span class="token keyword">boolean</span> b <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Boolean</span><span class="token punctuation">)</span>boolObj<span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>进行自动装箱和自动拆箱时必须注意类型匹配，例如<code>Integer</code>只能自动拆箱成<code>int</code>类型变量，不要试图拆箱成<code>boolean</code>类型变量；与之类似的是，<code>int</code>类型变量只能自动装箱成<code>Integer</code>对象（即使赋给 Object 类型变量，那也只是利用了 Java 的向上自动转型特性），不要试图装箱成<code>Boolean</code>对象。</p><p>包装类还可实现基本类型变量和字符串之间的转换。把字符串类型的值转换为基本类型的值有两种方式。</p><ol><li>利用包装类提供的<code>parseXxx(String s)</code>静态方法（除了 Character 之外的所有包装类都提供了该方法。</li><li>利用包装类提供的<code>Xxx(String s)</code>构造器。</li></ol><p>String 类提供了多个重载<code>valueOf()</code>方法，用于将基本类型变量转换成字符串，下面程序示范了这种转换关系。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Primitive2String</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> intStr <span class="token operator">=</span> <span class="token string">&quot;123&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">// 把一个特定字符串转换成int变量</span>
        <span class="token keyword">int</span> it1 <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>intStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> it2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">(</span>intStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>it2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> floatStr <span class="token operator">=</span> <span class="token string">&quot;4.56&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">// 把一个特定字符串转换成float变量</span>
        <span class="token keyword">float</span> ft1 <span class="token operator">=</span> <span class="token class-name">Float</span><span class="token punctuation">.</span><span class="token function">parseFloat</span><span class="token punctuation">(</span>floatStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">float</span> ft2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float</span><span class="token punctuation">(</span>floatStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ft2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 把一个float变量转换成String变量</span>
        <span class="token class-name">String</span> ftStr <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token number">2.345f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ftStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 把一个double变量转换成String变量</span>
        <span class="token class-name">String</span> dbStr <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token number">3.344</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>dbStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 把一个boolean变量转换成String变量</span>
        <span class="token class-name">String</span> boolStr <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>boolStr<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>基本类型变量和字符串之间的转换关系：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202207121652801.jpeg" alt="img"></p><p>如果希望把基本类型变量转换成字符串，还有一种更简单的方法：将基本类型变量和&quot;&quot;进行连接运算，系统会自动把基本类型变量转换成字符串。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// intStr的值为&quot;5&quot;</span>
<span class="token class-name">String</span> intStr <span class="token operator">=</span> <span class="token number">5</span> <span class="token operator">+</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>虽然包装类型的变量是引用数据类型，但包装类的实例可以与数值类型的值进行比较，这种比较是直接取出包装类实例所包装的数值来进行比较的。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Integer</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 输出true</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;6的包装类实例是否大于5.0&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>a <span class="token operator">&gt;</span> <span class="token number">5.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>两个包装类的实例进行比较的情况就比较复杂，因为包装类的实例实际上是引用类型，只有两个包装类引用指向同一个对象时才会返回 true。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 输出false</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;比较2个包装类的实例是否相等:&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>但 JDK 1.5 以后支持所谓的自动装箱，自动装箱就是可以直接把一个基本类型值赋给一个包装类实例，在这种情况下可能会出现一些特别的情形。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 通过自动装箱，允许把基本类型值赋值给包装类实例</span>
<span class="token class-name">Integer</span> ina <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token class-name">Integer</span> inb <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token comment">// 输出true</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;两个2自动装箱后是否相等:&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>ina <span class="token operator">==</span> inb<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Integer</span> biga <span class="token operator">=</span> <span class="token number">128</span><span class="token punctuation">;</span>
<span class="token class-name">Integer</span> bigb <span class="token operator">=</span> <span class="token number">128</span><span class="token punctuation">;</span>
<span class="token comment">// 输出false</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;两个128自动装箱后是否相等:&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>biga <span class="token operator">==</span> bigb<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>查看 Java 系统中<code>java.lang.Integer</code>类的源代码，如下所示。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 定义一个长度为256的Integer数组</span>
<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Integer</span><span class="token punctuation">[</span><span class="token punctuation">]</span> cache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">127</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">static</span> <span class="token punctuation">{</span>
    <span class="token comment">// 执行初始化，创建-128到127的Integer实例，并放入cache数组中</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> cache<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        cache<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>系统把一个-128 ～ 127 之间的整数自动装箱成 Integer 实例，并放入了一个名为 cache 的数组中缓存起来。如果以后把一个-128 ～ 127 之间的整数自动装箱成一个 Integer 实例时，实际上是直接指向对应的数组元素，因此-128 ～ 127 之间的同一个整数自动装箱成 Integer 实例时，永远都是引用 cache 数组的同一个数组元素，所以它们全部相等；但每次把一个不在-128 ～ 127 范围内的整数自动装箱成 Integer 实例时，系统总是重新创建一个 Integer 实例，所以出现程序中的运行结果。</p><div class="custom-container info"><p class="custom-container-title">相关信息</p><p>Java 会把一些创建成本大、需要频繁使用的对象缓存起来，从而提高程序的运行性能。</p><p>缓存是一种非常优秀的设计模式，在 Java、Java EE 平台的很多地方都会通过缓存来提高系统的运行性能。简单地说，如果你需要一台电脑，那么你就去买了一台电脑。但你不可能一直使用这台电脑，你总会离开这台电脑——在你离开电脑的这段时间内，你如何做？你会不会立即把电脑扔掉？当然不会，你会把电脑放在房间里，等下次又需要电脑时直接开机使用，而不是再次去购买一台。假设电脑是内存中的对象，而你的房间是内存，如果房间足够大，则可以把所有曾经用过的各种东西都缓存起来，但这不可能，房间的空间是有限制的，因此有些东西你用过一次就扔掉了。你只会把一些购买成本大、需要频繁使用的东西保存下来。</p></div><p>Java 7 为所有的包装类都提供了一个静态的<code>compare(xxx val1, xxx val2)</code>方法，这样开发者就可以通过包装类提供的<code>compare(xxx val1, xxx val2)</code>方法来比较两个基本类型值的大小，包括比较两个<code>boolean</code>类型值，两个<code>boolean</code>类型值进行比较时，<code>true &gt; false</code>。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 输出1</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Boolean</span><span class="token punctuation">.</span><span class="token function">compare</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 输出0</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Boolean</span><span class="token punctuation">.</span><span class="token function">compare</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 输出-1</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Boolean</span><span class="token punctuation">.</span><span class="token function">compare</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="处理对象" tabindex="-1"><a class="header-anchor" href="#处理对象" aria-hidden="true">#</a> 处理对象</h2><p>Java 对象都是 Object 类的实例，都可直接调用该类中定义的方法，这些方法提供了处理 Java 对象的通用方法。</p><h3 id="打印对象和tostring方法" tabindex="-1"><a class="header-anchor" href="#打印对象和tostring方法" aria-hidden="true">#</a> 打印对象和<code>toString</code>方法</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">info</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;此人名为:&quot;</span> <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PrintObject</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 创建一个Person对象，将之赋给p变量</span>
        <span class="token class-name">Person</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">&quot;孙悟空&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 打印p所引用的Person对象</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>编译、运行上面程序，看到如下运行结果：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Person</span><span class="token annotation punctuation">@f58205</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>@符号后的 6 位十六进制数字可能发生改变。但这个输出结果是怎么来的呢？</p><p><code>System.out.println</code>方法只能在控制台输出字符串，而 Person 实例是一个内存中的对象，当使用该方法输出 Person 对象时，实际上输出的是 Person 对象的<code>toString()</code>方法的返回值。</p><p>下面两行代码的效果完全一样。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><code>toString()</code>方法是 Object 类里的一个实例方法，所有的 Java 类都是 Object 类的子类，因此所有的 Java 对象都具有<code>toString()</code>方法。</p><p>所有的 Java 对象都可以和字符串进行连接运算，当 Java 对象和字符串进行连接运算时，系统自动调用 Java 对象<code>toString</code>方法的返回值和字符串进行连接运算，即下面两行代码的结果也完全相同。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">String</span> pStr <span class="token operator">=</span> p <span class="token operator">+</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> pStr <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><code>toString</code>方法是一个非常特殊的方法，它是一个“自我描述”方法，该方法通常用于实现这样一个功能：当程序员直接打印该对象时，系统将会输出该对象的“自我描述”信息，用以告诉外界该对象具有的状态信息。</p><p>Object 类提供的<code>toString</code>方法总是返回该对象实现类的“类名+@+<code>hashCode</code>”值，这个返回值并不能真正实现“自我描述”的功能，因此如果用户需要自定义类能实现“自我描述”的功能，就必须重写 Object 类的<code>toString</code>方法。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Apple</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> color<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">double</span> weight<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Apple</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token comment">// 提供有参数的构造器</span>
    <span class="token keyword">public</span> <span class="token class-name">Apple</span><span class="token punctuation">(</span><span class="token class-name">String</span> color<span class="token punctuation">,</span> <span class="token keyword">double</span> weight<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>color <span class="token operator">=</span> color<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>weight <span class="token operator">=</span> weight<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 省略color、weight属性的setter和getter方法...</span>
    <span class="token comment">// 重写toString方法，用于实现Apple对象的“自我描述”</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;一个苹果，颜色是:&quot;</span> <span class="token operator">+</span> color <span class="token operator">+</span> <span class="token string">&quot;，重量是:&quot;</span> <span class="token operator">+</span> weight<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ToStringTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">Apple</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Apple</span><span class="token punctuation">(</span><span class="token string">&quot;红色&quot;</span><span class="token punctuation">,</span> <span class="token number">5.68</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 打印Apple对象</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>运行结果：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>一个苹果，颜色是<span class="token operator">:</span>红色，重量是<span class="token operator">:</span><span class="token number">5.68</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>通过重写 Apple 类的<code>toString</code>方法，就可以让系统在打印 Apple 对象时打印出该对象的“自我描述”信息。</p><p>大部分时候，重写<code>toString</code>方法总是返回该对象的所有令人感兴趣的信息所组成的字符串。通常可返回如下格式的字符串：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>类名<span class="token punctuation">[</span><span class="token class-name">Field1</span> <span class="token operator">=</span> 值<span class="token number">1</span>，<span class="token class-name">Field2</span> <span class="token operator">=</span> 值<span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>将上面 Apple 类的<code>toString</code>方法改为如下：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;Apple[color=&quot;</span> <span class="token operator">+</span> color <span class="token operator">+</span> <span class="token string">&quot;, weight=&quot;</span> <span class="token operator">+</span> weight <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这个<code>toString</code>方法提供了足够的有效信息来描述 Apple 对象，也就实现了<code>toString</code>方法的功能。</p><h3 id="和-equals-方法" tabindex="-1"><a class="header-anchor" href="#和-equals-方法" aria-hidden="true">#</a> ==和 equals 方法</h3><p>Java 程序中测试两个变量是否相等有两种方式：一种是利用<code>==</code>运算符，另一种是利用<code>equals</code>方法。</p><p>当使用<code>==</code>来判断两个变量是否相等时，如果两个变量是基本类型变量，且都是数值类型（不一定要求数据类型严格相同），则只要两个变量的值相等，就将返回 true。</p><p>但对于两个引用类型变量，它们必须指向同一个对象时，<code>==</code>判断才会返回 true。<code>==</code>不可用于比较类型上没有父子关系的两个对象。下面程序示范了使用<code>==</code>来判断两种类型变量是否相等的结果。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EqualTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> it <span class="token operator">=</span> <span class="token number">65</span><span class="token punctuation">;</span>
        <span class="token keyword">float</span> f1 <span class="token operator">=</span> <span class="token number">65.0f</span><span class="token punctuation">;</span>
        <span class="token comment">// 将输出true</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;65和65.Of是否相等?&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>it <span class="token operator">==</span> f1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">char</span> ch <span class="token operator">=</span> <span class="token char">&#39;A&#39;</span><span class="token punctuation">;</span>
        <span class="token comment">// 将输出true</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;65和&#39;A&#39;是否相等?&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>it <span class="token operator">==</span> ch<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> str1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> str2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 将输出false</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;str1和str2是否相等?&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>str1 <span class="token operator">==</span> str2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 将输出true</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;str1是否equals str2?&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>str1<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>str2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 由于java.lang.String 与EqualTest类没有继承关系</span>
        <span class="token comment">// 所以下面语句导致编译错误</span>
        <span class="token comment">// System.out.println(&quot;hello&quot; == new EqualTest());</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>String 还有一个非常容易迷惑的地方：<code>&quot;hello&quot;</code>直接量和<code>new String(&quot;hello&quot;)</code>有什么区别呢？</p><p>当 Java 程序直接使用形如<code>&quot;hello&quot;</code>的字符串直接量（包括可以在编译时就计算出来的字符串值）时，JVM 将会使用常量池来管理这些字符串；当使用<code>new String(&quot;hello&quot;)</code>时，JVM 会先使用常量池来管理<code>&quot;hello&quot;</code>直接量，再调用 String 类的构造器来创建一个新的 String 对象，新创建的 String 对象被保存在堆内存中。换句话说，<code>new String(&quot;hello&quot;)</code>一共产生了两个对象。</p><div class="custom-container info"><p class="custom-container-title">相关信息</p><p>常量池（constant pool）专门用于管理在编译期被确定并被保存在已编译的.class 文件中的一些数据。它包括了关于类、方法、接口中的常量，还包括字符串常量。</p></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StringCompareTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">// s1直接引用常量池中的&quot;疯狂Java&quot;</span>
        <span class="token class-name">String</span> s1 <span class="token operator">=</span> <span class="token string">&quot;疯狂Java&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> s2 <span class="token operator">=</span> <span class="token string">&quot;疯狂&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> s3 <span class="token operator">=</span> <span class="token string">&quot;Java&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">// s4后面的字符串值可以在编译期就确定下来</span>
        <span class="token comment">// s4直接引用常量池中的&quot;疯狂Java&quot;</span>
        <span class="token class-name">String</span> s4 <span class="token operator">=</span> <span class="token string">&quot;疯狂&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;Java&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">// s5后面的字符串值可以在编译期就确定下来</span>
        <span class="token comment">// s5直接引用常量池中的&quot;疯狂Java&quot;</span>
        <span class="token class-name">String</span> s5 <span class="token operator">=</span> <span class="token string">&quot;疯&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;狂&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;Java&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">// s6后面的字符串值不能在编译期就确定下来</span>
        <span class="token comment">// 不能引用常量池中的字符串</span>
        <span class="token class-name">String</span> s6 <span class="token operator">=</span> s2 <span class="token operator">+</span> s3<span class="token punctuation">;</span>
        <span class="token comment">// 使用new调用构造器将会创建一个新的string对象</span>
        <span class="token comment">// s7引用堆内存中新创建的String对象</span>
        <span class="token class-name">String</span> s7 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">&quot;疯狂Java&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 输出true</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1 <span class="token operator">==</span> s4<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 输出true</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1 <span class="token operator">==</span> s5<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 输出false</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1 <span class="token operator">==</span> s6<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 输出false</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1 <span class="token operator">==</span> s7<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>JVM 常量池保证相同的字符串直接量只有一个，不会产生多个副本。例子中的 s1、s4、s5 所引用的字符串可以在编译期就确定下来，因此它们都将引用常量池中的同一个字符串对象。</p><p>使用<code>new String()</code>创建的字符串对象是运行时创建出来的，它被保存在运行时内存区内（即堆内存），不会放入常量池中。</p><p>很多时候，程序判断两个引用变量是否相等时，也希望有一种类似于“值相等”的判断规则，并不严格要求两个引用变量指向同一个对象。例如对于两个字符串变量，可能只是要求它们引用字符串对象里包含的字符序列相同即可认为相等。此时就可以利用 String 对象的 equals 方法来进行判断。</p><p>equals 方法是 Object 类提供的一个实例方法，因此所有引用变量都可调用该方法来判断是否与其他引用变量相等。但使用这个方法判断两个对象相等的标准与使用==运算符没有区别，同样要求两个引用变量指向同一个对象才会返回 true。因此这个 Object 类提供的 equals 方法没有太大的实际意义，如果希望采用自定义的相等标准，则可采用重写 equals 方法来实现。</p><div class="custom-container tip"><p class="custom-container-title">提示</p><p>String 已经重写了 Object 的<code>equals()</code>方法，String 的<code>equals()</code>方法判断两个字符串相等的标准是：只要两个字符串所包含的字符序列相同，通过<code>equals()</code>比较将返回 true，否则将返回 false。</p></div><div class="custom-container info"><p class="custom-container-title">相关信息</p><p>重写 equals 方法就是提供自定义的相等标准，你认为怎样是相等，那就怎样是相等，一切都是你做主！在极端的情况下，你可以让 Person 对象和 Dog 对象相等。</p></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
    <span class="token comment">// 重写equals方法，提供自定义的相等标准</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 不加判断，总是返回true，即Person对象与任何对象都相等</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 定义一个Dog空类</span>
<span class="token keyword">class</span> <span class="token class-name">Dog</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OverrideEqualsError</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Person</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Person对象是否equals Dog对象?&quot;</span> <span class="token operator">+</span> p<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Person对象是否equals String对象?&quot;</span> <span class="token operator">+</span> p<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">&quot;He11o&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>当然大部分时候，我们还是希望两个类型相同的对象才可能相等。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> idStr<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">String</span> idStr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>idStr <span class="token operator">=</span> idStr<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getIdStr</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> idStr<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setIdStr</span><span class="token punctuation">(</span><span class="token class-name">String</span> idStr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>idStr <span class="token operator">=</span> idStr<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 重写equals方法，提供自定义的相等标准</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 如果两个对象为同一个对象</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">==</span> obj<span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token comment">// 当obj不为nul1，且它是Person类的实例时</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> obj<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Person</span> personObj <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">)</span>obj<span class="token punctuation">;</span>
            <span class="token comment">// 并且当前对象的idStr与obj对象的idStr相等才可判断两个对象相等</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getIdStr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>personObj<span class="token punctuation">.</span><span class="token function">getIdStr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OverrideEqualsRight</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Person</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">&quot;孙悟空&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;12343433433&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Person</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">&quot;孙行者&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;12343433433&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Person</span> p3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">&quot;孙悟饭&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;99933433&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// p1和p2的idStr相等，所以输出true</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;p1和p2是否相等?&quot;</span> <span class="token operator">+</span> p1<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>p2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// p2和p3的idStr不相等，所以输出false</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;p2和p3是否相等?&quot;</span> <span class="token operator">+</span> p2<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>p3<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通常而言，正确地重写 equals 方法应该满足下列条件。</p><ol><li>自反性：对任意 x，<code>x.equals(x)</code>一定返回 true。</li><li>对称性：对任意 x 和 y，如果<code>y.equals(x)</code>返回 true，则<code>x.equals(y)</code>也返回 true。</li><li>传递性：对任意 x, y, z，如果<code>x.equals(y)</code>返回 true，<code>y.equals(z)</code>返回 true，则<code>x.equals(z)</code>一定返回 true。</li><li>一致性：对任意 x 和 y，如果对象中用于等价比较的信息没有改变，那么无论调用<code>x.equals(y)</code>多少次，返回的结果应该保持一致，要么一直是 true，要么一直是 false。</li><li>对任何不是 null 的 x，<code>x.equals(null)</code>一定返回 false。</li></ol><p>Object 默认提供的<code>equals()</code>只是比较对象的地址，即 Object 类的 equals 方法比较的结果与==运算符比较的结果完全相同。因此，在实际应用中常常需要重写 equals 方法，重写 equals 方法时，相等条件是由系统要求决定的，因此 equals 方法的实现也是由系统要求决定的。</p><div class="custom-container tip"><p class="custom-container-title">提示</p><p>判断 obj 是否为 Person 类的实例时，为何不用<code>obj instanceof Person</code>来判断呢？</p><p>对于<code>instanceof</code>运算符而言，当前面对象是后面类的实例或其子类的实例时都将返回 true，所以实际上重写<code>equals()</code>方法判断两个对象是否为同一个类的实例时使用<code>instanceof</code>是有问题的。比如有一个 Teacher 类型的变量 t，如果判断<code>t instanceof Person</code>，这也将返回 true。但对于重写<code>equals()</code>方法的要求而言，通常要求两个对象是同一个类的实例，因此使用<code>instanceof</code>运算符不太合适。改为使用<code>t.getClass()==Person.class</code>比较合适。这行代码用到了反射基础。</p><h2 id="类成员" tabindex="-1"><a class="header-anchor" href="#类成员" aria-hidden="true">#</a> 类成员</h2><p>static 关键字修饰的成员就是类成员，前面已经介绍的类成员有类 Field、类方法、静态初始化块等三个成分，static 关键字不能修饰构造器。static 修饰的类成员属于整个类，不属于单个实例。</p><h3 id="理解类成员" tabindex="-1"><a class="header-anchor" href="#理解类成员" aria-hidden="true">#</a> 理解类成员</h3><p>在 Java 类里只能包含 Field、方法、构造器、初始化块、内部类（包括接口、枚举）5 种成员，其中 static 可以修饰 Field、方法、初始化块、内部类（包括接口、枚举），以 static 修饰的成员就是类成员。</p><p>类 Field 属于整个类，当系统第一次准备使用该类时，系统会为该类 Field 分配内存空间，类 Field 开始生效，直到该类被卸载，该类的类 Field 所占有的内存才被系统的垃圾回收机制回收。类 Field 生存范围几乎等同于该类的生存范围。当类初始化完成后，类 Field 也被初始化完成。</p><p>类 Field 既可通过类来访问，也可通过类的对象来访问。但通过类的对象来访问类 Field 时，实际上并不是访问该对象所拥有的 Field，因为当系统创建该类的对象时，系统不会再为类 Field 分配内存，也不会再次对类 Field 进行初始化，也就是说，对象根本不拥有对应类的类 Field。通过对象访问类 Field 只是一种假象，通过对象访问的依然是该类的类 Field。当通过对象来访问类 Field 时，系统会在底层转换为通过该类来访问类 Field。</p><p>由于对象实际上并不持有类 Field，类 Field 是由该类持有的，同一个类的所有对象访问类 Field 时，实际上访问的还是该类所持有的 Field。</p><p>类方法也是类成员的一种，类方法也是属于类的，通常直接使用类作为调用者来调用类方法，但也可以使用对象来调用类方法。与类 Field 类似，即使使用对象来调用类方法，其效果也与采用类来调用类方法完全一样。</p><p>当使用实例来访问类成员时，实际上依然是委托给该类来访问类成员，因此即使某个实例为 null，它也可以访问它所属类的类成员。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NullAccessStatic</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;static修饰的类方法&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 定义一个NullAccessStatic变量，其值为null</span>
        <span class="token class-name">NullAccessStatic</span> nas <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token comment">// null对象调用所属类的静态方法</span>
        nas<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container tip"><p class="custom-container-title">提示</p><p>如果一个 null 对象访问实例成员（包括 Field 和方法），将会引发<code>NullPointerException</code>异常，因为 null 表明该实例根本不存在，既然实例不存在，理所当然的，它的 Field 和方法也不存在。</p></div></div><p>静态初始化块也是类成员的一种，静态初始化块用于执行类初始化动作，在类的初始化阶段，系统会调用该类的静态初始化块来对类进行初始化。一旦该类初始化结束后，静态初始化块将永远不会获得执行的机会。</p><p>对 static 关键字而言，有一条非常重要的规则：类成员（包括方法、初始化块、内部类和枚举类）不能访问实例成员（包括 Field、方法、初始化块、内部类和枚举类）。因为类成员是属于类的，类成员的作用域比实例成员的作用域更大，完全可能出现类成员已经初始化完成，但实例成员还不曾初始化的情况，如果允许类成员访问实例成员将会引起大量错误。</p><h3 id="单例-singleton-类" tabindex="-1"><a class="header-anchor" href="#单例-singleton-类" aria-hidden="true">#</a> 单例（Singleton）类</h3><p>在某些时候，允许其他类自由创建该类的对象没有任何意义，还可能造成系统性能下降（因为频繁地创建对象、回收对象带来的系统开销问题）。例如，系统可能只有一个窗口管理器、一个假脱机打印设备或一个数据库引擎访问点，此时如果在系统中为这些类创建多个对象就没有太大的实际意义。</p><p>如果一个类始终只能创建一个实例，则这个类被称为单例类。</p><p>在一些特殊场景下，要求不允许自由创建该类的对象，而只允许为该类创建一个对象。为了避免其他类自由创建该类的实例，我们把该类的构造器使用 private 修饰，从而把该类的所有构造器隐藏起来。</p><p>一旦把该类的构造器隐藏起来，就需要提供一个 public 方法作为该类的访问点，用于创建该类的对象，且该方法必须使用 static 修饰（因为调用该方法之前还不存在对象，因此调用该方法的不可能是对象，只能是类）。</p><p>除此之外，该类还必须缓存已经创建的对象，否则该类无法知道是否曾经创建过对象，也就无法保证只创建一个对象。为此该类需要使用一个成员变量来保存曾经创建的对象，因为该成员变量需要被上面的静态方法访问，故该成员变量必须使用 static 修饰。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token punctuation">{</span>
    <span class="token comment">// 使用一个变量来缓存曾经创建的实例</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> instance<span class="token punctuation">;</span>

    <span class="token comment">// 对构造器使用private修饰，隐藏该构造器</span>
    <span class="token keyword">private</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token comment">// 提供一个静态方法，用于返回Singleton实例</span>
    <span class="token comment">// 该方法可以加入自定义控制，保证只产生一个Singleton对象</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 如果instance为null，则表明还不曾创建Singleton对象</span>
        <span class="token comment">// 如果instance不为null，则表明已经创建了Singleton对象</span>
        <span class="token comment">// 将不会重新创建新的实例</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token comment">// 创建一个Singleton对象，并将其缓存起来</span>
            instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> instance<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SingletonTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 创建Singleton对象不能通过构造器</span>
        <span class="token comment">// 只能通过get Instance方法来得到实例</span>
        <span class="token class-name">Singleton</span> s1 <span class="token operator">=</span> <span class="token class-name">Singleton</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Singleton</span> s2 <span class="token operator">=</span> <span class="token class-name">Singleton</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 将输出true</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1 <span class="token operator">==</span> s2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>正是通过上面<code>getInstance</code>方法提供的自定义控制（这也是封装的优势：不允许自由访问类的 Field 和实现细节，而是通过方法来控制合适暴露），保证<code>Singleton</code>类只能产生一个实例。所以，在<code>SingletonTest</code>类的 main 方法中，看到两次产生的 Singleton 对象实际上是同一个对象。</p><h2 id="final-修饰符" tabindex="-1"><a class="header-anchor" href="#final-修饰符" aria-hidden="true">#</a> final 修饰符</h2><p>final 关键字可用于修饰类、变量和方法，final 关键字有点类似 C#里的 sealed 关键字，用于表示它修饰的类、方法和变量不可改变。</p><p>final 修饰变量时，表示该变量一旦获得了初始值就不可被改变，final 既可以修饰成员变量（包括类变量和实例 Z 变量），也可以修饰局部变量、形参。final 修饰的变量不可被改变，一旦获得了初始值，该 final 变量的值就不能被重新赋值。</p><p>因为 final 变量获得初始值之后不能被重新赋值，因此 final 修饰成员变量和修饰局部变量时有一定的不同。</p><h3 id="final-成员变量" tabindex="-1"><a class="header-anchor" href="#final-成员变量" aria-hidden="true">#</a> final 成员变量</h3><p>对于 final 修饰的成员变量而言，一旦有了初始值，就不能被重新赋值，如果既没有在定义成员变量时指定初始值，也没有在初始化块、构造器中为成员变量指定初始值，那么这些成员变量的值将一直是系统默认分配的 0、&#39;\u0000&#39;、false 或 null，这些成员变量也就完全失去了存在的意义。因此 Java 语法规定： ==final 修饰的成员变量必须由程序员显式地指定初始值==。</p><p>final 修饰的类 Field、实例 Field 能指定初始值的地方如下。</p><ol><li>类 Field：必须在静态初始化块中或声明该 Field 时指定初始值。</li><li>实例 Field：必须在非静态初始化块、声明该 Field 或构造器中指定初始值。</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FinalVariableTest</span> <span class="token punctuation">{</span>
    <span class="token comment">// 定义成员变量时指定默认值，合法</span>
    <span class="token keyword">final</span> <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>
    <span class="token comment">// 下面变量将在构造器或初始化块中分配初始值</span>
    <span class="token keyword">final</span> <span class="token class-name">String</span> str<span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token keyword">int</span> c<span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token keyword">double</span> d<span class="token punctuation">;</span>

    <span class="token comment">// 既没有指定默认值，又没有在初始化块、构造器中指定初始值</span>
    <span class="token comment">// 下面定义char Field是不合法的</span>
    <span class="token comment">// final char ch;</span>
    <span class="token comment">// 初始化块，可对没有指定默认值的实例Field指定初始值</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// 在初始化块中为实例Field指定初始值，合法</span>
        str <span class="token operator">=</span> <span class="token string">&quot;He1lo&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">// 定义a Field时已经指定了默认值</span>
        <span class="token comment">// 不能为a重新赋值，下面赋值语句非法</span>
        <span class="token comment">// a = 9;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 静态初始化块，可对没有指定默认值的类Field指定初始值</span>
    <span class="token keyword">static</span> <span class="token punctuation">{</span>
        <span class="token comment">// 在静态初始化块中为类Field指定初始值，合法</span>
        d <span class="token operator">=</span> <span class="token number">5.6</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 构造器，可对既没有指定默认值，又没有在初始化块中</span>
    <span class="token comment">// 指定初始值的实例Field指定初始值</span>
    <span class="token keyword">public</span> <span class="token class-name">FinalVariableTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 如果初始化块中对str指定了初始值</span>
        <span class="token comment">// 则构造器中不能对final变量重新赋值，下面赋值语句非法</span>
        <span class="token comment">// str = &quot;java&quot;;</span>
        c <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">changeFinal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 普通方法不能为final修饰的成员变量赋值</span>
        <span class="token comment">// d = 1.2;</span>
        <span class="token comment">// 不能在普通方法中为final成员变量指定初始值</span>
        <span class="token comment">// ch = &#39;a&#39;;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">FinalVariableTest</span> ft <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FinalVariableTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ft<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ft<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container tip"><p class="custom-container-title">提示</p><p>与普通成员变量不同的是，final 成员变量（包括实例 Field 和类 Field）必须由程序员显式初始化，系统不会对 final 成员进行隐式初始化。</p></div><p>如果打算在构造器、初始化块中对 final 成员变量进行初始化，则不要在初始化之前就访问成员变量的值。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FinalErrorTest</span> <span class="token punctuation">{</span>
    <span class="token comment">// 定义一个final修饰的Field</span>
    <span class="token comment">// 系统不会对final成员Field进行默认初始化</span>
    <span class="token keyword">final</span> <span class="token keyword">int</span> age<span class="token punctuation">;</span>

    <span class="token punctuation">{</span>
        <span class="token comment">// age没有初始化，所以此处代码将引起错误</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>
        age <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">FinalErrorTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="final-局部变量" tabindex="-1"><a class="header-anchor" href="#final-局部变量" aria-hidden="true">#</a> final 局部变量</h3><p>系统不会对局部变量进行初始化，局部变量必须由程序员显式初始化。因此使用 final 修饰局部变量时，既可以在定义时指定默认值，也可以不指定默认值。</p><p>如果 final 修饰的局部变量在定义时没有指定默认值，则可以在后面代码中对该 final 变量赋初始值，但只能一次，不能重复赋值；如果 final 修饰的局部变量在定义时已经指定默认值，则后面代码中不能再对该变量赋值。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FinalLocalVariableTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token keyword">int</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 不能对final修饰的形参赋值，下面语句非法</span>
        <span class="token comment">// a = 5;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 定义final局部变量时指定默认值，则str变量无法重新赋值</span>
        <span class="token keyword">final</span> <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">// 下面赋值语句非法</span>
        <span class="token comment">// str =&quot; Java&quot;;</span>
        <span class="token comment">// 定义final局部变量时没有指定默认值，则d变量可被赋值一次</span>
        <span class="token keyword">final</span> <span class="token keyword">double</span> d<span class="token punctuation">;</span>
        <span class="token comment">// 第一次赋初始值，成功</span>
        d <span class="token operator">=</span> <span class="token number">5.6</span><span class="token punctuation">;</span>
        <span class="token comment">// 对final变量重复赋值，下面语句非法</span>
        <span class="token comment">// d = 3.4;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="final-修饰基本类型变量和引用类型变量的区别" tabindex="-1"><a class="header-anchor" href="#final-修饰基本类型变量和引用类型变量的区别" aria-hidden="true">#</a> final 修饰基本类型变量和引用类型变量的区别</h3><p>当使用 final 修饰基本类型变量时，不能对基本类型变量重新赋值，因此基本类型变量不能被改变。但对于引用类型变量而言，它保存的仅仅是一个引用，final 只保证这个引用类型变量所引用的地址不会改变，即一直引用同一个对象，但这个对象完全可以发生改变。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> age<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token comment">// 有参数构造器</span>
    <span class="token keyword">public</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token keyword">int</span> age<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> age<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setAge</span><span class="token punctuation">(</span><span class="token keyword">int</span> age<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FinalReferenceTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// final修饰数组变量，iArr是一个引用变量</span>
        <span class="token keyword">final</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> iArr <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>iArr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 对数组元素进行排序，合法</span>
        <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>iArr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>iArr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 对数组元素赋值，合法</span>
        iArr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">;</span>
        <span class="token comment">// final修饰</span>
        <span class="token keyword">final</span> <span class="token class-name">Person</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 改变Person对象的age Field，合法</span>
        p<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">23</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 下面语句对p重新赋值，非法</span>
        <span class="token comment">// p=null;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="可执行-宏替换-的-final-变量" tabindex="-1"><a class="header-anchor" href="#可执行-宏替换-的-final-变量" aria-hidden="true">#</a> 可执行“宏替换”的 final 变量</h3><p>对一个 final 变量来说，不管它是类 Field、实例 Field，还是局部变量，只要该变量满足 3 个条件，这个 final 变量就不再是一个变量，而是相当于一个直接量。</p><ol><li>使用 final 修饰符修饰；</li><li>在定义该 final 变量时指定了初始值；</li><li>该初始值可以在编译时就被确定下来。</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FinalLocalTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 定义一个普通局部变量</span>
        <span class="token keyword">final</span> <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>对于这个程序来说，变量 a 其实根本不存在，当程序执行<code>System.out.println(a);</code>代码时，实际转换为执行<code>System.out.println(5)</code>。</p><p>除了上面那种为 final 变量赋值时赋直接量的情况外，如果被赋的表达式只是基本的算术表达式或字符串连接运算，没有访问普通变量，调用方法，Java 编译器同样会将这种 final 变量当成“宏变量”处理。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FinalReplaceTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 下面定义了4个final“宏变量”</span>
        <span class="token keyword">final</span> <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">5</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token keyword">double</span> b <span class="token operator">=</span> <span class="token number">1.2</span> <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">&quot;疯狂&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;Java&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token class-name">String</span> book <span class="token operator">=</span> <span class="token string">&quot;疯狂Java讲义:&quot;</span> <span class="token operator">+</span> <span class="token number">99.0</span><span class="token punctuation">;</span>
        <span class="token comment">// 下面的book2变量的值因为调用了方法，所以无法在编译时被确定下来</span>
        <span class="token comment">// ①</span>
        <span class="token keyword">final</span> <span class="token class-name">String</span> book2 <span class="token operator">=</span> <span class="token string">&quot;疯狂Java讲义:&quot;</span> <span class="token operator">+</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token number">99.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>book <span class="token operator">==</span> <span class="token string">&quot;疯狂Java讲义:99.0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>book2 <span class="token operator">==</span> <span class="token string">&quot;疯狂Java讲义:99.0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>从表面上看，① 行代码定义的 book2 与 book 没有太大的区别，只是定义 book2 变量时显式将数值 99.0 转换为字符串，但由于该变量的值需要调用 String 类的方法，因此编译器无法在编译时确定 book2 的值，book2 不会被当成“宏变量”处理。</p><p>程序最后两行代码分别判断 book、book2 和“疯狂 Java 讲义：99.0”是否相等。由于 book 是一个“宏变量”，它将被直接替换成“疯狂 Java 讲义：99.0”，因此 book 和“疯狂 Java 讲义：99.0”相等，但 book2 和该字符串不相等。</p><div class="custom-container tip"><p class="custom-container-title">提示</p><p>Java 会使用常量池来管理曾经用过的字符串直接量，例如执行 String a=&quot;java&quot;;语句之后，系统的字符串池中就会缓存一个字符串&quot; java &quot;；如果程序再次执行 String b=&quot;java&quot;;，系统将会让 b 直接指向字符串池中的&quot;java&quot;字符串，因此 a==b 将会返回 true。</p></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StringJoinTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> s1 <span class="token operator">=</span> <span class="token string">&quot;疯狂Java&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">// s2变量引用的字符串可以在编译时就确定下来</span>
        <span class="token comment">// 因此引用常量池中已有的&quot;疯狂Java&quot;字符串</span>
        <span class="token class-name">String</span> s2 <span class="token operator">=</span> <span class="token string">&quot;疯狂&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;Java&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1 <span class="token operator">==</span> s2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 定义2个字符串直接量</span>
        <span class="token class-name">String</span> str1 <span class="token operator">=</span> <span class="token string">&quot;疯狂&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">// ①</span>
        <span class="token class-name">String</span> str2 <span class="token operator">=</span> <span class="token string">&quot;Java&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">// ②</span>
        <span class="token comment">// 将str1和str2进行连接运算</span>
        <span class="token class-name">String</span> s3 <span class="token operator">=</span> str1 <span class="token operator">+</span> str2<span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1 <span class="token operator">==</span> s3<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>s1 是一个普通的字符串直接量“疯狂 Java”，s2 的值是两个字符串直接量进行连接运算，由于编译器可以在编译阶段就确定 s2 的值为“疯狂 Java”，所以系统会让 s2 直接指向字符串池中缓存的“疯狂 Java”字符串。由此可见，s1==s2 将输出 true。</p><p>对于 s3 而言，它的值由 str1 和 str2 进行连接运算后得到。由于 str1、str2 是两个普通变量，编译器不会执行“宏替换”，因此编译器无法在编译时确定 s3 的值，也就无法让 s3 指向字符串池中缓存的“疯狂 Java”。由此可见，s1==s3 将输出 false。</p><p>让 s1==s3 输出 true 也很简单，只要让编译器可以对 str1、str2 两个变量执行“宏替换”，这样编译器即可在编译阶段就确定 s3 的值，就会让 s3 指向字符串池中缓存的“疯狂 Java”。只要将 ①、② 两行代码所定义的 str1、str2 使用 final 修饰即可。</p><div class="custom-container tip"><p class="custom-container-title">提示</p><p>对于实例变量而言，既可以在定义该变量时赋初始值，也可以在非静态初始化块、构造器中对它赋初始值，在这 3 个地方指定初始值的效果基本一样。但对于 final 实例变量而言，只有在定义该变量时指定初始值才会有“宏变量”的效果。</p></div><h3 id="final-方法" tabindex="-1"><a class="header-anchor" href="#final-方法" aria-hidden="true">#</a> final 方法</h3><p>final 修饰的方法不可被重写，如果出于某些原因，不希望子类重写父类的某个方法，则可以使用 final 修饰该方法。</p><p>java 提供的 Object 类里就有一个 final 方法：<code>getClass()</code>，因为 Java 不希望任何类重写这个方法，所以使用 final 把这个方法密封起来。但对于该类提供的<code>toString()</code>和<code>equals()</code>方法，都允许子类重写，因此没有使用 final 修饰它们。</p><p>试图重写 final 方法，将会引发编译错误。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FinalMethodTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Sub</span> <span class="token keyword">extends</span> <span class="token class-name">FinalMethodTest</span> <span class="token punctuation">{</span>
    <span class="token comment">// 下面方法定义将出现编译错误，不能重写final方法</span>
    <span class="token comment">// public void test() {}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>对于一个 private 方法，因为它仅在当前类中可见，其子类无法访问该方法，所以子类无法重写该方法——如果子类中定义一个与父类 private 方法有相同方法名、相同形参列表、相同返回值类型的方法，也不是方法重写，只是重新定义了一个新方法。</p><p>因此，即使使用 final 修饰一个 private 访问权限的方法，依然可以在其子类中定义与该方法具有相同方法名、相同形参列表、相同返回值类型的方法。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PrivateFinalMethodTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Sub</span> <span class="token keyword">extends</span> <span class="token class-name">PrivateFinalMethodTest</span> <span class="token punctuation">{</span>
    <span class="token comment">// 下面的方法定义不会出现问题</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>final 修饰的方法仅仅是不能被重写，并不是不能被重载。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Final0verload</span> <span class="token punctuation">{</span>
    <span class="token comment">// final修饰的方法只是不能被重写，完全可以被重载</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token class-name">String</span> arg<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="final-类" tabindex="-1"><a class="header-anchor" href="#final-类" aria-hidden="true">#</a> final 类</h3><p>final 修饰的类不可以有子类，例如<code>java.lang.Math</code>类就是一个 final 类，它不可以有子类。</p><p>为了保证某个类不可被继承，则可以使用 final 修饰这个类。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">FinalClass</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token comment">//下面的类定义将出现编译错误</span>
<span class="token keyword">class</span> <span class="token class-name">Sub</span> <span class="token keyword">extends</span> <span class="token class-name">FinalClass</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="不可变类" tabindex="-1"><a class="header-anchor" href="#不可变类" aria-hidden="true">#</a> 不可变类</h3><p>不可变（immutable）类的意思是创建该类的实例后，该实例的 Field 是不可改变的。Java 提供的 8 个包装类和<code>java.lang.String</code>类都是不可变类，当创建它们的实例后，其实例的 Field 不可改变。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Double</span> d <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Double</span><span class="token punctuation">(</span><span class="token number">6.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>上面程序创建了一个 Double 对象和一个 String 对象，并为这个两对象传入了 6.5 和&quot;Hello&quot;字符串作为参数，那么 Double 类和 String 类肯定需要提供实例 Field 来保存这两个参数，但程序无法修改这两个实例 Field 值，因此 Double 类和 String 类没有提供修改它们的方法。</p><p>如果需要创建自定义的不可变类，可遵守如下规则。</p><ol><li>使用 private 和 final 修饰符来修饰该类的 Field。</li><li>提供带参数构造器，用于根据传入参数来初始化类里的 Field。</li><li>仅为该类的 Field 提供 getter 方法，不要为该类的 Field 提供 setter 方法，因为普通方法无法修改 final 修饰的 Field。</li><li>如果有必要，重写 Object 类的<code>hashCode</code>和<code>equals</code>方法。<code>equals</code>方法以关键 Field 来作为判断两个对象是否相等的标准，除此之外，还应该保证两个用<code>equals</code>方法判断为相等的对象的<code>hashCode</code>也相等。</li></ol><p><code>java.lang.String</code>这个类就做得很好，它就是根据 String 对象里的字符序列来作为相等的标准，其<code>hashCode</code>方法也是根据字符序列计算得到的。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ImmutableStringTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> str1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> str2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 输出false</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str1 <span class="token operator">==</span> str2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 输出true</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str1<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>str2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 下面两次输出的hashCode相同</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str1<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str2<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>定义一个不可变的 Address 类，程序把 Address 类的 detail 和 postCode 成员变量都使用 private 隐藏起来，并使用 final 修饰这两个成员变量，不允许其他方法修改这两个 Field 值。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Address</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> detail<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> postCode<span class="token punctuation">;</span>

    <span class="token comment">// 在构造器里初始化两个实例Field</span>
    <span class="token keyword">public</span> <span class="token class-name">Address</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>detail <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>postCode <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Address</span><span class="token punctuation">(</span><span class="token class-name">String</span> detail<span class="token punctuation">,</span> <span class="token class-name">String</span> postCode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>detail <span class="token operator">=</span> detail<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>postCode <span class="token operator">=</span> postCode<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> detail<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> postCode<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">31</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 重写equals方法，判断两个对象是否相等</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">==</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> obj<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">Address</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Address</span> ad <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Address</span><span class="token punctuation">)</span>obj<span class="token punctuation">;</span>
            <span class="token comment">// 当detail和postCode相等时，可认为两个Address对象相等</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getDetail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>ad<span class="token punctuation">.</span><span class="token function">getDetail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getPostCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>ad<span class="token punctuation">.</span><span class="token function">getPostCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 仅为两个实例Field提供getter方法</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getDetail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>detail<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getPostCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>postCode<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>当使用 final 修饰引用类型变量时，仅表示这个引用类型变量不可被重新赋值，但引用类型变量所指向的对象依然可改变。这就产生了一个问题：当创建不可变类时，如果它包含 Field 的类型是可变的，那么其对象的 Field 值依然是可改变的——这个不可变类其实是失败的。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Name</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> firstName<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> lastName<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Name</span><span class="token punctuation">(</span><span class="token class-name">String</span> firstName<span class="token punctuation">,</span> <span class="token class-name">String</span> lastName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>firstName <span class="token operator">=</span> firstName<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>lastName <span class="token operator">=</span> lastName<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setFirstName</span><span class="token punctuation">(</span><span class="token class-name">String</span> firstName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>firstName <span class="token operator">=</span> firstName<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getFirstName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>firstName<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setLastName</span><span class="token punctuation">(</span><span class="token class-name">String</span> lastName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>lastName <span class="token operator">=</span> lastName<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getLastName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lastName<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Name</span> name<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token class-name">Name</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Name</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Name</span> n <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Name</span><span class="token punctuation">(</span><span class="token string">&quot;悟空&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;孙&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Person</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Person对象的name的firstName值为&quot;悟空”</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFirstName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 改变Person对象的name的firstName值</span>
        n<span class="token punctuation">.</span><span class="token function">setFirstName</span><span class="token punctuation">(</span><span class="token string">&quot;八戒&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Person对象的name的firstName值被改为&quot;八戒”</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFirstName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>为了保持 Person 对象的不可变性，必须保护好 Person 对象的引用类型 Field：name，让程序无法访问到 Person 对象的 name Field，也就无法利用 name Field 的可变性来改变 Person 对象了。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Name</span> name<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token class-name">Name</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 设置name Field为临时创建的Name对象，该对象的firstName和lastName</span>
        <span class="token comment">// 与传入的name对象的firstName和lastName相同</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Name</span><span class="token punctuation">(</span>name<span class="token punctuation">.</span><span class="token function">getFirstName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> name<span class="token punctuation">.</span><span class="token function">getLastName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Name</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 返回一个匿名对象，该对象的firstName和lastName</span>
        <span class="token comment">// 与该对象里的name的firstName和lastName相同</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Name</span><span class="token punctuation">(</span>name<span class="token punctuation">.</span><span class="token function">getFirstName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> name<span class="token punctuation">.</span><span class="token function">getLastName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>当程序向 Person 构造器里传入一个 Name 对象时，该构造器创建 Person 对象时并不是直接利用已有的 Name 对象，而是重新创建了一个 Name 对象来赋给 Person 对象的 name Field。</p><p>当 Person 对象返回 name Field 时，它并没有直接把 name Field 返回，直接返回 name Field 的值也可能导致它所引用的 Name 对象被修改。</p><p>如果需要设计一个不可变类，尤其要注意其引用类型 Field，如果引用类型 Field 的类是可变的，就必须采取必要的措施来保护该 Field 所引用的对象不会被修改，这样才能创建真正的不可变类。</p><h3 id="缓存实例的不可变类" tabindex="-1"><a class="header-anchor" href="#缓存实例的不可变类" aria-hidden="true">#</a> 缓存实例的不可变类</h3><p>不可变类的实例状态不可改变，可以很方便地被多个对象所共享。如果程序经常需要使用相同的不可变类实例，则应该考虑缓存这种不可变类的实例。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">CacheImmutale</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token constant">MAX_SIZE</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token comment">// 使用数组来缓存已有的实例</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">CacheImmutale</span><span class="token punctuation">[</span><span class="token punctuation">]</span> cache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CacheImmutale</span><span class="token punctuation">[</span><span class="token constant">MAX_SIZE</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// 记录缓存实例在缓存中的位置，cache[pos-1]是最新缓存的实例</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> pos <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">CacheImmutale</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">CacheImmutale</span> <span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 遍历已缓存的对象，</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token constant">MAX_SIZE</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 如果已有相同实例，则直接返回该缓存的实例</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>cache<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> cache<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> cache<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 如果缓存池已满</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>pos <span class="token operator">==</span> <span class="token constant">MAX_SIZE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 把缓存的第一个对象覆盖，即把刚刚生成的对象放在缓存池的最开始位置</span>
            cache<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CacheImmutale</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token comment">// 把pos设为1</span>
            pos <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// 把新创建的对象缓存起来，pos加1</span>
            cache<span class="token punctuation">[</span>pos<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CacheImmutale</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> cache<span class="token punctuation">[</span>pos <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> name<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">==</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> obj<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">CacheImmutale</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">CacheImmutale</span> ci <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">CacheImmutale</span><span class="token punctuation">)</span>obj<span class="token punctuation">;</span>
            <span class="token keyword">return</span> name<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>ci<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CacheImmutaleTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">CacheImmutale</span> c1 <span class="token operator">=</span> <span class="token class-name">CacheImmutale</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CacheImmutale</span> c2 <span class="token operator">=</span> <span class="token class-name">CacheImmutale</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 下面代码将输出true</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>c1 <span class="token operator">==</span> c2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>当使用<code>CacheImmutale</code>类的<code>valueOf</code>方法来生成对象时，系统是否重新生成新的对象，取决于数组内是否已经存在该对象。如果该数组中已经缓存了该类的对象，系统将不会重新生成对象。</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202207122115868.jpeg" alt="img"></p><div class="custom-container tip"><p class="custom-container-title">提示</p><p>是否需要隐藏<code>CacheImmutale</code>类的构造器完全取决于系统需求。盲目乱用缓存也可能导致系统性能下降，缓存的对象会占用系统内存，如果某个对象只使用一次，重复使用的概率不大，缓存该实例就弊大于利；反之，如果某个对象需要频繁地重复使用，缓存该实例就利大于弊。</p></div><p>例如 Java 提供的<code>java.lang.Integer</code>类，它就采用了与<code>CacheImmutale</code>类相同的处理策略，如果采用 new 构造器来创建 Integer 对象，则每次返回全新的 Integer 对象；如果采用<code>valueOf</code>方法来创建 Integer 对象，则会缓存该方法创建的对象。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IntegerCacheTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 生成新的Integer对象</span>
        <span class="token class-name">Integer</span> in1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 生成新的Integer对象，并缓存该对象</span>
        <span class="token class-name">Integer</span> in2 <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 直接从缓存中取出Integer对象</span>
        <span class="token class-name">Integer</span> in3 <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 输出false</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>in1 <span class="token operator">==</span> in2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 输出true</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>in2 <span class="token operator">==</span> in3<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 由于Integer只缓存-128~127之间的值</span>
        <span class="token comment">// 因此200对应的Integer对象没有被缓存</span>
        <span class="token class-name">Integer</span> in4 <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Integer</span> in5 <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 输出false</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>in4 <span class="token operator">==</span> in5<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="抽象类" tabindex="-1"><a class="header-anchor" href="#抽象类" aria-hidden="true">#</a> 抽象类</h2><p>在某些情况下，某个父类只是知道其子类应该包含怎样的方法，但无法准确地知道这些子类如何实现这些方法。例如定义了一个<code>Shape</code>类，这个类应该提供一个计算周长的方法<code>calPerimeter()</code>，但不同<code>Shape</code>子类对周长的计算方法是不一样的，即<code>Shape</code>类无法准确地知道其子类计算周长的方法。</p><p>如何既能让 Shape 类里包含<code>calPerimeter()</code>方法，又无须提供其方法实现呢？使用抽象方法即可满足该要求：抽象方法是只有方法签名，没有方法实现的方法。</p><h3 id="抽象方法和抽象类" tabindex="-1"><a class="header-anchor" href="#抽象方法和抽象类" aria-hidden="true">#</a> 抽象方法和抽象类</h3><p>抽象方法和抽象类必须使用<code>abstract</code>修饰符来定义，有抽象方法的类只能被定义成抽象类，抽象类里可以没有抽象方法。</p><p>抽象方法和抽象类的规则如下。</p><ol><li>抽象类必须使用 abstract 修饰符来修饰，抽象方法也必须使用 abstract 修饰符来修饰，抽象方法不能有方法体。</li><li>抽象类不能被实例化，无法使用 new 关键字来调用抽象类的构造器创建抽象类的实例。即使抽象类里不包含抽象方法，这个抽象类也不能创建实例。</li><li>抽象类可以包含 Field、方法（普通方法和抽象方法都可以）、构造器、初始化块、内部类、枚举类 6 种成分。抽象类的构造器不能用于创建实例，主要是用于被其子类调用。</li><li>含有抽象方法的类（包括直接定义了一个抽象方法；继承了一个抽象父类，但没有完全实现父类包含的抽象方法，以及实现了一个接口，但没有完全实现接口包含的抽象方法 3 种情况）只能被定义成抽象类。</li></ol><p>定义抽象方法只需在普通方法上增加 abstract 修饰符，并把普通方法的方法体（也就是方法后花括号括起来的部分）全部去掉，并在方法后增加分号即可。</p><div class="custom-container tip"><p class="custom-container-title">提示</p><p>抽象方法和空方法体的方法不是同一个概念。例如，<code>public abstract void test();</code>是一个抽象方法，它根本没有方法体，即方法定义后面没有一对花括号；但<code>public void test(){}</code>方法是一个普通方法，它已经定义了方法体，只是方法体为空，即它的方法体什么也不做，因此这个方法不可使用 abstract 来修饰。</p></div><p>一个普通类（没有包含抽象方法的类）增加 abstract 修饰符后也将变成抽象类。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Shape</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> color<span class="token punctuation">;</span>

    <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;执行Shape的初始化块...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 定义Shape的构造器，该构造器并不是用于创建Shape对象</span>
    <span class="token comment">// 而是用于被子类调用</span>
    <span class="token keyword">public</span> <span class="token class-name">Shape</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Shape</span><span class="token punctuation">(</span><span class="token class-name">String</span> color<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;执行Shape的构造器...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>color <span class="token operator">=</span> color<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 定义一个计算周长的抽象方法</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">double</span> <span class="token function">calPerimeter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 定义一个返回形状的抽象方法</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name">String</span> <span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的 Shape 类里包含了两个抽象方法：<code>calPerimeter()</code>和<code>getType()</code>，所以这个 Shape 类只能被定义成抽象类。Shape 类里既包含了初始化块，也包含了构造器，==这些都不是在创建 Shape 对象时被调用的，而是在创建其子类的实例时被调用==。</p><p>抽象类不能用于创建实例，只能当作父类被其他子类继承。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Triangle</span> <span class="token keyword">extends</span> <span class="token class-name">Shape</span> <span class="token punctuation">{</span>
    <span class="token comment">// 定义三角形的三边</span>
    <span class="token keyword">private</span> <span class="token keyword">double</span> a<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">double</span> b<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">double</span> c<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Triangle</span><span class="token punctuation">(</span><span class="token class-name">String</span> color<span class="token punctuation">,</span> <span class="token keyword">double</span> a<span class="token punctuation">,</span> <span class="token keyword">double</span> b<span class="token punctuation">,</span> <span class="token keyword">double</span> c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>color<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setSides</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setSides</span><span class="token punctuation">(</span><span class="token keyword">double</span> a<span class="token punctuation">,</span> <span class="token keyword">double</span> b<span class="token punctuation">,</span> <span class="token keyword">double</span> c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token operator">&gt;=</span> b <span class="token operator">+</span> c <span class="token operator">||</span> b <span class="token operator">&gt;=</span> a <span class="token operator">+</span> c <span class="token operator">||</span> c <span class="token operator">&gt;=</span> a <span class="token operator">+</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;三角形两边之和必须大于第三边&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">=</span> a<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>b <span class="token operator">=</span> b<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>c <span class="token operator">=</span> c<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 重写Shape类的计算周长的抽象方法</span>
    <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">calPerimeter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> a <span class="token operator">+</span> b <span class="token operator">+</span> c<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 重写Shape类的返回形状的抽象方法</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;三角形&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>再定义一个 Circle 普通类，Circle 类也是 Shape 类的一个子类。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Circle</span> <span class="token keyword">extends</span> <span class="token class-name">Shape</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">double</span> radius<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Circle</span><span class="token punctuation">(</span><span class="token class-name">String</span> color<span class="token punctuation">,</span> <span class="token keyword">double</span> radius<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>color<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>radius <span class="token operator">=</span> radius<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setRadius</span><span class="token punctuation">(</span><span class="token keyword">double</span> radius<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>radius <span class="token operator">=</span> radius<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 重写Shape类的计算周长的抽象方法</span>
    <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">calPerimeter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> radius<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 重写Shape类的返回形状的抽象方法</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">getColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;圆形&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Shape</span> s1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Triangle</span><span class="token punctuation">(</span><span class="token string">&quot;黑色&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Shape</span> s2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Circle</span><span class="token punctuation">(</span><span class="token string">&quot;黄色&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1<span class="token punctuation">.</span><span class="token function">calPerimeter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s2<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s2<span class="token punctuation">.</span><span class="token function">calPerimeter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>主方法中定义了两个 Shape 类型的引用变量，它们分别指向 Triangle 对象和 Circle 对象。由于在 Shape 类中定义了<code>calPerimeter()</code>方法和<code>getType()</code>方法，所以程序可以直接调用 s1 变量和 s2 变量的<code>calPerimeter()</code>方法和<code>getType()</code>方法，无须强制类型转换为其子类类型。</p><p>当使用 abstract 修饰类时，表明这个类只能被继承；当使用 abstract 修饰方法时，表明这个方法必须由子类提供实现（即重写）。而 final 修饰的类不能被继承，final 修饰的方法不能被重写。因此 final 和 abstract 永远不能同时使用。</p><div class="custom-container tip"><p class="custom-container-title">提示</p><p>abstract 不能用于修饰 Field，不能用于修饰局部变量，即没有抽象变量、没有抽象 Field 等说法；abstract 也不能用于修饰构造器，没有抽象构造器，抽象类里定义的构造器只能是普通构造器。</p></div><p>除此之外，当使用 static 修饰一个方法时，表明这个方法属于该类本身，即通过类就可调用该方法，但如果该方法被定义成抽象方法，则将导致通过该类来调用该方法时出现错误（调用了一个没有方法体的方法肯定会引起错误）。因此 static 和 abstract 不能同时修饰某个方法，即没有所谓的类抽象方法。</p><div class="custom-container tip"><p class="custom-container-title">提示</p><p>abstract 关键字修饰的方法必须被其子类重写才有意义，否则这个方法将永远不会有方法体，因此 abstract 方法不能定义为 private 访问权限，即 private 和 abstract 不能同时使用。</p></div><h3 id="抽象类的作用" tabindex="-1"><a class="header-anchor" href="#抽象类的作用" aria-hidden="true">#</a> 抽象类的作用</h3><p>抽象类是从多个具体类中抽象出来的父类，它具有更高层次的抽象。从多个具有相同特征的类中抽象出一个抽象类，以这个抽象类作为其子类的模板，从而避免了子类设计的随意性。</p><p>抽象类体现的就是一种模板模式的设计，抽象类作为多个子类的通用模板，子类在抽象类的基础上进行扩展、改造，但子类总体上会大致保留抽象类的行为方式。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">SpeedMeter</span> <span class="token punctuation">{</span>
    <span class="token comment">// 转速</span>
    <span class="token keyword">private</span> <span class="token keyword">double</span> turnRate<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">SpeedMeter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 把返回车轮半径的方法定义成抽象方法</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">double</span> <span class="token function">getRadius</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setTurnRate</span><span class="token punctuation">(</span><span class="token keyword">double</span> turnRate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>turnRate <span class="token operator">=</span> turnRate<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 定义计算速度的通用算法</span>
    <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">getSpeed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 速度等于车轮半径*2*PI*转速</span>
        <span class="token keyword">return</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Math</span><span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token function">getRadius</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> turnRate<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>程序定义了一个抽象的<code>SpeedMeter</code>类（车速表），该表里定义了一个<code>getSpeed</code>方法，该方法用于返回当前车速，<code>getSpeed</code>方法依赖于<code>getRadius</code>方法的返回值。对于一个抽象的<code>SpeedMeter</code>类而言，它无法确定车轮的半径，因此<code>getRadius</code>方法必须推迟到其子类中实现。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CarSpeedMeter</span> <span class="token keyword">extends</span> <span class="token class-name">SpeedMeter</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">getRadius</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">0.28</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">CarSpeedMeter</span> csm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CarSpeedMeter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        csm<span class="token punctuation">.</span><span class="token function">setTurnRate</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>csm<span class="token punctuation">.</span><span class="token function">getSpeed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>模板模式在面向对象的软件中很常用，其原理简单，实现也很简单。下面是使用模板模式的一些简单规则。</p><ol><li>抽象父类可以只定义需要使用的某些方法，把不能实现的部分抽象成抽象方法，留给其子类去实现。</li><li>父类中可能包含需要调用的其他系列方法的方法，这些被调方法既可以由父类实现，也可以由其子类实现。父类里提供的方法只是定义了一个通用算法，其实现也许并不完全由自身实现，而必须依赖于其子类的辅助。</li></ol><h2 id="接口" tabindex="-1"><a class="header-anchor" href="#接口" aria-hidden="true">#</a> 接口</h2><p>接口里不能包含普通方法，接口里的所有方法都是抽象方法。</p><h3 id="接口的概念" tabindex="-1"><a class="header-anchor" href="#接口的概念" aria-hidden="true">#</a> 接口的概念</h3><p>接口是从多个相似类中抽象出来的规范，接口不提供任何实现。接口体现的是规范和实现分离的设计哲学。</p><p>经常听说接口，比如 PCI 接口、AGP 接口等，不是指主机板上的插槽。当我们说 PCI 接口时，指的是主机板上那个插槽遵守了 PCI 规范，而具体的 PCI 插槽只是 PCI 接口的实例。</p><p>对于不同型号的主机板而言，它们各自的 PCI 插槽都需要遵守一个规范，遵守这个规范就可以保证插入该插槽里的板卡能与主机板正常通信。对于同一个型号的主机板而言，它们的 PCI 插槽需要有相同的数据交换方式、相同的实现细节，它们都是同一个类的不同实例。</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202207131503020.jpeg" alt="img"></p><p>接口定义的是多个类共同的公共行为规范，这些行为是与外部交流的通道，这就意味着接口里通常是定义一组公用方法。</p><h3 id="接口的定义" tabindex="-1"><a class="header-anchor" href="#接口的定义" aria-hidden="true">#</a> 接口的定义</h3><p>定义接口不再使用 class 关键字，而是使用 interface 关键字。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token punctuation">[</span>修饰符<span class="token punctuation">]</span> <span class="token keyword">interface</span> 接口名 <span class="token keyword">extends</span> 父接口<span class="token number">1</span>，父接口<span class="token number">2.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">{</span>
    零个到多个常量定义<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    零个到多个抽象方法定义<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li>修饰符可以是 public 或者省略，如果省略了 public 访问控制符，则默认采用包权限访问控制符，即只有在相同包结构下才可以访问该接口。</li><li>接口名应与类名采用相同的命名规则，即如果仅从语法角度来看，接口名只要是合法的标识符即可；如果要遵守 Java 可读性规范，则接口名应由多个有意义的单词连缀而成，每个单词首字母大写，单词与单词之间无须任何分隔符。</li><li>一个接口可以有多个直接父接口，但接口只能继承接口，不能继承类。</li></ol><p>由于接口定义的是一种规范，因此接口里不能包含构造器和初始化块定义。接口里可以包含 Field （只能是常量）、方法（只能是抽象实例方法）、内部类（包括内部接口、枚举）定义。而且接口里的 Field 只能是常量，接口里的方法只能是抽象方法。</p><p>口里定义的是多个类共同的公共行为规范，因此接口里的所有成员，包括常量、方法、内部类和枚举类都是 public 访问权限。</p><p>定义接口成员时，可以省略访问控制修饰符，如果指定访问控制修饰符，则只能使用 public 访问控制修饰符。</p><p>在接口中定义 Field 时，不管是否使用 public static final 修饰符，接口里的 Field 总将使用这三个修饰符来修饰。而且，接口里没有构造器和初始化块，因此接口里定义的 Field 只能在定义时指定默认值。</p><p>接口里定义 Field 采用如下两行代码的结果完全一样。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//系统自动为接口里定义的Field增加public static final修饰符</span>
<span class="token keyword">int</span> <span class="token constant">MAX_SIZE</span><span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">MAX_SIZE</span><span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>对于接口里定义的方法而言，它们只能抽象方法，因此系统会自动为其增加 abstract 修饰符；</p><p>由于接口里的方法全部是抽象方法，因此接口里不允许定义静态方法，即不可使用 static 修饰接口里定义的方法。</p><p>不管定义接口里方法时是否使用 public abstract 修饰符，接口里的方法总是使用 public abstract 来修饰。</p><div class="custom-container tip"><p class="custom-container-title">提示</p><p>接口里定义的内部类、接口、枚举类默认都采用 public static 两个修饰符，不管定义时是否指定这两个修饰符，系统都会自动使用 public static 对它们进行修饰。</p></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">lee</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Output</span> <span class="token punctuation">{</span>
    <span class="token comment">//接口里定义的Field只能是常量</span>
    <span class="token keyword">int</span> <span class="token constant">MAX_CACHE_LINE</span> <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span>
    <span class="token comment">//接口里定义的只能是public的抽象实例方法</span>
    <span class="token keyword">void</span> <span class="token function">out</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这个接口里包含了一个常量 Field：<code>MAX_CACHE_LINE</code>，还定义了两个方法：表示取得数据的<code>getData()</code>方法和表示输出的<code>out()</code>方法。</p><p>这就定义了 Output 接口的规范：只要某个类能取得数据，并可以将数据输出，那它就是一个输出设备，至于这个设备的实现细节，这里暂时不关心。</p><p>接口里的 Field 默认是使用 public static final 修饰的，因此即使另一个类处于不同包下，也可以通过接口来访问接口里的常量 Field。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">yeeku</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OutputPropertyTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 访问另一个包中的0utput接口的MAX_CACHE_LINE</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">lee<span class="token punctuation">.</span></span>Output</span><span class="token punctuation">.</span><span class="token constant">MAX_CACHE_LINE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 下面语句将引起&quot;为final变量赋值&quot;的编译异常</span>
        <span class="token comment">// lee.Output.MAX_CACHE_LINE=2O;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container tip"><p class="custom-container-title">提示</p><p>从某个角度来看，接口可被当成一个特殊的类，因此一个 Java 源文件里最多只能有一个 public 接口，如果一个 Java 源文件里定义了一个 public 接口，则该源文件的主文件名必须与该接口名相同。</p></div><h3 id="接口的继承" tabindex="-1"><a class="header-anchor" href="#接口的继承" aria-hidden="true">#</a> 接口的继承</h3><p>接口的继承和类继承不一样，接口完全支持多继承，即一个接口可以有多个直接父接口。和类继承相似，子接口扩展某个父接口，将会获得父接口里定义的所有抽象方法、常量 Field、内部类和枚举类定义。</p><p>一个接口继承多个父接口时，多个父接口排在 extends 关键字之后，多个父接口之间以英文逗号<code>,</code>隔开。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">interface</span> interfaceA <span class="token punctuation">{</span>
    <span class="token keyword">int</span> <span class="token constant">PROP_A</span> <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">testA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> interfaceB <span class="token punctuation">{</span>
    <span class="token keyword">int</span> <span class="token constant">PROP_B</span> <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">testB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> interfaceC <span class="token keyword">extends</span> interfaceA<span class="token punctuation">,</span> interfaceB <span class="token punctuation">{</span>
    <span class="token keyword">int</span> <span class="token constant">PROP_C</span> <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">testC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">InterfaceExtendsTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>interfaceC<span class="token punctuation">.</span><span class="token constant">PROP_A</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>interfaceC<span class="token punctuation">.</span><span class="token constant">PROP_B</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>interfaceC<span class="token punctuation">.</span><span class="token constant">PROP_C</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>interfaceC</code>接口继承了<code>interfaceA</code>和<code>interfaceB</code>，所以<code>interfaceC</code>中获得了它们的常量 Field，因此在 main 方法中看到通过<code>interfaceC</code>来访问 PROP_A、PROP_B 和 PROP_C 常量。</p><h3 id="使用接口" tabindex="-1"><a class="header-anchor" href="#使用接口" aria-hidden="true">#</a> 使用接口</h3><p>接口不能用于创建实例，但接口可以用于声明引用类型变量。当使用接口来声明引用类型变量时，这个引用类型变量必须引用到其实现类的对象。除此之外，接口的主要用途就是被实现类实现。</p><p>一个类可以实现一个或多个接口，继承使用 extends 关键字，实现则使用 implements 关键字。因为一个类可以实现多个接口，这也是 Java 为单继承灵活性不足所做的补充。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token punctuation">[</span>修饰符<span class="token punctuation">]</span> <span class="token keyword">class</span> 类名 <span class="token keyword">extends</span> 父类 <span class="token keyword">implements</span> 接口<span class="token number">1</span><span class="token punctuation">,</span>接口<span class="token number">2.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">{</span>
 类体部分
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>实现接口与继承父类相似，一样可以获得所实现接口里定义的常量 Field、抽象方法、内部类和枚举类定义。</p><p>一个类可以继承一个父类，并同时实现多个接口，implements 部分必须放在 extends 部分之后。</p><p>一个类实现了一个或多个接口之后，这个类必须完全实现这些接口里所定义的全部抽象方法（也就是重写这些抽象方法）；否则，该类将保留从父接口那里继承到的抽象方法，该类也必须定义成抽象类。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 定义一个Product接口</span>
<span class="token keyword">interface</span> <span class="token class-name">Product</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> <span class="token function">getProduceTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 让Printer类实现Output接口和Product接口</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Printer</span> <span class="token keyword">implements</span> <span class="token class-name">Output</span><span class="token punctuation">,</span> <span class="token class-name">Product</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> printData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token constant">MAX_CACHE_LINE</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// 用以记录当前需打印的作业数</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> dataNum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">out</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 只要还有作业，就继续打印</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>dataNum <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;打印机打印:&quot;</span> <span class="token operator">+</span> printData<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 把作业队列整体前移一位，并将剩下的作业数减1</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">arraycopy</span><span class="token punctuation">(</span>printData<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> printData<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">--</span>dataNum<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>dataNum <span class="token operator">&gt;=</span> <span class="token constant">MAX_CACHE_LINE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;输出队列已满，添加失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// 把打印数据添加到队列里，已保存数据的数量加1</span>
            printData<span class="token punctuation">[</span>dataNum<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> msg<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getProduceTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">45</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 创建一个Printer对象，当成Output使用</span>
        <span class="token class-name">Output</span> o <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Printer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        o<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token string">&quot;轻量级Java EE企业应用实战&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        o<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token string">&quot;疯狂Java讲义&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        o<span class="token punctuation">.</span><span class="token function">out</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        o<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token string">&quot;疯狂Android讲义&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        o<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token string">&quot;疯狂Ajax讲义&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        o<span class="token punctuation">.</span><span class="token function">out</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 创建一个Printer对象，当成Product使用</span>
        <span class="token class-name">Product</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Printer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">getProduceTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 所有接口类型的引用变量都可直接赋给Object类型的变量</span>
        <span class="token class-name">Object</span> obj <span class="token operator">=</span> p<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Printer 类实现了 Output 接口和 Product 接口，因此 Printer 对象既可直接赋给 Output 变量，也可直接赋给 Product 变量。仿佛 Printer 类既是 Output 类的子类，也是 Product 类的子类，这就是 Java 提供的模拟多继承。</p><div class="custom-container tip"><p class="custom-container-title">提示</p><p>实现接口方法时，必须使用 public 访问控制修饰符，因为接口里的方法都是 public 的，而子类（相当于实现类）重写父类方法时访问权限只能更大或者相等，所以实现类实现接口里的方法时只能使用 public 访问权限。</p></div><p>接口不能显式继承任何类，但所有接口类型的引用变量都可以直接赋给 Object 类型的引用变量。所以在上面程序中可以把 Product 类型变量直接赋给 Object 类型变量，这是利用向上转型来实现的，因为编译器知道任何 Java 对象都必须是 Object 或其子类的实例，Product 类型的对象也不例外（它必须是 Product 接口实现类的对象，该实现类肯定是 Product 的显式或隐式子类）。</p><h3 id="接口和抽象类" tabindex="-1"><a class="header-anchor" href="#接口和抽象类" aria-hidden="true">#</a> 接口和抽象类</h3><p>接口和抽象类很像，它们都具有如下特征。</p><ol><li>接口和抽象类都不能被实例化，它们都位于继承树的顶端，用于被其他类实现和继承。</li><li>接口和抽象类都可以包含抽象方法，实现接口或继承抽象类的普通子类都必须实现这些抽象方法。</li></ol><p>但接口和抽象类之间的差别非常大，这种差别主要体现在二者设计目的上。</p><p>接口作为系统与外界交互的窗口，接口体现的是一种规范。对于接口的实现者而言，接口规定了实现者必须向外提供哪些服务（以方法的形式来提供）；对于接口的调用者而言，接口规定了调用者可以调用哪些服务，以及如何调用这些服务（就是如何来调用方法）。当在一个程序中使用接口时，接口是多个模块间的耦合标准；当在多个应用程序之间使用接口时，接口是多个程序之间的通信标准。</p><p>接口类似于整个系统的“总纲”，它制定了系统各模块应该遵循的标准，因此一个系统中的接口不应该经常改变。一旦接口被改变，对整个系统甚至其他系统的影响将是辐射式的，导致系统中大部分类都需要改写。</p><p>抽象类则不一样，抽象类作为系统中多个子类的共同父类，它所体现的是一种模板式设计。抽象类作为多个子类的抽象父类，可以被当成系统实现过程中的中间产品，这个中间产品已经实现了系统的部分功能（那些已经提供实现的方法），但这个产品依然不能当成最终产品，必须有更进一步的完善，这种完善可能有几种不同方式。</p><p>接口和抽象类在用法上也存在如下差别。</p><ol><li>接口里不能定义静态方法；抽象类里可以定义静态方法。</li><li>接口里只能定义静态常量 Field，不能定义普通 Field；抽象类里则既可以定义普通 Field，也可以定义静态常量 Field。</li><li>接口里不包含构造器；抽象类里可以包含构造器，抽象类里的构造器并不是用于创建对象，而是让其子类调用这些构造器来完成属于抽象类的初始化操作。</li><li>接口里不能包含初始化块；但抽象类则完全可以包含初始化块。</li><li>一个类最多只能有一个直接父类，包括抽象类；但一个类可以直接实现多个接口，通过实现多个接口可以弥补 Java 单继承的不足。</li></ol><h3 id="面向接口编程" tabindex="-1"><a class="header-anchor" href="#面向接口编程" aria-hidden="true">#</a> 面向接口编程</h3><p><strong>1.简单工厂模式：</strong></p><p>假设程序中有个<code>Computer</code>类需要组合一个输出设备，现在有两个选择：直接让<code>Computer</code>类组合一个<code>Printer</code>，或者让<code>Computer</code>类组合一个<code>Output</code>，那么到底采用哪种方式更好呢？假设让<code>Computer</code>类组合一个<code>Printer</code>对象，如果有一天系统需要重构，需要使用<code>BetterPrinter</code>来代替<code>Printer</code>，于是我们需要打开<code>Computer</code>类源代码进行修改。如果系统中只有一个<code>Computer</code>类组合了<code>Printer</code>还好，但如果系统中有 100 个类组合了<code>Printer</code>，甚至 1000 个、10000 个……将意味着我们要打开 100 个、1000 个、10000 个类进行修改。</p><p>为了避免这个问题，我们让<code>Computer</code>类组合一个<code>Output</code>类型的对象，将<code>Computer</code>类与<code>Printer</code>类完全分离。<code>Computer</code>对象实际组合的是<code>Printer</code>对象还是<code>BetterPrinter</code>对象，对<code>Computer</code>而言完全透明。当<code>Printer</code>对象切换到<code>BetterPrinter</code>对象时，系统完全不受影响。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Computer</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Output</span> out<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Computer</span><span class="token punctuation">(</span><span class="token class-name">Output</span> out<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>out <span class="token operator">=</span> out<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 定义一个模拟获取字符串输入的方法</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">keyIn</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        out<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 定义一个模拟打印的方法</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        out<span class="token punctuation">.</span><span class="token function">out</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Computer 类已经完全与 Printer 类分离，只是与 Output 接口耦合。</p><p>Computer 不再负责创建 Output 对象，系统提供一个 Output 工厂来负责生成 Output 对象。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OutputFactory</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">Output</span> <span class="token function">getOutput</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Printer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">OutputFactory</span> of <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OutputFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Computer</span> c <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Computer</span><span class="token punctuation">(</span>of<span class="token punctuation">.</span><span class="token function">getOutput</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        c<span class="token punctuation">.</span><span class="token function">keyIn</span><span class="token punctuation">(</span><span class="token string">&quot;轻量级Java EE企业应用实战&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        c<span class="token punctuation">.</span><span class="token function">keyIn</span><span class="token punctuation">(</span><span class="token string">&quot;疯狂Java讲义&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        c<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>OutputFactory</code>类中包含了一个<code>getOutput</code>方法，该方法返回一个<code>Output</code>实现类的实例，该方法负责创建<code>Output</code>实例，具体创建哪一个实现类的对象由该方法决定。</p><p>如果系统需要将<code>Printer</code>改为<code>BetterPrinter</code>实现类，只需让<code>BetterPrinter</code>实现<code>Output</code>接口，并改变<code>OutputFactory</code>类中的<code>getOutput</code>方法即可。</p><p><code>BetterPrinter</code>只是对原有的<code>Printer</code>进行简单修改，以模拟系统重构后的改进。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">BetterPrinter</span> <span class="token keyword">implements</span> <span class="token class-name">Output</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> printData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token constant">MAX_CACHE_LINE</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> dataNum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">out</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 只要还有作业，就继续打印while(dataNum &gt;0)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;高速打印机正在打印:&quot;</span> <span class="token operator">+</span> printData<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 把作业队列整体前移一位，并将剩下的作业数减1</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">arraycopy</span><span class="token punctuation">(</span>printData<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> printData<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">--</span>dataNum<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>dataNum <span class="token operator">&gt;=</span> <span class="token constant">MAX_CACHE_LINE</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;输出队列已满，添加失 败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// 把打印数据添加到队列里，已保存数据的数量加1</span>
            printData<span class="token punctuation">[</span>dataNum<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> msg<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>把<code>OutputFactory</code>工厂类的<code>getOutput</code>方法改为如下代码：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">Output</span> <span class="token function">getOutput</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BetterPrinter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>再次运行前面的<code>OutputFactory.java</code>程序，发现系统运行时已经改为<code>BetterPrinter</code>对象，而不再是原来的<code>Printer</code>对象。</p><div class="custom-container tip"><p class="custom-container-title">提示</p><p>上面介绍的就是一种被称为“简单工厂”的设计模式。所谓设计模式，就是对经常出现的软件设计问题的成熟解决方案。很多人把设计模式想象成非常高深的概念，实际上设计模式仅仅是对特定问题的一种惯性思维。</p><p>设计模式的理解必须以足够的代码积累量作为基础。最好是经历过某种苦痛，或者正在经历一种苦痛，就会对设计模式有较深的感受。</p></div><p><strong>2.命令模式：</strong></p><p>假设有个方法需要遍历某个数组的数组元素，但无法确定在遍历数组元素时如何处理这些元素，需要在调用该方法时指定具体的处理行为。</p><p>这个方法不仅需要普通数据可以变化，甚至还有方法执行体也需要变化，难道我们能把“处理行为”作为一个参数传入该方法？</p><div class="custom-container tip"><p class="custom-container-title">提示</p><p>在某些编程语言（如 Ruby 等）里，确实允许传入一个代码块作为参数。但 Java 暂时还不支持代码块作为参数</p></div><p>对于这样一个需求，我们必须把“处理行为”作为参数传入该方法，这个“处理行为”用编程来实现就是一段代码。那如何把这段代码传入该方法呢？</p><p>我们使用一个<code>Command</code>接口来定义一个方法，用这个方法来封装“处理行为”。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Command</span> <span class="token punctuation">{</span>
    <span class="token comment">// 接口里定义的process方法用于封装“处理行为”</span>
    <span class="token keyword">void</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> target<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>下面是需要处理数组的处理类，在这个处理类中包含一个 process 方法，这个方法无法确定处理数组的处理行为，所以定义该方法时使用了一个 Command 参数，这个 Command 参数负责对数组的处理行为。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProcessArray</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> target<span class="token punctuation">,</span> <span class="token class-name">Command</span> cmd<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        cmd<span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>PrintCommand</code>类和<code>AddCommand</code>类：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PrintCommand</span> <span class="token keyword">implements</span> <span class="token class-name">Command</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> tmp <span class="token operator">:</span> target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;迭代输出目标数组的元素:&quot;</span> <span class="token operator">+</span> tmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AddCommand</span> <span class="token keyword">implements</span> <span class="token class-name">Command</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> tmp <span class="token operator">:</span> target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            sum <span class="token operator">+=</span> tmp<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;数组元素的总和是:&quot;</span> <span class="token operator">+</span> sum<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过一个<code>Command</code>接口，就实现了让<code>ProcessArray</code>类和具体“处理行为”的分离，程序使用<code>Command</code>接口代表了对数组的处理行为。<code>Command</code>接口也没有提供真正的处理，只有等到需要调用<code>ProcessArray</code>对象的 process 方法时，才真正传入一个 Command 对象，才确定对数组的处理行为。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CommandTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ProcessArray</span> pa <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProcessArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> target <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">// 第一次处理数组，具体处理行为取决于Print</span>
        <span class="token class-name">Commandpa</span><span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">PrintCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-----------------―&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 第二次处理数组，具体处理行为取决于Add</span>
        <span class="token class-name">Commandpa</span><span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">AddCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="内部类" tabindex="-1"><a class="header-anchor" href="#内部类" aria-hidden="true">#</a> 内部类</h2><p>在某些情况下，我们把一个类放在另一个类的内部定义，这个定义在其他类内部的类就被称为内部类（有的地方也叫嵌套类），包含内部类的类也被称为外部类（有的地方也叫宿主类）。</p><p>内部类主要有如下作用。</p><ol><li>内部类提供了更好的封装，可以把内部类隐藏在外部类之内，不允许同一个包中的其他类访问该类。假设需要创建 Cow 类，Cow 类需要组合一个<code>CowLeg</code>对象，<code>CowLeg</code>类只有在 Cow 类里才有效，离开了 Cow 类之后没有任何意义。在这种情况下，就可把<code>CowLeg</code>定义成 Cow 的内部类，不允许其他类访问<code>CowLeg</code>。</li><li>内部类成员可以直接访问外部类的私有数据，因为内部类被当成其外部类成员，同一个类的成员之间可以互相访问。但外部类不能访问内部类的实现细节，例如内部类的成员变量。</li><li>匿名内部类适合用于创建那些仅需要一次使用的类。对于前面介绍的命令模式，当需要传入一个 Command 对象时，重新专门定义<code>PrintCommand</code>和<code>AddCommand</code>两个实现类可能没有太大的意义，因为这两个实现类可能仅需要使用一次。在这种情况下，使用匿名内部类将更方便。</li></ol><h3 id="非静态内部类" tabindex="-1"><a class="header-anchor" href="#非静态内部类" aria-hidden="true">#</a> 非静态内部类</h3><p>定义内部类非常简单，只要把一个类放在另一个类内部定义即可。此处的“类内部”包括类中的任何位置，甚至在方法中也可以定义内部类（方法里定义的内部类被称为局部内部类）。内部类定义语法格式如下：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OuterClass</span> <span class="token punctuation">{</span>
 <span class="token comment">//此处可以定义内部类</span>
    <span class="token keyword">class</span> <span class="token class-name">InnerClass</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>大部分时候，内部类都被作为成员内部类定义，而不是作为局部内部类。成员内部类是一种与 Field、方法、构造器和初始化块相似的类成员；局部内部类和匿名内部类则不是类成员。</p><p>成员内部类分为两种：静态内部类和非静态内部类，使用 static 修饰的成员内部类是静态内部类，没有使用 static 修饰的成员内部类是非静态内部类。</p><p>因为内部类作为其外部类的成员，所以可以使用任意访问控制符如 private、protected 和 public 等修饰。</p><div class="custom-container tip"><p class="custom-container-title">提示</p><p>外部类的上一级程序单元是包，所以它只有 2 个作用域：同一个包内和任何位置。因此只需 2 种访问权限：包访问权限和公开访问权限，正好对应省略访问控制符和 public 访问控制符。</p><p>省略访问控制符是包访问权限，即同一包中的其他类可以访问省略访问控制符的成员。因此，如果一个外部类不使用任何访问控制符修饰，则只能被同一个包中其他类访问。</p><p>而内部类的上一级程序单元是外部类，它就具有 4 个作用域：同一个类、同一个包、父子类和任何位置，因此可以使用 4 种访问控制权限。</p></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Cow</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">double</span> weight<span class="token punctuation">;</span>

    <span class="token comment">// 外部类的两个重载的构造器</span>
    <span class="token keyword">public</span> <span class="token class-name">Cow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Cow</span><span class="token punctuation">(</span><span class="token keyword">double</span> weight<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>weight <span class="token operator">=</span> weight<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 定义一个非静态内部类</span>
    <span class="token keyword">private</span> <span class="token keyword">class</span> <span class="token class-name">CowLeg</span> <span class="token punctuation">{</span>
        <span class="token comment">// 非静态内部类的两个Field</span>
        <span class="token keyword">private</span> <span class="token keyword">double</span> length<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> color<span class="token punctuation">;</span>

        <span class="token comment">// 非静态内部类的两个重载的构造器</span>
        <span class="token keyword">public</span> <span class="token class-name">CowLeg</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token class-name">CowLeg</span><span class="token punctuation">(</span><span class="token keyword">double</span> length<span class="token punctuation">,</span> <span class="token class-name">String</span> color<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>length <span class="token operator">=</span> length<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>color <span class="token operator">=</span> color<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setLength</span><span class="token punctuation">(</span><span class="token keyword">double</span> length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>length <span class="token operator">=</span> length<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">getLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setColor</span><span class="token punctuation">(</span><span class="token class-name">String</span> color<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>color <span class="token operator">=</span> color<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>color<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 非静态内部类的实例方法</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">info</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;当前牛腿颜色是:&quot;</span> <span class="token operator">+</span> color <span class="token operator">+</span> <span class="token string">&quot;,高:&quot;</span> <span class="token operator">+</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 直接访问外部类的private修饰的Field</span>
            <span class="token comment">// ①</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;本牛腿所在奶牛重:&quot;</span> <span class="token operator">+</span> weight<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">CowLeg</span> cl <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CowLeg</span><span class="token punctuation">(</span><span class="token number">1.12</span><span class="token punctuation">,</span> <span class="token string">&quot;黑白相间&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cl<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Cow</span> cow <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cow</span><span class="token punctuation">(</span><span class="token number">378.9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cow<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面程序中把一个类定义放在了另一个类的内部，所以它就成了一个内部类，可以使用 private 修饰符来修饰这个类。</p><p>外部类 Cow 里包含了一个 test 方法，该方法里创建了一个<code>CowLeg</code>对象，并调用该对象的 info 方法。在外部类里使用非静态内部类时，与平时使用普通类并没有太大的区别。</p><p>编译上面程序，看到在文件所在路径生成了两个 class 文件，一个是<code>Cow.class</code>，另一个是<code>Cow$CowLeg.class</code>，前者是外部类 Cow 的 class 文件，后者是内部类<code>CowLeg</code>的 class 文件，即成员内部类（包括静态内部类、非静态内部类）的 class 文件总是这种形式：<code>OuterClass$InnerClass.class</code>。</p><p>在非静态内部类对象里，保存了一个它寄存的外部类对象的引用（当调用非静态内部类的实例方法时，必须有一个非静态内部类实例，而非静态内部类实例必须寄存在外部类实例里）。</p><p>当在非静态内部类的方法内访问某个变量时，系统优先在该方法内查找是否存在该名字的局部变量，如果存在就使用该变量；如果不存在，则到该方法所在的内部类中查找是否存在该名字的成员变量，如果存在则使用该成员变量；如果不存在，则到该内部类所在的外部类中查找是否存在该名字的成员变量，如果存在则使用该成员变量；如果依然不存在，系统将出现编译错误：提示找不到该变量。</p><p>如果外部类成员变量、内部类成员变量与内部类里方法的局部变量同名，则可通过使用 this、外部类类名.this 作为限定来区分。</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202207151154529.jpeg" alt="img"></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DiscernVariable</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> prop <span class="token operator">=</span> <span class="token string">&quot;外部类的实例变量&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">class</span> <span class="token class-name">InClass</span> <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> prop <span class="token operator">=</span> <span class="token string">&quot;内部类的实例变量&quot;</span><span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">info</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> prop <span class="token operator">=</span> <span class="token string">&quot;局部变量&quot;</span><span class="token punctuation">;</span>
            <span class="token comment">// 通过外部类类名.this.varName 访问外部类实例Field</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;外部类的Field值:&quot;</span> <span class="token operator">+</span> <span class="token class-name">DiscernVariable</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">.</span>prop<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 通过 this.varName 访问内部类实例的Field</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;内部类的Field值:&quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>prop<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 直接访问局部变量</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;局部变量的值:&quot;</span> <span class="token operator">+</span> prop<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">InClass</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        in<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">DiscernVariable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过<code>OutterClass.this.propName</code>的形式访问外部类的实例 Field，通过<code>this.propName</code>的形式访问非静态内部类的实例 Field。</p><p>非静态内部类的成员可以访问外部类的 private 成员，但反过来就不成立了。如果外部类需要访问非静态内部类的成员，则必须显式创建非静态内部类对象来调用访问其实例成员。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Outer</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">int</span> outProp <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 执行下面代码，只创建了外部类对象，还未创建内部类对象</span>
        <span class="token class-name">Outer</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Outer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//①</span>
        out<span class="token punctuation">.</span><span class="token function">accessInnerProp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">accessInnerProp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 外部类不能直接访问非静态内部类的实例Field</span>
        <span class="token comment">// 下面代码出现编译错误</span>
        <span class="token comment">// System.out.println(&quot;内部类的inProp值:&quot; + inProp);</span>
        <span class="token comment">// 如需访问内部类的实例Field，则必须显式创建内部类对象</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;内部类的inProp值:&quot;</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">Inner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>inProp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">class</span> <span class="token class-name">Inner</span> <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">int</span> inProp <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">accessOuterProp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 非静态内部类可以直接访问外部类的成员</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;外部类的outProp值:&quot;</span> <span class="token operator">+</span> outProp<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>main 方法的 ① 号代码创建了一个外部类对象，并调用外部类对象的<code>accessInnerProp</code>方法。此时非静态内部类对象根本不存在，如果允许<code>accessInnerProp</code>方法访问非静态内部类对象，将肯定引起错误。</p><p>根据静态成员不能访问非静态成员的规则，外部类的静态方法、静态代码块不能访问非静态内部类，包括不能使用非静态内部类定义变量、创建实例等。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StaticTest</span> <span class="token punctuation">{</span>
    <span class="token comment">// 定义一个非静态内部类，是一个空类</span>
    <span class="token keyword">private</span> <span class="token keyword">class</span> <span class="token class-name">In</span> <span class="token punctuation">{</span>
        <span class="token comment">// 外部类的静态方法</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 下面代码引发编译异常，因为静态成员(main方法)</span>
            <span class="token comment">// 无法访问非静态成员(In类)</span>
            <span class="token keyword">new</span> <span class="token class-name">In</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Java 不允许在非静态内部类里定义静态成员。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">InnerNoStatic</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">class</span> <span class="token class-name">InnerClass</span> <span class="token punctuation">{</span>
        <span class="token comment">/*
        下面三个静态声明都将引发如下编译错误:非静态内部类不能有静态声明
        */</span>
        <span class="token keyword">static</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;====三=====&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> inProp<span class="token punctuation">;</span>

        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container tip"><p class="custom-container-title">提示</p><p>非静态内部类里不可以有静态初始化块，但可以包含普通初始化块。非静态内部类普通初始化块的作用与外部类初始化块的作用完全相同。</p></div><h3 id="静态内部类" tabindex="-1"><a class="header-anchor" href="#静态内部类" aria-hidden="true">#</a> 静态内部类</h3><p>如果使用 static 来修饰一个内部类，则这个内部类就属于外部类本身，而不属于外部类的某个对象。因此使用 static 修饰的内部类被称为类内部类，有的地方也称为静态内部类。</p><p>静态内部类可以包含静态成员，也可以包含非静态成员。根据静态成员不能访问非静态成员的规则，静态内部类不能访问外部类的实例成员，只能访问外部类的类成员。即使是静态内部类的实例方法也不能访问外部类的实例成员，只能访问外部类的静态成员。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StaticInnerClassTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> prop1 <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> prop2 <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">StaticInnerClass</span> <span class="token punctuation">{</span>
        <span class="token comment">// 静态内部类里可以包含静态成员</span>
        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> age<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">accessOuterProp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 下面代码出现错误</span>
            <span class="token comment">// 静态内部类无法访问外部类的实例成员</span>
            <span class="token comment">// System.out.println(prop1);</span>
            <span class="token comment">// 下面代码正常</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>prop2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container tip"><p class="custom-container-title">提示</p><p>为什么静态内部类的实例方法也不能访问外部类的实例属性呢？</p><p>因为静态内部类是外部类的==类相关==，而不是外部类的对象相关的。也就是说，静态内部类对象不是寄存在外部类对象里的，而是寄存在外部类的类本身中。</p><p>当静态内部类对象存在时，并不存在一个被它寄存的外部类对象，静态内部类对象里只有外部类的==类引用==，没有持有外部类对象的引用。</p><p>如果允许静态内部类的实例方法访问外部类的实例成员，但找不到被寄存的外部类对象，这将引起错误。</p></div><p>静态内部类是外部类的一个静态成员，因此外部类的静态方法、静态初始化块中可以使用静态内部类来定义变量、创建对象等。</p><p>外部类依然不能直接访问静态内部类的成员，但可以使用静态内部类的类名作为调用者来访问静态内部类的类成员，也可以使用静态内部类对象作为调用者来访问静态内部类的实例成员。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AccessStaticInnerClass</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">StaticInnerClass</span> <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> prop1 <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token keyword">int</span> prop2 <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">accessInnerProp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// System.out.printIn(prop1);</span>
        <span class="token comment">// 上面代码出现错误，应改为如下形式</span>
        <span class="token comment">// 通过类名访问静态内部类的类成员</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">StaticInnerClass</span><span class="token punctuation">.</span>prop1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// System.out.printIn(prop2);</span>
        <span class="token comment">// 上面代码出现错误，应改为如下形式</span>
        <span class="token comment">// 通过实例访问静态内部类的实例成员</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StaticInnerClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>prop2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>除此之外，Java 还允许在接口里定义内部类，接口里定义的内部类默认使用 public static 修饰，也就是说，接口内部类只能是静态内部类。</p><p>如果为接口内部类指定访问控制符，则只能指定 public 访问控制符；如果定义接口内部类时省略访问控制符，则该内部类默认是 public 访问控制权限。</p><div class="custom-container tip"><p class="custom-container-title">提示</p><p>接口里是否能定义内部接口？</p><p>可以的。接口里的内部接口是接口的成员，因此系统默认添加 public static 两个修饰符。如果定义接口里的内部接口时指定访问控制符，则只能使用 public 修饰符。</p><p>当然，定义接口里的内部接口的意义不大，因为接口的作用是定义一个公共规范（暴露出来供大家使用），如果把这个接口定义成一个内部接口，那么意义何在呢？</p></div><h3 id="使用内部类" tabindex="-1"><a class="header-anchor" href="#使用内部类" aria-hidden="true">#</a> 使用内部类</h3><p>使用内部类定义变量和创建实例与外部类存在的一些小小的差异。</p><ul><li><p><strong>在外部类内部使用内部类</strong></p><p>在外部类内部使用内部类时，与平常使用普通类没有太大的区别。一样可以直接通过内部类类名来定义变量，通过 new 调用内部类构造器来创建实例。</p><p>唯一存在的一个区别是：不要在外部类的静态成员（包括静态方法和静态初始化块）中使用非静态内部类，因为静态成员不能访问非静态成员。</p><p>在外部类内部定义内部类的子类与平常定义子类也没有太大的区别。</p></li><li><p><strong>在外部类以外使用非静态内部类</strong></p><p>如果希望在外部类以外的地方访问内部类（包括静态和非静态两种），则内部类不能使用 private 访问控制权限，private 修饰的内部类只能在外部类内部使用。</p><p>对于使用其他访问控制符修饰的内部类，则能在访问控制符对应的访问权限内使用。</p><ol><li>省略访问控制符的内部类，只能被与外部类处于同一个包中的其他类所访问。</li><li>使用 protected 修饰的内部类，可被与外部类处于同一个包中的其他类和外部类的子类所访问。</li><li>使用 public 修饰的内部类，可以在任何地方被访问。</li></ol></li></ul><p>在外部类以外的地方定义内部类（包括静态和非静态两种）变量的语法格式如下：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">OuterClass<span class="token punctuation">.</span>InnerClass</span> varName
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>在外部类以外的地方使用内部类时，内部类完整的类名应该是<code>OuterClass.InnerClass</code>。如果外部类有包名，则还应该增加包名前缀。</p><p>因为非静态内部类的对象必须寄存在外部类的对象里，因此创建非静态内部类对象之前，必须先创建其外部类对象。在外部类以外的地方创建非静态内部类实例的语法如下：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Outerlnstance</span><span class="token punctuation">.</span><span class="token keyword">new</span> <span class="token class-name">InnerConstructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>在外部类以外的地方创建非静态内部类实例必须使用外部类实例和 new 来调用非静态内部类的构造器。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Out</span> <span class="token punctuation">{</span>
    <span class="token comment">// 定义一个内部类，不使用访问控制符</span>
    <span class="token comment">// 即只有同一个包中的其他类可访问该内部类</span>
    <span class="token keyword">class</span> <span class="token class-name">In</span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token class-name">In</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CreateInnerInstance</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Out<span class="token punctuation">.</span>In</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Out</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">new</span> <span class="token class-name">In</span><span class="token punctuation">(</span><span class="token string">&quot;测试信息&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">/*
         * 上面代码可改为如下三行代码:
         * 使用OuterClass.InnerClass的形式定义内部类变量
         * Out.In in;
         * 创建外部类实例，非静态内部类实例将寄存在该实例中
         * Out out = new Out();
         * 通过外部类实例和new来调用内部类构造器创建非静态内部类实例
         * in = out.new In(&quot;测试信息&quot;);
         */</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>当创建一个子类时，子类构造器总会调用父类的构造器，因此在创建非静态内部类的子类时，必须保证让子类构造器可以调用非静态内部类的构造器，调用非静态内部类的构造器时，必须存在一个外部类对象。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SubClass</span> <span class="token keyword">extends</span> <span class="token class-name">Out</span><span class="token punctuation">.</span>ln <span class="token punctuation">{</span>
    <span class="token comment">// 显示定义SubClass的构造器</span>
    <span class="token keyword">public</span> <span class="token class-name">SubClass</span><span class="token punctuation">(</span><span class="token class-name">Out</span> out<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 通过传入的Out对象显式调用ln的构造器</span>
        out<span class="token punctuation">.</span><span class="token keyword">super</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>从上面代码中可以看出，如果需要创建<code>SubClass</code>对象时，必须先创建一个 Out 对象。</p><p>因为<code>SubClass</code>是非静态内部类 In 类的子类，非静态内部类 In 对象里必须有一个对 Out 对象的引用，其子类<code>SubClass</code>对象里也应该存在一个 Out 对象的引用。</p><p>当创建<code>SubClass</code>对象时传给该构造器的 Out 对象，就是<code>SubClass</code>对象里 Out 对象引用所指向的对象。</p><p>非静态内部类 In 对象和<code>SubClass</code>对象都必须保留有指向 Outer 对象的引用，区别是创建两种对象时传入 Out 对象的方式不同：当创建非静态内部类 In 类的对象时，必须通过 Outer 对象来调用 new 关键字；当创建<code>SubClass</code>类的对象时，必须使用 Outer 对象作为调用者来调用 In 类的构造器。</p><div class="custom-container tip"><p class="custom-container-title">提示</p><p>非静态内部类的子类不一定是内部类，它可以是一个外部类。但非静态内部类的子类实例一样需要保留一个引用，该引用指向其父类所在外部类的对象。</p><p>如果有一个内部类子类的对象存在，则一定存在与之对应的外部类对象。</p></div><ul><li><strong>在外部类以外使用静态内部类</strong></li></ul><p>因为静态内部类是外部类==类相关的==，因此创建内部类对象时无须创建外部类对象。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">new</span> <span class="token class-name">OuterClass<span class="token punctuation">.</span>InnerConstructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>下面程序示范了如何在外部类以外的地方创建静态内部类的实例。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">StaticOut</span> <span class="token punctuation">{</span>
    <span class="token comment">// 定义一个静态内部类，不使用访问控制符</span>
    <span class="token comment">// 即同一个包中的其他类可访问该内部类</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">StaticIn</span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token class-name">StaticIn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;静态内部类的构造器&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CreateStaticInnerInstance</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">StaticOut<span class="token punctuation">.</span>StaticIn</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StaticOut<span class="token punctuation">.</span>StaticIn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">/*
         * 上面代码可改为如下两行代码:
         * 使用OuterClass.InnerClass的形式定义内部类变量
         * StaticOut.StaticIn in;
         * 通过new来调用内部类构造器创建静态内部类实例
         * in = new StaticOut.StaticIn();
         */</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>不管是静态内部类还是非静态内部类，它们声明变量的语法完全一样，区别只是在创建内部类对象时，静态内部类只需使用外部类即可调用构造器，而非静态内部类必须使用外部类对象来调用构造器。</p><p>因为调用静态内部类的构造器时无须使用外部类对象，所以创建静态内部类的子类也比较简单，下面代码就为静态内部类<code>StaticIn</code>类定义了一个空的子类。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StaticSubClass</span> <span class="token keyword">extends</span> <span class="token class-name">StaticOut<span class="token punctuation">.</span>Staticln</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="custom-container tip"><p class="custom-container-title">提示</p><p>使用静态内部类比使用非静态内部类要简单很多，只要把外部类当成静态内部类的包空间即可。因此当程序需要使用内部类时，应该优先考虑使用静态内部类。</p></div><div class="custom-container info"><p class="custom-container-title">相关信息</p><p>既然内部类是外部类的成员，那么是否可以为外部类定义子类，在子类中再定义一个内部类来重写其父类中的内部类？</p><p>不可以！内部类的类名不再是简单地由内部类的类名组成，它实际上还把外部类的类名作为一个命名空间，作为内部类类名的限制。</p><p>因此子类中的内部类和父类中的内部类不可能完全同名，即使二者所包含的内部类的类名相同，但因为它们所处的外部类空间不同，所以它们不可能完全同名，也就不可能重写。</p></div><h3 id="局部内部类" tabindex="-1"><a class="header-anchor" href="#局部内部类" aria-hidden="true">#</a> 局部内部类</h3><p>如果把一个内部类放在方法里定义，则这个内部类就是一个局部内部类，局部内部类仅在该方法里有效。由于局部内部类不能在外部类的方法以外的地方使用，因此局部内部类也不能使用访问控制符和 static 修饰符修饰。</p><div class="custom-container tip"><p class="custom-container-title">提示</p><p>对于局部成员而言，不管是局部变量还是局部内部类，它们的上一级程序单元都是方法，而不是类，使用 static 修饰它们没有任何意义。</p><p>因此，所有的局部成员都不能使用 static 修饰。不仅如此，因为局部成员的作用域是所在方法，其他程序单元永远也不可能访问另一个方法中的局部成员，所以所有的局部成员都不能使用访问控制符修饰。</p></div><p>如果需要用局部内部类定义变量、创建实例或派生子类，那么都只能在局部内部类所在的方法内进行。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LocalInnerClass</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 定义局部内部类</span>
        <span class="token keyword">class</span> <span class="token class-name">InnerBase</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> a<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 定义局部内部类的子类</span>
        <span class="token keyword">class</span> <span class="token class-name">InnerSub</span> <span class="token keyword">extends</span> <span class="token class-name">InnerBase</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> b<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 创建局部内部类的对象</span>
        <span class="token class-name">InnerSub</span> is <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InnerSub</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        is<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
        is<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;InnerSub对象的a和b Field是:&quot;</span> <span class="token operator">+</span> is<span class="token punctuation">.</span>a <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> is<span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>编译上面程序，看到生成了三个 class 文件：<code>LocalInnerClass.class</code>、<code>LocalInnerClass$1InnerBase.class</code>和<code>LocalInnerClass$1InnerSub.class</code>，这表明局部内部类的 class 文件总是遵循如下命名格式：<code>OuterClass$NInnerClass.class</code>。</p><p>注意到局部内部类的 class 文件的文件名比成员内部类的 class 文件的文件名多了一个数字，这是因为同一个类里不可能有两个同名的成员内部类，而同一个类里则可能有两个以上同名的局部内部类（处于不同方法中），所以 Java 为局部内部类的 class 文件名中增加了一个数字，用于区分。</p><h3 id="匿名内部类" tabindex="-1"><a class="header-anchor" href="#匿名内部类" aria-hidden="true">#</a> 匿名内部类</h3><p>匿名内部类适合创建那种只需要一次使用的类，例如前面介绍命令模式时所需要的 Command 对象。匿名内部类的语法有点奇怪，创建匿名内部类时会立即创建一个该类的实例，这个类定义立即消失，匿名内部类不能重复使用。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">new</span> 父类构造器<span class="token punctuation">(</span>实参列表<span class="token punctuation">)</span><span class="token operator">|</span>实现接口<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token comment">//匿名内部类的类体部分</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>匿名内部类必须继承一个父类，或实现一个接口，但最多只能继承一个父类，或实现一个接口。</p><ol><li>匿名内部类不能是抽象类，因为系统在创建匿名内部类时，会立即创建匿名内部类的对象。因此不允许将匿名内部类定义成抽象类。</li><li>匿名内部类不能定义构造器，因为匿名内部类没有类名，所以无法定义构造器，但匿名内部类可以定义实例初始化块，通过实例初始化块来完成构造器需要完成的事情。</li></ol><p>最常用的创建匿名内部类的方式是需要创建某个接口类型的对象。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">interface</span> <span class="token class-name">Product</span> <span class="token punctuation">{</span>
    <span class="token keyword">double</span> <span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AnonymousTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">AnonymousTest</span> ta <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnonymousTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 调用test方法时，需要传入一个Product参数</span>
        <span class="token comment">// 此处传入其匿名实现类的实例</span>
        ta<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Product</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token number">567.8</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token string">&quot;AGP显卡&quot;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token class-name">Product</span> p<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;购买了一个&quot;</span> <span class="token operator">+</span> p<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;，花掉了&quot;</span> <span class="token operator">+</span> p<span class="token punctuation">.</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>AnonymousTest</code>类定义了一个 test 方法，该方法需要一个 Product 对象作为参数，但 Product 只是一个接口，无法直接创建对象，因此此处考虑创建一个 Product 接口实现类的对象传入该方法——如果这个 Product 接口实现类需要重复使用，则应该将该实现类定义成一个独立类；如果这个 Product 接口实现类只需一次使用，则可采用上面程序中的方式，定义一个匿名内部类。</p><p>由于匿名内部类不能是抽象类，所以匿名内部类必须实现它的抽象父类或者接口里包含的所有抽象方法。</p><p>上面创建 Product 实现类对象的代码，可以拆分成如下代码。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">AnonymousProduct</span> <span class="token keyword">implements</span> <span class="token class-name">Product</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">567.8</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;AGP显卡&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/*
ta.test(new Product() {
    public double getPrice() {
        return 567.8;
    }

    public String getName() {
        return &quot;AGP显卡&quot;;
    }
});
*/</span>
ta<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AnonymousProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>当通过实现接口来创建匿名内部类时，匿名内部类也不能显式创建构造器，因此匿名内部类只有一个隐式的无参数构造器，故 new 接口名后的括号里不能传入参数值。</p><p>但如果通过继承父类来创建匿名内部类时，匿名内部类将拥有和父类相似的构造器，此处的相似指的是拥有相同的形参列表。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Device</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Device</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Device</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">double</span> <span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AnonymousInner</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">AnonymousInner</span> ai <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnonymousInner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 调用有参数的构造器创建Device匿名实现类的对象</span>
        ai<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Device</span><span class="token punctuation">(</span><span class="token string">&quot;电子示波器&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token number">67.8</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 调用无参数的构造器创建Device匿名实现类的对象</span>
        <span class="token class-name">Device</span> d <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Device</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 初始化块</span>
            <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;匿名内部类的初始化块...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// 实现抽象方法</span>
            <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token number">56.2</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// 重写父类的实例方法</span>
            <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token string">&quot;键盘&quot;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        ai<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token class-name">Device</span> d<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;购买了一个&quot;</span> <span class="token operator">+</span> d<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;，花掉了&quot;</span> <span class="token operator">+</span> d<span class="token punctuation">.</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>程序创建了一个抽象父类 Device 类，这个抽象父类里包含两个构造器：一个无参数的，一个有参数的。当创建以 Device 为父类的匿名内部类时，既可以传入参数，也可以不传入参数。</p><p>当创建匿名内部类时，必须实现接口或抽象父类里的所有抽象方法。如果有需要，也可以重写父类中的普通方法。</p><p>如果匿名内部类需要访问外部类的局部变量，则必须使用 final 修饰符来修饰外部类的局部变量，否则系统将报错。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">interface</span> <span class="token class-name">A</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ATest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> age <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token class-name">A</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 下面语句将提示错误:</span>
                <span class="token comment">// 匿名内部类内访问局部变量必须使用final修饰</span>
                <span class="token comment">// System.out.printIn(age);</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container info"><p class="custom-container-title">相关信息</p><p>为什么需要用 final 修饰局部变量呢?</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">InnerClass</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> defaultAge <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
   <span class="token comment">// 局部变量 age，必须添加final关键字，这里先不加</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addAge</span><span class="token punctuation">(</span><span class="token keyword">int</span> age<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//局部内部类</span>
        <span class="token keyword">class</span> <span class="token class-name">NewAge</span><span class="token punctuation">{</span>
            <span class="token keyword">private</span> <span class="token keyword">int</span> <span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">return</span> age <span class="token operator">+</span> defaultAge<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">NewAge</span> newAge <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NewAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>newAge<span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li>生命周期不同：因为局部变量直接存储在栈中，当方法执行结束，非 final 的局部变量就被销毁，而局部内部类对局部变量的引用依然存在，当局部内部类要调用局部变量时，就会出错，出现非法引用 。<strong>简单来说，就是非 final 的局部变量的生命周期比局部内部类的生命周期短</strong>，是不是直接可以拷贝变量到局部内部类？这样内部类中就可以使用而且不担心生命周期问题呢？也是不可以的，因为直接拷贝又会出现第二个问题，就是数据不同步。</li><li>数据不同步：内部类并不是直接使用传递进来的参数，而是将传递进来的参数通过自己的构造器备份到自己内部，表面看是同一个变量，实际调用的是自己的属性而不是外部类方法的参数，如果在内部类中，修改了这些参数，并不会对外部变量产生影响，仅仅改变局部内部类中备份的参数。如果外部类调用外部变量时发现值并没有被修改，这种问题就会很尴尬，造成数据不同步。<strong>所以使用 final 避免数据不同步的问题</strong>。</li><li>那为什么添加 final 修饰的局部变量，就可以被局部内部类引用呢？若定义为 final，则 java 编译器则会在内部类<code>NewAge</code>内生成一个外部变量的拷贝，而且可以既可以保证内部类可以引用外部属性，又能保证值的唯一性。<strong>也就是拷贝了一个变量的副本，提供给局部内部类,这个副本的生命周期和局部内部类一样长，并且这个副本不可以修改，保证了数据的同步</strong>。</li></ol><p>在 Java8 中，被局部内部类引用的局部变量，默认添加 final，所以不需要添加 final 关键词。</p><p>编译后的字节码：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">ATest</span>$<span class="token number">1</span>NewAge <span class="token punctuation">{</span>
    <span class="token comment">// 局部内部类中的使用的age，是通过构造函数传递进来的，并不是直接引用外部变量。</span>
    <span class="token class-name">ATest</span>$<span class="token function">1NewAge</span><span class="token punctuation">(</span><span class="token class-name">ATest</span> <span class="token keyword">this</span>$<span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">int</span> var2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token keyword">this</span>$<span class="token number">0</span> <span class="token operator">=</span> <span class="token keyword">this</span>$<span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>val$age <span class="token operator">=</span> var2<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">int</span> <span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>val$age <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><h3 id="闭包-closure-和回调" tabindex="-1"><a class="header-anchor" href="#闭包-closure-和回调" aria-hidden="true">#</a> 闭包（Closure）和回调</h3><p>闭包（Closure）是一种能被调用的对象，它保存了创建它的作用域信息。</p><p>对于非静态内部类而言，它不仅记录了其外部类的详细信息，还保留了一个创建非静态内部类对象的引用，并且可以直接调用外部类的 private 成员，因此可以把非静态内部类当成面向对象领域的闭包。</p><p>回调就是某个方法一旦获得了内部类对象的引用后，就可以在合适的时候反过来去调用外部类实例的方法。所谓回调，就是允许客户类通过内部类引用来调用其外部类的方法，这是一种非常灵活的功能。</p><p>假设现在有一个人，既是一个程序员，也是一个教师。也就是说，需要定义一个特殊的类，既需要实现 Teachable 接口，也需要继承 Programmer 父类。表面上看起来这没有任何问题，问题是 Teachable 接口和 Programmer 父类里包含了相同的 work 方法。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">TeachableProgrammer</span> <span class="token keyword">extends</span> <span class="token class-name">Programmer</span> <span class="token keyword">implements</span> <span class="token class-name">Teachable</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">work</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;教师在讲台上讲解...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的<code>TeachableProgrammer</code>类只有一个 work 方法，这个 work 方法只能进行“教学”，不可以进行“编程”。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">TeachableProgrammer</span> <span class="token keyword">extends</span> <span class="token class-name">Programmer</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">TeachableProgrammer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">TeachableProgrammer</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 教学工作依然由TeachableProgrammer类定义</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">teach</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;教师在讲台上讲解...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 返回一个非静态内部类引用，允许外部类通过该非静态内部类引用来回调外部类的方法</span>
    <span class="token keyword">public</span> <span class="token class-name">Teachable</span> <span class="token function">getCallbackReference</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Closure</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">class</span> <span class="token class-name">Closure</span> <span class="token keyword">implements</span> <span class="token class-name">Teachable</span> <span class="token punctuation">{</span>
        <span class="token comment">/*
        非静态内部类回调外部类实现work方法，非静态内部类引用的
        作用仅仅是
        向客户类提供一个回调外部类的途径
        */</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">work</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">teach</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的<code>TeachableProgrammer</code>类只是 Programmer 类的子类，它可以直接调用 Programmer 基类的 work 方法，该类也包含教学的 teach 方法，但这个方法与 Teachable 接口没有任何关系，<code>TeachableProgrammer</code>也不能当成 Teachable 使用。此时创建了一个 Closure 内部类，它实现了 Teachable 接口，并实现了教学的 work 方法，但这种实现是通过回调<code>TeachableProgrammer</code>类的 teach 方法实现的。如果需要让<code>TeachableProgrammer</code>对象进行教学，只需调用 Closure 内部类（它是 Teachable 接口的实现类）对象的 work 方法即可。</p><p><code>TeachableProgrammer</code>类提供了一个获取内部类对象的方法，该方法无须返回 Closure 类型，只需返回所实现接口：Teachable 类型即可，接下来它就可当成一个 Teachable 对象使用了。</p><p>从图中清楚地看出 Closure 内部类的作用，它可以实现 Teachable 接口，也可以当成 Teachable 使用，而且它是<code>TeachableProgrammer</code>的内部类，是回调<code>TeachableProgrammer</code>对象方法的入口，它的 work 方法实际上回调了``TeachableProgrammer`类的 teach 方法。</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202207161657988.jpeg" alt="img"></p><p>如何让<code>TeachableProgrammer</code>对象既执行“教学”的 work 方法，也执行“编程”的 work 方法。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">TeachableProgrammerTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">TeachableProgrammer</span> tp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TeachableProgrammer</span><span class="token punctuation">(</span><span class="token string">&quot;李刚&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 直接调用TeachableProgrammer类从Programmer类继承到的work方法</span>
        tp<span class="token punctuation">.</span><span class="token function">work</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 表面上调用的是Closure的work方法</span>
        <span class="token comment">// 实际上是回调TeachableProgrammer的teach方法</span>
        tp<span class="token punctuation">.</span><span class="token function">getCallbackReference</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">work</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="枚举类" tabindex="-1"><a class="header-anchor" href="#枚举类" aria-hidden="true">#</a> 枚举类</h2><p>在某些情况下，一个类的对象是有限而且固定的，比如季节类，它只有 4 个对象；再比如行星类，目前只有 9 个对象。这种实例有限而且固定的类，在 Java 里被称为枚举类。</p><h3 id="手动实现枚举类" tabindex="-1"><a class="header-anchor" href="#手动实现枚举类" aria-hidden="true">#</a> 手动实现枚举类</h3><ol><li>通过 private 将构造器隐藏起来。</li><li>把这个类的所有可能实例都使用 public static final 修饰的类变量来保存。</li><li>如果有必要，可以提供一些静态方法，允许其他程序根据特定参数来获取与之匹配的实例。</li></ol><p>下面程序将定义一个 Season 类，这个类只能产生 4 个对象，该 Season 类被定义成一个枚举类。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Season</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Season</span> <span class="token constant">SPRING</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Season</span><span class="token punctuation">(</span><span class="token string">&quot;春天&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;趁春踏青&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Season</span> <span class="token constant">SUMMER</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Season</span><span class="token punctuation">(</span><span class="token string">&quot;夏天&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;夏日炎炎&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Season</span> <span class="token constant">FALL</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Season</span><span class="token punctuation">(</span><span class="token string">&quot;秋天&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;秋高气爽&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Season</span> <span class="token constant">WINTER</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Season</span><span class="token punctuation">(</span><span class="token string">&quot;冬天&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;围炉赏雪&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 把Season类定义成不可变的，将其Field也定义成final</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> desc<span class="token punctuation">;</span>

    <span class="token comment">// 将构造器定义成private访问权限</span>
    <span class="token keyword">private</span> <span class="token class-name">Season</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">String</span> desc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>desc <span class="token operator">=</span> desc<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Season</span> <span class="token function">getSeason</span><span class="token punctuation">(</span><span class="token keyword">int</span> seasonNum<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>seasonNum<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span>
                <span class="token keyword">return</span> <span class="token constant">SPRING</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span>
                <span class="token keyword">return</span> <span class="token constant">SUMMER</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span>
                <span class="token keyword">return</span> <span class="token constant">FALL</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token number">4</span><span class="token operator">:</span>
                <span class="token keyword">return</span> <span class="token constant">WINTER</span><span class="token punctuation">;</span>
            <span class="token keyword">default</span><span class="token operator">:</span>
                <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 只为name和desc提供getter方法</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getDesc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>desc<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Season 类是一个不可变类，Season 类中包含了 4 个 static final 常量 Field，这 4 个常量 Field 就代表了该类所能创建的对象。其他程序需要使用 Season 对象时，既可通过如<code>Season.SPRING</code>的方式来取得 Season 对象，也可通过<code>getSeason()</code>静态工厂方法来获得 Season 对象。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">SeasonTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">SeasonTest</span><span class="token punctuation">(</span><span class="token class-name">Season</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;，这真是一个&quot;</span> <span class="token operator">+</span> s<span class="token punctuation">.</span><span class="token function">getDesc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;的季节&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 直接使用Season的FALL常量代表一个Season对象</span>
        <span class="token keyword">new</span> <span class="token class-name">SeasonTest</span><span class="token punctuation">(</span><span class="token class-name">Season</span><span class="token punctuation">.</span><span class="token constant">FALL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>枚举类可以使程序更加健壮，避免创建对象的随意性。</p><h3 id="枚举类入门" tabindex="-1"><a class="header-anchor" href="#枚举类入门" aria-hidden="true">#</a> 枚举类入门</h3><p>Java 5 新增了一个<code>enum</code>关键字（它与 class、interface 关键字的地位相同），用以定义枚举类。</p><p>枚举类是一种特殊的类，它一样可以有自己的 Field、方法，可以实现一个或者多个接口，也可以定义自己的构造器。一个 Java 源文件中最多只能定义一个 public 访问权限的枚举类，且该 Java 源文件也必须和该枚举类的类名相同。</p><p>它与普通类有如下简单区别。</p><ol><li>枚举类可以实现一个或多个接口，使用<code>enum</code>定义的枚举类默认继承了<code>java.lang.Enum</code>类，而不是继承 Object 类。其中<code>java.lang.Enum</code>类实现了<code>java.lang.Serializable</code>和<code>java.lang. Comparable</code>两个接口。</li><li>使用<code>enum</code>定义、非抽象的枚举类默认会使用 final 修饰，因此枚举类不能派生子类。</li><li>枚举类的构造器只能使用 private 访问控制符，如果省略了构造器的访问控制符，则默认使用 private 修饰；如果强制指定访问控制符，则只能指定 private 修饰符。</li><li>==枚举类的所有实例必须在枚举类的第一行显式列出==，否则这个枚举类永远都不能产生实例。列出这些实例时，系统会自动添加 public static final 修饰，无须程序员显式添加。</li></ol><p>所有的枚举类都提供了一个 values 方法，该方法可以很方便地遍历所有的枚举值。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">SeasonEnum</span><span class="token punctuation">{</span>
    <span class="token comment">// 在第一行列出4个枚举实例</span>
    <span class="token constant">SPRING</span><span class="token punctuation">,</span><span class="token constant">SUMMER</span><span class="token punctuation">,</span><span class="token constant">FALL</span><span class="token punctuation">,</span><span class="token constant">WINTER</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>编译上面 Java 程序，将生成一个<code>SeasonEnum.class</code>文件，这表明枚举类是一个特殊的 Java 类。enum 关键字和 class、interface 关键字的作用大致相似。</p><p>如果需要使用该枚举类的某个实例，则可使用<code>EnumClass.variable</code>的形式，如<code>SeasonEnum.SPRING</code>。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">EnumTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">judge</span><span class="token punctuation">(</span><span class="token class-name">SeasonEnum</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// switch语句里的表达式可以是枚举值</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token constant">SPRING</span><span class="token operator">:</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;春暖花开，正好踏青&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token constant">SUMMER</span><span class="token operator">:</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;夏日炎炎，适合游泳&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token constant">FALL</span><span class="token operator">:</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;秋高气爽，进补及时&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token constant">WINTER</span><span class="token operator">:</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;冬日雪飘，围炉赏雪&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 所有的枚举类都有一个values方法，返回该枚举类的所有实例</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SeasonEnum</span> s <span class="token operator">:</span> <span class="token class-name">SeasonEnum</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 平常使用枚举实例时</span>
        <span class="token comment">// 总是通过EnumClass.variable的形式来访问</span>
        <span class="token keyword">new</span> <span class="token class-name">EnumTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">judge</span><span class="token punctuation">(</span><span class="token class-name">SeasonEnum</span><span class="token punctuation">.</span><span class="token constant">SPRING</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面程序的 switch 表达式中还使用了<code>SeasonEnum</code>对象作为表达式，这是 JDK 1.5 增加枚举后对 switch 的扩展：switch 的控制表达式可以是任何枚举类型。不仅如此，当 switch 控制表达式使用枚举类型时，后面 case 表达式中的值直接使用枚举值的名字，无须添加枚举类作为限定。</p><p>所以枚举类可以直接使用<code>java.lang.Enum</code>类中所包含的方法。<code>java.lang.Enum</code>类中提供了如下几个方法。</p><ol><li><code>int compareTo(E o)</code>：该方法用于与指定枚举对象比较顺序，同一个枚举实例只能与相同类型的枚举实例进行比较。如果该枚举对象位于指定枚举对象之后，则返回正整数；如果该枚举对象位于指定枚举对象之前，则返回负整数，否则返回零。</li><li><code>String name()</code>：返回此枚举实例的名称，这个名称就是定义枚举类时列出的所有枚举值之一。与此方法相比，大多数程序员应该优先考虑使用<code>toString()</code>方法，因为<code>toString()</code>方法返回更加用户友好的名称。</li><li><code>int ordinal()</code>：返回枚举值在枚举类中的索引值（就是枚举值在枚举声明中的位置，第一个枚举值的索引值为零）。</li><li><code>String toString()</code>：返回枚举常量的名称，与 name 方法相似，但<code>toString()</code>方法更常用。</li><li><code>public static &lt;T extends Enum&lt;T&gt;&gt; T valueOf(Class&lt;T&gt; enumType,String name)</code>：这是一个静态方法，用于返回指定枚举类中指定名称的枚举值。名称必须与在该枚举类中声明枚举值时所用的标识符完全匹配，不允许使用额外的空白字符。</li></ol><p>当我们使用<code>System.out.println(s)</code>语句来打印枚举值时，实际上输出的是该枚举值的<code>toString()</code>方法，也就是输出该枚举值的名字。</p><h3 id="枚举类的-field、方法和构造器" tabindex="-1"><a class="header-anchor" href="#枚举类的-field、方法和构造器" aria-hidden="true">#</a> 枚举类的 Field、方法和构造器</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">Gender</span><span class="token punctuation">{</span>
    <span class="token constant">MALE</span><span class="token punctuation">,</span><span class="token constant">FEMALE</span><span class="token punctuation">;</span>
<span class="token comment">// 定义一个public修饰的实例变量</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用该枚举类。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">GenderTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 通过Enum的valueOf方法来获取指定枚举类的枚举值</span>
        <span class="token class-name">Gender</span> g <span class="token operator">=</span> <span class="token class-name">Enum</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token class-name">Gender</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string">&quot;FEMALE&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 直接为枚举值的Field赋值</span>
        g<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;女&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">// 直接访问枚举值的Field值</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>g <span class="token operator">+</span> <span class="token string">&quot;代表:&quot;</span> <span class="token operator">+</span> g<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Java 应该把所有类设计成良好封装的类，所以不应该允许直接访问 Gender 类的 name 成员变量，而是应该通过方法来控制对 name 的访问。</p><p>改进 Gender 类的设计。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">Gender</span> <span class="token punctuation">{</span>
    <span class="token constant">MALE</span><span class="token punctuation">,</span> <span class="token constant">FEMALE</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token constant">MALE</span><span class="token operator">:</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;男&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;参数错误&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token constant">FEMALE</span><span class="token operator">:</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;女&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;参数错误&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>把 name 设置成 private，从而避免其他程序直接访问该 name 成员变量，必须通过<code>setName()</code>方法来修改 Gender 实例的 name 变量，而<code>setName()</code>方法就可以保证不会产生混乱。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">GenderTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 通过Enum的valueOf方法来获取指定枚举类的枚举值</span>
        <span class="token class-name">Gender</span> g <span class="token operator">=</span> <span class="token class-name">Enum</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token class-name">Gender</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string">&quot;FEMALE&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 直接为枚举值的Field赋值</span>
        g<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;女&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 直接访问枚举值的Field值</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>g <span class="token operator">+</span> <span class="token string">&quot;代表:&quot;</span> <span class="token operator">+</span> g<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 参数错误</span>
        g<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;男&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>g <span class="token operator">+</span> <span class="token string">&quot;代表:&quot;</span> <span class="token operator">+</span> g<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>实际上这种做法依然不够好，枚举类通常应该设计成不可变类，也就是说，它的 Field 值不应该允许改变，这样会更安全，而且代码更加简洁。</p><p>我们应该将枚举类的 Field 都使用 private final 修饰。因为我们将所有的 Field 都使用了 final 修饰符来修饰，所以必须在构造器里为这些 Field 指定初始值（或者在定义 Field 时指定默认值，或者在初始化块中指定初始值，但这两种情况并不常见），因此应该为枚举类显式定义带参数的构造器。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">Gender</span> <span class="token punctuation">{</span>
    <span class="token comment">// 此处的枚举值必须调用对应的构造器来创建</span>
    <span class="token function">MALE</span><span class="token punctuation">(</span><span class="token string">&quot;男&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">FEMALE</span><span class="token punctuation">(</span><span class="token string">&quot;女&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token comment">// 枚举类的构造器只能使用private修饰</span>
    <span class="token keyword">private</span> <span class="token class-name">Gender</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面程序中的枚举值实际上等同于如下两行代码：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Gender</span> <span class="token constant">MALE</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Gender</span><span class="token punctuation">(</span><span class="token string">&quot;男&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Gender</span> <span class="token constant">FEMALE</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Gender</span><span class="token punctuation">(</span><span class="token string">&quot;女&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="实现接口的枚举类" tabindex="-1"><a class="header-anchor" href="#实现接口的枚举类" aria-hidden="true">#</a> 实现接口的枚举类</h3><p>枚举类也可以实现一个或多个接口。与普通类实现一个或多个接口完全一样，枚举类实现一个或多个接口时，也需要实现该接口所包含的方法。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">GenderDesc</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Gender 枚举类。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">enum</span> <span class="token class-name">Gender</span> <span class="token keyword">implements</span> <span class="token class-name">GenderDesc</span> <span class="token punctuation">{</span>
    <span class="token function">MALE</span><span class="token punctuation">(</span><span class="token string">&quot;男&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">FEMALE</span><span class="token punctuation">(</span><span class="token string">&quot;女&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Gender</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 增加下面的info方法，实现GenderDesc接口必须实现的方法</span>
    <span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">info</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;这是一个用于定义性别Field的枚举类&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果由枚举类来实现接口里的方法，则每个枚举值在调用该方法时都有相同的行为方式（因为方法体完全一样）。</p><p>如果需要每个枚举值在调用该方法时呈现出不同的行为方式，则可以让每个枚举值分别来实现该方法，每个枚举值提供不同的实现方式，从而让不同的枚举值调用该方法时具有不同的行为方式。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">enum</span> <span class="token class-name">Gender</span> <span class="token keyword">implements</span> <span class="token class-name">GenderDesc</span> <span class="token punctuation">{</span>
    <span class="token comment">//此处的枚举值必须调用对应的构造器来创建</span>
    <span class="token function">MALE</span><span class="token punctuation">(</span><span class="token string">&quot;男&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">info</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;这个枚举值代表男性&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token function">FEMALE</span><span class="token punctuation">(</span><span class="token string">&quot;女&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">info</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;这个枚举值代表女性&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Gender</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>当我们创建 MALE 和 FEMALE 两个枚举值时，后面又紧跟了一对花括号，这对花括号里包含了一个 info 方法定义。</p><p>花括号部分实际上就是一个类体部分，在这种情况下，当创建 MALE、FEMALE 枚举值时，并不是直接创建 Gender 枚举类的实例，而是相当于创建 Gender 的匿名子类的实例。</p><div class="custom-container info"><p class="custom-container-title">相关信息</p><p>枚举类不是用 final 修饰了吗？怎么还能派生子类呢？</p><p>并不是所有的枚举类都使用了 final 修饰！非抽象的枚举类才默认使用 final 修饰。对于一个抽象的枚举类而言——只要它包含了抽象方法，它就是抽象枚举类，系统会默认使用 abstract 修饰，而不是使用 final 修饰。</p></div><p>编译上面的程序，可以看到生成了<code>Gender.class</code>、<code>Gender$1.class</code>和<code>Gender$2.class</code>三个文件，这样的三个 class 文件正好证明了上面的结论：MALE 和 FEMALE 实际上是 Gender 匿名子类的实例，而不是 Gender 类的实例。</p><h3 id="包含抽象方法的枚举类" tabindex="-1"><a class="header-anchor" href="#包含抽象方法的枚举类" aria-hidden="true">#</a> 包含抽象方法的枚举类</h3><p>假设有一个 Operation 枚举类，它的 4 个枚举值 PLUS, MINUS, TIMES, DIVIDE 分别代表加、减、乘、除 4 种运算。为此，我们定义下面的 Operation 枚举类。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">Operation</span> <span class="token punctuation">{</span>
    <span class="token constant">PLUS</span><span class="token punctuation">,</span> <span class="token constant">MINUS</span><span class="token punctuation">,</span> <span class="token constant">TIMES</span><span class="token punctuation">,</span> <span class="token constant">DIVIDE</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Operation</span><span class="token punctuation">.</span><span class="token constant">PLUS</span><span class="token punctuation">.</span><span class="token function">eval</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Operation</span><span class="token punctuation">.</span><span class="token constant">MINUS</span><span class="token punctuation">.</span><span class="token function">eval</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Operation</span><span class="token punctuation">.</span><span class="token constant">TIMES</span><span class="token punctuation">.</span><span class="token function">eval</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Operation</span><span class="token punctuation">.</span><span class="token constant">DIVIDE</span><span class="token punctuation">.</span><span class="token function">eval</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 为枚举类定义一个方法，用于实现不同的运算</span>
    <span class="token keyword">double</span> <span class="token function">eval</span><span class="token punctuation">(</span><span class="token keyword">double</span> x<span class="token punctuation">,</span> <span class="token keyword">double</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token constant">PLUS</span><span class="token operator">:</span>
                <span class="token keyword">return</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token constant">MINUS</span><span class="token operator">:</span>
                <span class="token keyword">return</span> x <span class="token operator">-</span> y<span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token constant">TIMES</span><span class="token operator">:</span>
                <span class="token keyword">return</span> x <span class="token operator">*</span> y<span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token constant">DIVIDE</span><span class="token operator">:</span>
                <span class="token keyword">return</span> x <span class="token operator">/</span> y<span class="token punctuation">;</span>
            <span class="token keyword">default</span><span class="token operator">:</span>
                <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>仔细观察上面的 Operation 类不难发现，实际上 PLUS，MINUS，TIMES，DIVIDE 4 个值对 eval 方法各有不同的实现。为此，我们可以采用前面介绍的方法，让它们分别为 4 个枚举值提供 eval 的实现，然后在 Operation 类中定义一个 eval 的抽象方法。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">Operation</span> <span class="token punctuation">{</span>
    <span class="token constant">PLUS</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">eval</span><span class="token punctuation">(</span><span class="token keyword">double</span> x<span class="token punctuation">,</span> <span class="token keyword">double</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token constant">MINUS</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">eval</span><span class="token punctuation">(</span><span class="token keyword">double</span> x<span class="token punctuation">,</span> <span class="token keyword">double</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> x <span class="token operator">-</span> y<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token constant">TIMES</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">eval</span><span class="token punctuation">(</span><span class="token keyword">double</span> x<span class="token punctuation">,</span> <span class="token keyword">double</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> x <span class="token operator">*</span> y<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token constant">DIVIDE</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">eval</span><span class="token punctuation">(</span><span class="token keyword">double</span> x<span class="token punctuation">,</span> <span class="token keyword">double</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> x <span class="token operator">/</span> y<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Operation</span><span class="token punctuation">.</span><span class="token constant">PLUS</span><span class="token punctuation">.</span><span class="token function">eval</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Operation</span><span class="token punctuation">.</span><span class="token constant">MINUS</span><span class="token punctuation">.</span><span class="token function">eval</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Operation</span><span class="token punctuation">.</span><span class="token constant">TIMES</span><span class="token punctuation">.</span><span class="token function">eval</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Operation</span><span class="token punctuation">.</span><span class="token constant">DIVIDE</span><span class="token punctuation">.</span><span class="token function">eval</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token comment">// 为枚举类定义一个抽象方法</span>
    <span class="token comment">// 这个抽象方法由不同的枚举值提供不同的实现</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">double</span> <span class="token function">eval</span><span class="token punctuation">(</span><span class="token keyword">double</span> x<span class="token punctuation">,</span> <span class="token keyword">double</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>编译上面程序会生成 5 个 class 文件，其实 Operation 对应一个 class 文件，它的 4 个匿名内部子类分别各对应一个 class 文件。</p><p>枚举类里定义抽象方法时不能使用 abstract 关键字将枚举类定义成抽象类（因为系统自动会为它添加 abstract 关键字），但因为枚举类需要显式创建枚举值，而不是作为父类，所以定义每个枚举值时必须为抽象方法提供实现，否则将出现编译错误。</p><h2 id="对象与垃圾回收" tabindex="-1"><a class="header-anchor" href="#对象与垃圾回收" aria-hidden="true">#</a> 对象与垃圾回收</h2><p>Java 的垃圾回收是 Java 语言的重要功能之一。当程序创建对象、数组等引用类型实体时，系统都会在堆内存中为之分配一块内存区，对象就保存在这块内存区中，当这块内存不再被任何引用变量引用时，这块内存就变成垃圾，等待垃圾回收机制进行回收。垃圾回收机制具有如下特征。</p><ol><li>垃圾回收机制只负责回收堆内存中的对象，不会回收任何物理资源（例如数据库连接、网络 IO 等资源）。</li><li>程序无法精确控制垃圾回收的运行，垃圾回收会在合适的时候进行。当对象永久性地失去引用后，系统就会在合适的时候回收它所占的内存。</li><li>在垃圾回收机制回收任何对象之前，总会先调用它的<code>finalize()</code>方法，该方法可能使该对象重新复活（让一个引用变量重新引用该对象），从而导致垃圾回收机制取消回收。</li></ol><h3 id="对象在内存中的状态" tabindex="-1"><a class="header-anchor" href="#对象在内存中的状态" aria-hidden="true">#</a> 对象在内存中的状态</h3><p>当一个对象在堆内存中运行时，根据它被引用变量所引用的状态，可以把它所处的状态分成如下三种。</p><ol><li>可达状态：当一个对象被创建后，若有一个以上的引用变量引用它，则这个对象在程序中处于可达状态，程序可通过引用变量来调用该对象的 Field 和方法。</li><li>可恢复状态：如果程序中某个对象不再有任何引用变量引用它，它就进入了可恢复状态。在这种状态下，系统的垃圾回收机制准备回收该对象所占用的内存，在回收该对象之前，系统会调用所有可恢复状态对象的<code>finalize()</code>方法进行资源清理。如果系统在调用<code>finalize()</code>方法时重新让一个引用变量引用该对象，则这个对象会再次变为可达状态；否则该对象将进入不可达状态。</li><li>不可达状态：当对象与所有引用变量的关联都被切断，且系统已经调用所有对象的<code>finalize()</code>方法后依然没有使该对象变成可达状态，那么这个对象将永久性地失去引用，最后变成不可达状态。只有当一个对象处于不可达状态时，系统才会真正回收该对象所占有的资源。</li></ol><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202207262141244.jpeg" alt="img"></p><p>下面程序简单地创建了两个字符串对象，并创建了一个引用变量依次指向两个对象。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StatusTranfer</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ③</span>
        <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ①</span>
        <span class="token class-name">String</span> a <span class="token operator">=</span> <span class="token string">&quot;轻量级Java EE企业应用实战&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">// ②</span>
        a <span class="token operator">=</span> <span class="token string">&quot;疯狂Java讲义&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>程序执行 test 方法的 ① 代码时，代码定义了一个 a 变量，并让该变量指向&quot;轻量级 Java EE 企业应用实战&quot;字符串，该代码执行结束后，&quot;轻量级 Java EE 企业应用实战&quot;字符串对象处于可达状态。</p><p>当程序执行了 test 方法的 ② 代码后，代码再次定义了&quot;疯狂 Java 讲义&quot;字符串对象，并让 a 变量指向该对象。此时，&quot;轻量级 Java EE 企业应用实战&quot;字符串对象处于可恢复状态，而&quot;疯狂 Java 讲义&quot;字符串对象处于可达状态。</p><p>一个对象可以被一个方法的局部变量引用，也可以被其他类的类变量引用，或被其他对象的实例变量引用。当某个对象被其他类的类变量引用时，只有该类被销毁后，该对象才会进入可恢复状态；当某个对象被其他对象的实例变量引用时，只有当该对象被销毁后，该对象才会进入可恢复状态。</p><h3 id="强制垃圾回收" tabindex="-1"><a class="header-anchor" href="#强制垃圾回收" aria-hidden="true">#</a> 强制垃圾回收</h3><p>当一个对象失去引用后，系统何时调用它的<code>finalize()</code>方法对它进行资源清理，何时它会变成不可达状态，系统何时回收它所占有的内存，对于程序完全透明。程序只能控制一个对象何时不再被任何引用变量引用，绝不能控制它何时被回收。</p><p>程序无法精确控制 Java 垃圾回收的时机，但我们依然可以强制系统进行垃圾回收——这种强制只是通知系统进行垃圾回收，但系统是否进行垃圾回收依然不确定。大部分时候，程序强制系统垃圾回收后总会有一些效果。强制系统垃圾回收有如下两个方法。</p><ol><li>调用 System 类的<code>gc()</code>静态方法：<code>System.gc()</code></li><li>调用 Runtime 对象的<code>gc()</code>实例方法：<code>Runtime.getRuntime().gc()</code></li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GCTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">GCTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;系统正在清理GcTest对象的资源...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>编译、运行上面程序，看不到任何输出，可见直到系统退出，系统都不曾调用<code>GCTest</code>对象的<code>finalize()</code>方法。但如果将程序修改成如下形式：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GCTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">GCTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 下面两行代码的作用完全相同，强制系统进行垃圾回收</span>
            <span class="token comment">// System.gc();</span>
            <span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;系统正在清理GcTest对象的资源...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>编译上面程序，使用如下命令来运行此程序：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">java</span> <span class="token parameter variable">-verbose:gc</span> GCTest
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>运行 java 命令时指定<code>-verbose:gc</code>选项，可以看到每次垃圾回收后的提示信息。</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202207271422987.png" alt="image-20220727142157771"></p><p>每次调用了<code>Runtime.getRuntime().gc()</code>代码后，系统垃圾回收机制还是“有所动作”的，可以看出垃圾回收之前、回收之后的内存占用对比。</p><p>虽然图中显示了程序强制垃圾回收的效果，但这种强制只是建议系统立即进行垃圾回收，系统完全有可能并不立即进行垃圾回收，垃圾回收机制也不会对程序的建议完全置之不理：垃圾回收机制会在收到通知后，尽快进行垃圾回收。</p><h3 id="finalize-方法" tabindex="-1"><a class="header-anchor" href="#finalize-方法" aria-hidden="true">#</a> finalize 方法</h3><p>在垃圾回收机制回收某个对象所占用的内存之前，通常要求程序调用适当的方法来清理资源，在没有明确指定清理资源的情况下，Java 提供了默认机制来清理该对象的资源，这个机制就是<code>finalize()</code>方法。该方法是定义在 Object 类里的实例方法，方法原型为：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>当<code>finalize()</code>方法返回后，对象消失，垃圾回收机制开始执行。方法原型中的 throws Throwable 表示它可以抛出任何类型的异常。</p><p>任何 Java 类都可以重写 Object 类的<code>finalize()</code>方法，在该方法中清理该对象占用的资源。如果程序终止之前始终没有进行垃圾回收，则不会调用失去引用对象的 finalize()方法来清理资源。</p><p>垃圾回收机制何时调用对象的<code>finalize()</code>方法是完全透明的，只有当程序认为需要更多的额外内存时，垃圾回收机制才会进行垃圾回收。</p><p>因此，完全有可能出现这样一种情形：某个失去引用的对象只占用了少量内存，而且系统没有产生严重的内存需求，因此垃圾回收机制并没有试图回收该对象所占用的资源，所以该对象的<code>finalize()</code>方法也不会得到调用。</p><p><code>finalize()</code>方法具有如下 4 个特点。</p><ol><li>永远不要主动调用某个对象的<code>finalize()</code>方法，该方法应交给垃圾回收机制调用。</li><li><code>finalize()</code>方法何时被调用，是否被调用具有不确定性，不要把<code>finalize()</code>方法当成一定会被执行的方法。</li><li>当 JVM 执行可恢复对象的<code>finalize()</code>方法时，可能使该对象或系统中其他对象重新变成可达状态。</li><li>当 JVM 执行<code>finalize()</code>方法时出现异常时，垃圾回收机制不会报告异常，程序继续执行。</li></ol><div class="custom-container tip"><p class="custom-container-title">提示</p><p>由于<code>finalize()</code>方法并不一定会被执行，因此如果想清理某个类里打开的资源，则不要放在<code>finalize()</code>方法中进行清理。</p></div><p>在 finalize 方法里复活自身。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FinalizeTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">FinalizeTest</span> ft <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// 创建FinalizeTest对象立即进入可恢复状态</span>
        <span class="token keyword">new</span> <span class="token class-name">FinalizeTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ① 通知系统进行资源回收</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ② 让程序暂停2秒</span>
        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ft<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">info</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;测试资源清理的finalize方法&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 让ft引用到试图回收的可恢复对象，可恢复对象重新变成可达状态</span>
        ft <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面程序中定义了一个<code>FinalizeTest</code>类，重写了该类的<code>finalize()</code>方法，在该方法中把需要清理的可恢复对象重新赋给 ft 引用变量，从而让该可恢复对象重新变成可达状态。</p><p>上面程序中的 main 方法创建了一个<code>FinalizeTest</code>类的匿名对象，因为创建后没有把这个对象赋给任何引用变量，所以该对象立即进入可恢复状态。进入可恢复状态后，系统调用 ① 行代码通知系统进行垃圾回收，② 行代码强制系统暂停 2 秒，再次调用 ft 对象的 info 方法。编译、运行上面程序，看到 ft 的 info 方法被正常执行。</p><p>如果删除 ② 行代码，取消让系统暂停 2 秒。再次编译、运行上面程序，将会看到如下结果。</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202207311704463.png" alt="image-20220731170407253"></p><p>当程序执行了<code>System.gc();</code>后，系统并未立即进行垃圾回收，否则将会先调用可恢复对象的<code>finalize()</code>方法，也就会让 ft 引用到堆内存中的<code>FinalizeTest</code>对象，就不会引发空指针异常了。</p><p>当增加 ② 行代码让系统暂停 2 秒后，程序暂停了，垃圾回收机制也收到了程序的通知，因此开始进行垃圾回收，也就调用了可恢复对象的<code>finalize()</code>方法，从而让 ft 引用到堆内存中的<code>FinalizeTest</code>对象。</p><p>System 和 Runtime 类里都提供了一个<code>runFinalization</code>方法，可以强制垃圾回收机制调用系统中可恢复对象的 finalize 方法。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">FinalizeTest2</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">FinalizeTest2</span> ft <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// 创建TestFinalize对象立即进入可恢复状态</span>
        <span class="token keyword">new</span> <span class="token class-name">FinalizeTest2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 通知系统进行资源回收</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ① 强制垃圾回收机制调用可恢复对象的finalize方法</span>
        <span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">runFinalization</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ② System.runFinalization();</span>
        ft<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">info</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;测试资源清理的finalize方法&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 让ft引用到试图回收的可恢复对象，即可恢复对象重新变成可达状态</span>
        ft <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面程序不再让系统暂停，而是增加了 ① 行代码，这行代码强制垃圾回收机制调用可恢复对象的<code>finalize()</code>方法。该方法执行结束后，ft 将引用到系统试图回收的 FinalizeTest2 对象，所以上面程序可以正常执行 ft 的 info 方法。上面程序中被注释的 ② 行代码与 ① 行代码有相同的功能。</p><h3 id="对象的软、弱和虚引用" tabindex="-1"><a class="header-anchor" href="#对象的软、弱和虚引用" aria-hidden="true">#</a> 对象的软、弱和虚引用</h3><p>对大部分对象而言，程序里会有一个引用变量引用该对象，这是最常见的引用方式。除此之外，<code>java.lang.ref</code>包下提供了 3 个类：<code>SoftReference</code>、<code>PhantomReference</code>和<code>WeakReference</code>，它们分别代表了系统对对象的 3 种引用方式：软引用、虚引用和弱引用。因此，Java 语言对对象的引用有如下 4 种方式。</p><ol><li><p>强引用（<code>StrongReference</code>）</p><p>这是 Java 程序中最常见的引用方式。程序创建一个对象，并把这个对象赋给一个引用变量，程序通过该引用变量来操作实际的对象，前面介绍的对象和数组都采用了这种强引用的方式。当一个对象被一个或一个以上的引用变量所引用时，它处于可达状态，不可能被系统垃圾回收机制回收。</p></li><li><p>软引用（<code>SoftReference</code>）</p><p>软引用需要通过<code>SoftReference</code>类来实现，当一个对象只有软引用时，它有可能被垃圾回收机制回收。对于只有软引用的对象而言，当系统内存空间足够时，它不会被系统回收，程序也可使用该对象；当系统内存空间不足时，系统可能会回收它。软引用通常用于对内存敏感的程序中。</p></li><li><p>弱引用（<code>WeakReference</code>）</p><p>弱引用通过<code>WeakReference</code>类实现，弱引用和软引用很像，但弱引用的引用级别更低。对于只有弱引用的对象而言，当系统垃圾回收机制运行时，不管系统内存是否足够，总会回收该对象所占用的内存。当然，并不是说当一个对象只有弱引用时，它就会立即被回收——正如那些失去引用的对象一样，必须等到系统垃圾回收机制运行时才会被回收。</p></li><li><p>虚引用（<code>PhantomReference</code>）</p><p>虚引用通过<code>PhantomReference</code>类实现，虚引用完全类似于没有引用。虚引用对对象本身没有太大影响，对象甚至感觉不到虚引用的存在。如果一个对象只有一个虚引用时，那么它和没有引用的效果大致相同。虚引用主要用于跟踪对象被垃圾回收的状态，虚引用不能单独使用，虚引用必须和引用队列（<code>ReferenceQueue</code>）联合使用。</p></li></ol><p>上面三个引用类都包含了一个 get 方法，用于获取被它们所引用的对象。</p><div class="custom-container info"><p class="custom-container-title">相关信息</p><p>如果需要掌握 JDK 系统类的详细用法，例如，包含哪些可用的 Field 和方法（protected 和 public 权限的 Field 和方法），以及包含哪些构造器都应该查阅 Java 提供的 API 文档。</p></div><p>引用队列由<code>java.lang.ref.ReferenceQueue</code>类表示，它用于保存被回收后对象的引用。当联合使用软引用、弱引用和引用队列时，系统在回收被引用的对象之后，将把被回收对象对应的引用添加到关联的引用队列中。与软引用和弱引用不同的是，虚引用在对象被释放之前，将把它对应的虚引用添加到它关联的引用队列中，这使得可以在对象被回收之前采取行动。</p><p>软引用和弱引用可以单独使用，但虚引用不能单独使用，单独使用虚引用没有太大的意义。虚引用的主要作用就是跟踪对象被垃圾回收的状态，程序可以通过检查与虚引用关联的引用队列中是否已经包含了该虚引用，从而了解虚引用所引用的对象是否即将被回收。</p><p>弱引用所引用的对象被系统垃圾回收过程。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReferenceTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// 创建一个字符串对象</span>
        <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">&quot;疯狂Java讲义&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ① 创建一个弱引用，让此弱引用引用到&quot;疯狂Java讲义&quot;字符串</span>
        <span class="token class-name">WeakReference</span> wr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakReference</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ② 切断str引用和&quot;疯狂Java讲义&quot;字符串之间的引用</span>
        str <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token comment">// ③ 取出弱引用所引用的对象</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>wr<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 强制垃圾回收</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">runFinalization</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ④ 再次取出弱引用所引用的对象</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>wr<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>系统内存如图：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202207311728736.jpeg" alt="img"></p><div class="custom-container tip"><p class="custom-container-title">提示</p><p>编译上面程序时会出现一个警告提示，这个警告提示是一个泛型提示。此处先不要理它。不仅如此，上面程序创建&quot;疯狂 Java 讲义&quot;字符串对象时，不要使用 String str=&quot;疯狂 Java 讲义&quot;;，否则将看不到运行效果。因为采用 String str=&quot;疯狂 Java 讲义&quot;;代码定义字符串时，系统会使用常量池来管理这个字符串直接量（会使用强引用来引用它），系统不会回收这个字符串直接量。</p></div><p>下面程序与上面程序基本相似，只是使用了虚引用来引用字符串对象，虚引用无法获取它引用的对象。下面程序还将虚引用和引用队列结合使用，可以看到被虚引用所引用的对象被垃圾回收后，虚引用将被添加到引用队列中。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PhantomReferenceTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// 创建一个字符串对象</span>
        <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">&quot;疯狂Java讲义&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 创建一个引用队列</span>
        <span class="token class-name">ReferenceQueue</span> rq <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReferenceQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 创建一个虚引用，让此虚引用引用到&quot;疯狂Java讲义&quot;字符串</span>
        <span class="token class-name">PhantomReference</span> pr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PhantomReference</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> rq<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 切断str引用和&quot;疯狂Java讲义&quot;字符串之间的引用</span>
        str <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token comment">// 取出虚引用所引用的对象</span>
        <span class="token comment">// ①并不能通过虚引用访问被引用的对象，所以此处输出null</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>pr<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 强制垃圾回收</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">runFinalization</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 垃圾回收之后，虚引用将被放入引用队列中</span>
        <span class="token comment">// ②取出引用队列中最先进入队列的引用与pr进行比较</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>rq<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> pr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>因为系统无法通过虚引用来获得被引用的对象，所以执行 ① 处的输出语句时，程序将输出 null（即使此时并未强制进行垃圾回收）。当程序强制垃圾回收后，只有虚引用引用的字符串对象会被垃圾回收，当被引用的对象被回收后，对应的虚引用将被添加到关联的引用队列中，因而将在 ② 代码处看到输出 true。</p><p>使用这些引用类可以避免在程序执行期间将对象留在内存中。如果以软引用、弱引用或虚引用的方式引用对象，垃圾收集器就能够随意地释放对象。如果希望尽可能减小程序在其生命周期中所占用的内存大小时，这些引用类就很有用处。</p><p>==必须指出：要使用这些特殊的引用类，就不能保留对对象的强引用；如果保留了对对象的强引用，就会浪费这些引用类所提供的任何好处。==</p><p>由于垃圾回收的不确定性，当程序希望从软、弱引用中取出被引用对象时，可能这个被引用对象已经被释放了。如果程序需要使用那个被引用的对象，则必须重新创建该对象。这个过程可以采用两种风格的代码完成。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 取出弱引用所引用的对象</span>
obj <span class="token operator">=</span> wr<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 如果取出的对象为null</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ①重新创建一个新的对象,再次让弱引用去引用该对象</span>
    wr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakReference</span><span class="token punctuation">(</span><span class="token function">recreatelt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ②取出弱引用所引用的对象，将其赋给obj变量</span>
    obj <span class="token operator">=</span> wr<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 操作obj对象</span>
<span class="token comment">// 再次切断obj和对象之间的关联</span>
obj <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>另一种取出被引用对象的风格。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 取出弱引用所引用的对象</span>
obj <span class="token operator">=</span> wr<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 如果取出的对象为null</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 重新创建一个新的对象，并使用强引用来引用它</span>
    obj <span class="token operator">=</span> <span class="token function">recreatelt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 取出弱引用所引用的对象，将其赋给obj变量</span>
    wr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakReference</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 操作obj对象</span>
<span class="token comment">// 再次切断obj和对象之间的关联</span>
obj <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面两段代码采用的都是伪码，其中<code>recreateIt</code>方法用于生成一个 obj 对象。这两段代码都是先判断 obj 对象是否已经被回收，如果已经被回收，则重新创建该对象。如果弱引用引用的对象已经被垃圾回收释放了，则重新创建该对象。</p><p>但第一段代码存在一定的问题：当 if 块执行完成后，obj 还是有可能为 null。因为垃圾回收的不确定性，假设系统在 ① 和 ② 行代码之间进行垃圾回收，则系统会再次将<code>wr</code>所引用的对象回收，从而导致 obj 依然为 null。第二段代码则不会存在这个问题，当 if 块执行结束后， obj 一定不为 null。</p><h2 id="修饰符的适用范围" tabindex="-1"><a class="header-anchor" href="#修饰符的适用范围" aria-hidden="true">#</a> 修饰符的适用范围</h2><p>Java 修饰符适用范围总表。</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202207311805749.jpeg" alt="img"></p><p>包访问控制符是一个特殊的修饰符，不用任何访问控制符的就是包访问控制。对于初始化块和局部成员而言，它们不能使用任何访问控制符，所以看起来像使用了包访问控制符。</p><p><code>strictfp</code>关键字的含义是 FP-strict，也就是精确浮点的意思。在 Java 虚拟机进行浮点运算时，如果没有指定<code>strictfp</code>关键字，Java 的编译器和运行时环境在浮点运算上不一定令人满意。一旦使用了<code>strictfp</code>来修饰类、接口或者方法时，那么在所修饰的范围内 Java 的编译器和运行时环境会完全依照浮点规范 IEEE-754 来执行。因此，如果想让浮点运算更加精确，就可以使用<code>strictfp</code>关键字来修饰类、接口和方法。</p><p>native 关键字主要用于修饰一个方法，使用 native 修饰的方法类似于一个抽象方法。与抽象方法不同的是，native 方法通常采用 C 语言来实现。如果某个方法需要利用平台相关特性，或者访问系统硬件等，则可以使用 native 修饰该方法，再把该方法交给 C 去实现。一旦 Java 程序中包含了 native 方法，这个程序将失去跨平台的功能。</p><p>在表列出的所有修饰符中，4 个访问控制符是互斥的，最多只能出现其中之一。不仅如此，还有 abstract 和 final 不能同时使用，abstract 和 static 不能同时使用，abstract 和 private 不能同时使用。</p></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/SurplusFate/SurplusFate.github.io/edit/main/docs/Java/8. 面向对象（下）.md" rel="noopener noreferrer" target="_blank" aria-label="编辑此页" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item update-time"><span class="label">上次编辑于: </span><!----></div><!----></footer><nav class="page-nav"><a href="/Java/7.%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%88%E4%B8%8A%EF%BC%89.html" class="nav-link prev" aria-label="7. 面向对象（上）"><div class="hint"><span class="arrow left"></span>上一页</div><div class="link"><span class="icon iconfont icon-note"></span>7. 面向对象（上）</div></a><a href="/Java/9.%20%E6%95%B0%E7%BB%84.html" class="nav-link next" aria-label="9. 数组"><div class="hint">下一页<span class="arrow right"></span></div><div class="link">9. 数组<span class="icon iconfont icon-note"></span></div></a></nav><!----><!----><!--]--></main><!--]--><!----><!--]--></div><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app.8334b441.js" defer></script>
  </body>
</html>
