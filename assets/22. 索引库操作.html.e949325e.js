import{_ as n}from"./_plugin-vue_export-helper.cdc0426e.js";import{o as s,c as a,e}from"./app.d6d367fd.js";const p={},t=e(`<h1 id="_22-索引库操作" tabindex="-1"><a class="header-anchor" href="#_22-索引库操作" aria-hidden="true">#</a> 22. 索引库操作</h1><p>索引库就类似数据库表，mapping 映射就类似表的结构。</p><p>我们要向 es 中存储数据，必须先创建“库”和“表”。</p><p><strong>初步检索:</strong></p><p>查看索引库全部节点</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>http://39.108.190.63:9200/_cat/nodes
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">172.18</span>.0.2 <span class="token number">76</span> <span class="token number">96</span> <span class="token number">12</span> <span class="token number">0.45</span> <span class="token number">0.54</span> <span class="token number">0.52</span> cdfhilmrstw * 179a0f8167f4
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>查看 es 健康状况</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>http://39.108.190.63:9200/_cat/health
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">1669435763</span> 04:09:23 docker-cluster green <span class="token number">1</span> <span class="token number">1</span> <span class="token number">7</span> <span class="token number">7</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> - <span class="token number">100.0</span>%
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>查看主节点</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>http://39.108.190.63:9200/_cat/master
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>M0fX9nn7Q6W4cWdWRtCpog <span class="token number">172.18</span>.0.2 <span class="token number">172.18</span>.0.2 179a0f8167f4
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>查看全部索引, 相当于数据库 <code>show databases</code></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>http://39.108.190.63:9200/_cat/indices
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>green <span class="token function">open</span> .kibana_7.12.1_001              BFjrLap2Q2OyZyDKI8cA6Q <span class="token number">1</span> <span class="token number">0</span> <span class="token number">39</span>  <span class="token number">56</span>  <span class="token number">4</span>.2mb  <span class="token number">4</span>.2mb
green <span class="token function">open</span> .apm-custom-link                sNIBsElQRR-zQAKrFZPy1g <span class="token number">1</span> <span class="token number">0</span>  <span class="token number">0</span>   <span class="token number">0</span>   208b   208b
green <span class="token function">open</span> .apm-agent-configuration        QNIHj9K6Scet_gDAF-QA1Q <span class="token number">1</span> <span class="token number">0</span>  <span class="token number">0</span>   <span class="token number">0</span>   208b   208b
green <span class="token function">open</span> .kibana_task_manager_7.12.1_001 YpCID05eQti_VFBE78BCrg <span class="token number">1</span> <span class="token number">0</span>  <span class="token number">9</span> <span class="token number">743</span>  <span class="token number">2</span>.2mb  <span class="token number">2</span>.2mb
green <span class="token function">open</span> .kibana-event-log-7.12.1-000001 xg-ES9ilS1uXtjDKpvNw0g <span class="token number">1</span> <span class="token number">0</span>  <span class="token number">4</span>   <span class="token number">0</span> <span class="token number">21</span>.8kb <span class="token number">21</span>.8kb
green <span class="token function">open</span> .tasks                          1Fzgw3iCQ-SUq9OkwL0ekw <span class="token number">1</span> <span class="token number">0</span>  <span class="token number">6</span>   <span class="token number">0</span> <span class="token number">34</span>.8kb <span class="token number">34</span>.8kb
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_22-1-mapping-映射属性" tabindex="-1"><a class="header-anchor" href="#_22-1-mapping-映射属性" aria-hidden="true">#</a> 22.1.mapping 映射属性</h2><p>mapping 是对索引库中文档的约束，常见的 mapping 属性包括：</p><ul><li>type：字段数据类型，常见的简单类型有： <ul><li>字符串：text（可分词的文本）、keyword（精确值，例如：品牌、国家、ip 地址）</li><li>数值：long、integer、short、byte、double、float、</li><li>布尔：boolean</li><li>日期：date</li><li>对象：object</li></ul></li><li>index：是否创建索引，默认为 true</li><li>analyzer：使用哪种分词器</li><li>properties：该字段的子字段</li></ul><p>例如下面的 json 文档：</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;age&quot;</span><span class="token operator">:</span> <span class="token number">21</span><span class="token punctuation">,</span>
  <span class="token property">&quot;weight&quot;</span><span class="token operator">:</span> <span class="token number">52.1</span><span class="token punctuation">,</span>
  <span class="token property">&quot;isMarried&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">&quot;info&quot;</span><span class="token operator">:</span> <span class="token string">&quot;黑马程序员Java讲师&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;email&quot;</span><span class="token operator">:</span> <span class="token string">&quot;zy@itcast.cn&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;score&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">99.1</span><span class="token punctuation">,</span> <span class="token number">99.5</span><span class="token punctuation">,</span> <span class="token number">98.9</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;firstName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;云&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;lastName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;赵&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>对应的每个字段映射（mapping）：</p><ul><li>age：类型为 integer；参与搜索，因此需要 index 为 true；无需分词器</li><li>weight：类型为 float；参与搜索，因此需要 index 为 true；无需分词器</li><li>isMarried：类型为 boolean；参与搜索，因此需要 index 为 true；无需分词器</li><li>info：类型为字符串，需要分词，因此是 text；参与搜索，因此需要 index 为 true；分词器可以用 ik_smart</li><li>email：类型为字符串，但是不需要分词，因此是 keyword；不参与搜索，因此需要 index 为 false；无需分词器</li><li>score：虽然是数组，但是我们只看元素的类型，类型为 float；参与搜索，因此需要 index 为 true；无需分词器</li><li>name：类型为 object，需要定义多个子属性 <ul><li>name.firstName；类型为字符串，但是不需要分词，因此是 keyword；参与搜索，因此需要 index 为 true；无需分词器</li><li>name.lastName；类型为字符串，但是不需要分词，因此是 keyword；参与搜索，因此需要 index 为 true；无需分词器</li></ul></li></ul><h2 id="_22-2-索引库的-crud" tabindex="-1"><a class="header-anchor" href="#_22-2-索引库的-crud" aria-hidden="true">#</a> 22.2.索引库的 CRUD</h2><p>这里我们统一使用 Kibana 编写 DSL 的方式来演示。</p><h3 id="_22-2-1-创建索引库和映射" tabindex="-1"><a class="header-anchor" href="#_22-2-1-创建索引库和映射" aria-hidden="true">#</a> 22.2.1.创建索引库和映射</h3><h4 id="基本语法" tabindex="-1"><a class="header-anchor" href="#基本语法" aria-hidden="true">#</a> 基本语法</h4><ul><li>请求方式：PUT / POST</li><li>请求路径：/索引库名，可以自定义</li><li>请求参数：mapping 映射</li></ul><blockquote><p>PUT 可以指定新增和修改, PUT 必须指定 id 一般是做修改操作</p></blockquote><p>格式：</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code>POST /索引库名称
<span class="token punctuation">{</span>
  <span class="token property">&quot;mappings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;properties&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;字段名&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;analyzer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ik_smart&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;字段名2&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;keyword&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;index&quot;</span><span class="token operator">:</span> <span class="token string">&quot;false&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;字段名3&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token property">&quot;properties&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;子字段&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;keyword&quot;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// ...略</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="示例" tabindex="-1"><a class="header-anchor" href="#示例" aria-hidden="true">#</a> 示例</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>POST /heima
<span class="token punctuation">{</span>
  <span class="token string">&quot;mappings&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;properties&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;info&quot;</span>:<span class="token punctuation">{</span>
        <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;text&quot;</span>,
        <span class="token string">&quot;analyzer&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;ik_smart&quot;</span>
      <span class="token punctuation">}</span>,
      <span class="token string">&quot;email&quot;</span>:<span class="token punctuation">{</span>
        <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;keyword&quot;</span>,
        <span class="token string">&quot;index&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;falsae&quot;</span>
      <span class="token punctuation">}</span>,
      <span class="token string">&quot;name&quot;</span>:<span class="token punctuation">{</span>
        <span class="token string">&quot;properties&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;firstName&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;keyword&quot;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>,
      // <span class="token punctuation">..</span>. 略
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_22-2-2-查询索引库" tabindex="-1"><a class="header-anchor" href="#_22-2-2-查询索引库" aria-hidden="true">#</a> 22.2.2.查询索引库</h3><p><strong>基本语法</strong>：</p><ul><li><p>请求方式：GET</p></li><li><p>请求路径：/索引库名</p></li><li><p>请求参数：无</p></li></ul><p><strong>格式</strong>：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>GET /索引库名
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>示例</strong>：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/image-20210720211019329.png" alt="image-20210720211019329"></p><h3 id="_22-2-3-修改索引库" tabindex="-1"><a class="header-anchor" href="#_22-2-3-修改索引库" aria-hidden="true">#</a> 22.2.3.修改索引库</h3><p>倒排索引结构虽然不复杂，但是一旦数据结构改变（比如改变了分词器），就需要重新创建倒排索引，这简直是灾难。因此索引库<strong>一旦创建，无法修改 mapping</strong>。</p><p>虽然无法修改 mapping 中已有的字段，但是却允许添加新的字段到 mapping 中，因为不会对倒排索引产生影响。</p><p><strong>语法说明</strong>：</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code>PUT /索引库名/_mapping
<span class="token punctuation">{</span>
  <span class="token property">&quot;properties&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;新字段名&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;integer&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>示例</strong>：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/image-20210720212357390.png" alt="image-20210720212357390"></p><h3 id="_22-2-4-删除索引库" tabindex="-1"><a class="header-anchor" href="#_22-2-4-删除索引库" aria-hidden="true">#</a> 22.2.4.删除索引库</h3><p><strong>语法：</strong></p><ul><li><p>请求方式：DELETE</p></li><li><p>请求路径：/索引库名</p></li><li><p>请求参数：无</p></li></ul><p><strong>格式：</strong></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>DELETE /索引库名
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>在 kibana 中测试：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/image-20210720212123420.png" alt="image-20210720212123420"></p><h3 id="_22-2-5-总结" tabindex="-1"><a class="header-anchor" href="#_22-2-5-总结" aria-hidden="true">#</a> 22.2.5.总结</h3><p>索引库操作有哪些？</p><ul><li>创建索引库：PUT /索引库名</li><li>查询索引库：GET /索引库名</li><li>删除索引库：DELETE /索引库名</li><li>添加字段：PUT /索引库名/_mapping</li></ul>`,57),i=[t];function l(o,r){return s(),a("div",null,i)}const d=n(p,[["render",l],["__file","22. 索引库操作.html.vue"]]);export{d as default};
