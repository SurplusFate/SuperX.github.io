import{_ as l}from"./_plugin-vue_export-helper.cdc0426e.js";import{o as i,c as u,a as n,b as a,d as s,w as c,e as t,r as o}from"./app.691e2e41.js";const r={},d=t('<h1 id="谷粒商城" tabindex="-1"><a class="header-anchor" href="#谷粒商城" aria-hidden="true">#</a> 谷粒商城</h1><h2 id="项目概览" tabindex="-1"><a class="header-anchor" href="#项目概览" aria-hidden="true">#</a> 项目概览</h2><h3 id="项目架构图" tabindex="-1"><a class="header-anchor" href="#项目架构图" aria-hidden="true">#</a> 项目架构图</h3><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211171222389.png" alt="image.png"></p><h3 id="技术栈" tabindex="-1"><a class="header-anchor" href="#技术栈" aria-hidden="true">#</a> 技术栈</h3><p>SpringBoot, SpringCloud, Nacos, OpenFeign, Gateway, Docker, RabbitMQ, Elasticsearch, Sentinel, K8S,...</p><h2 id="环境搭建" tabindex="-1"><a class="header-anchor" href="#环境搭建" aria-hidden="true">#</a> 环境搭建</h2><p>虚拟机, docker, docker 安装 mysql, docker 安装 redis, git</p><p>初始化数据库:</p><p><a href="%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/pms_catelog.sql">pms_catelog.sql</a></p><p><a href="%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/gulimall_oms.sql">gulimall_oms.sql</a></p><p><a href="%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/gulimall_pms.sql">gulimall_pms.sql</a></p><p><a href="%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/gulimall_sms.sql">gulimall_sms.sql</a></p><p><a href="%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/gulimall_ums.sql">gulimall_ums.sql</a></p><p><a href="%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/gulimall_wms.sql">gulimall_wms.sql</a></p><h2 id="项目搭建" tabindex="-1"><a class="header-anchor" href="#项目搭建" aria-hidden="true">#</a> 项目搭建</h2><h2 id="快速开发" tabindex="-1"><a class="header-anchor" href="#快速开发" aria-hidden="true">#</a> 快速开发</h2><p>人人开源或其他后台管理系统均可</p><p>人人开源后端:</p>',19),g={href:"https://gitee.com/renrenio/renren-security",target:"_blank",rel:"noopener noreferrer"},k=n("p",null,"前端:",-1),m={href:"https://gitee.com/renrenio/renren-ui",target:"_blank",rel:"noopener noreferrer"},v=t(`<p>现在直接使用人人开源后端的项目作为主模块, 避免频繁重复的修改无意义的代码, 大致结构:</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211171228187.png" alt="image-20221117122831131"></p><p>红色部分为项目自带模块, 代码生成器也集成进来了</p><h3 id="配置修改" tabindex="-1"><a class="header-anchor" href="#配置修改" aria-hidden="true">#</a> 配置修改</h3><h4 id="后端" tabindex="-1"><a class="header-anchor" href="#后端" aria-hidden="true">#</a> 后端</h4><p>修改人人开源项目的 springboot 版本, 降级为 2.6.x 否则无法适配 springcloud 和 springcloud alibaba</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211171230387.png" alt="image.png"></p><p><strong>阿里官方概述:</strong></p><p>如果项目中需要使用 Spring Cloud Alibaba 2021.0.1.0 版本，请在项目中添加如下依赖：</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.6.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2021.0.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-alibaba-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2021.0.1.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>项目中可以将后端 springboot 修改为:</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.6.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>relativePath</span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>添加对应的 springcloud 和 springcloud alibaba</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2021.0.5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-alibaba-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2021.0.4.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="调整依赖-可选" tabindex="-1"><a class="header-anchor" href="#调整依赖-可选" aria-hidden="true">#</a> 调整依赖(可选)</h5><p>将部分依赖和工具类抽取到 renren-common 下, <strong>不是必须</strong>, 可按照自己的喜好来</p><p>调整后会出现较多的依赖报错, 在 renren-common 中重新引入即可</p>`,17),h=t('<p>例如提取 <code>ExcelUtils.java</code> , 同时需要将相关依赖提取出来</p><p>通过代码生成器生成的代码有部分会使用到 renren-admin 下的包依赖, 可以将这部分依赖也提取出来, 例如 <code>shiro</code> 相关的包</p><p>调整 renren-security 的依赖, 使父模块只做版本管理, 不引入依赖, 避免子模块引入多余模块</p><p>将所有 <code>dependencies</code> 中的依赖都移入 renren-common</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211171222547.png" alt="image.png"></p><p>使用 renren-common 做统一依赖管理</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211171245921.png" alt="image-20221117123820537"></p><h4 id="前端" tabindex="-1"><a class="header-anchor" href="#前端" aria-hidden="true">#</a> 前端</h4><p>修改 node 版本为 14, 官方要求为 12.x 14.x</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211171222504.png" alt="image.png"></p><p>推荐使用 nvm, 方便管理 node 版本</p><h3 id="代码生成器" tabindex="-1"><a class="header-anchor" href="#代码生成器" aria-hidden="true">#</a> 代码生成器</h3><blockquote><p>生成的代码是前后端配套的, 可以直接使用</p></blockquote><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211181517360.png" alt="image-20221118150002822"></p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211181517035.png" alt="image-20221118150400732"></p><h4 id="后端代码调整" tabindex="-1"><a class="header-anchor" href="#后端代码调整" aria-hidden="true">#</a> 后端代码调整</h4>',16),b=n("p",null,[a("后端生成的代码实体类("),n("code",null,"io.renren.modules.*.entity"),a(")中不会标注 "),n("code",null,"@TableId"),a(" 要自己手动补充, 否则后续增删改查可能会出现 "),n("code",null,"Invalid bound statement (not found)")],-1),f={href:"https://baomidou.com/pages/f84a74/#%E5%87%BA%E7%8E%B0-invalid-bound-statement-not-found-%E5%BC%82%E5%B8%B8",target:"_blank",rel:"noopener noreferrer"},_=t(`<h4 id="前端代码调整" tabindex="-1"><a class="header-anchor" href="#前端代码调整" aria-hidden="true">#</a> 前端代码调整</h4><p>前端代码对每条数据的增删改查有个固定的执行顺序, 例如: <code>category.vue</code> -&gt; <code>view-module.js</code> -&gt; <code>category-add-or-update.vue</code>, 所有增删改查都会经过 <code>view-module.js</code></p><p>前端会通过主键 <code>id</code> 来获取需要修改的具体对象, 其中中间层 <code>view-module.js</code> 是接收固定的属性 <code>id</code></p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211221417251.png" alt="image-20221122141715001"></p><p>如果我们的数据库主键字段名不是 <code>id</code> 就需要手动修改:</p><p>将 <code>category.vue</code> 中的 <code>scope.row.id</code> 改成 <code>scope.row.catId</code></p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211221420633.png" alt="image-20221122142010592"></p><p>将 <code>category-add-or-update.vue</code> 中 <code>init()</code>, 和 <code>getInfo()</code> 方法中的 <code>catId</code> 修改为 <code>id</code>:</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211221428401.png" alt="image-20221122142835329"></p><p>或者在获取 <code>id</code> 时进行一次赋值:</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211221433981.png" alt="image-20221122143319940"></p><h3 id="踩坑" tabindex="-1"><a class="header-anchor" href="#踩坑" aria-hidden="true">#</a> 踩坑</h3><h4 id="docker-容器突然连接不上" tabindex="-1"><a class="header-anchor" href="#docker-容器突然连接不上" aria-hidden="true">#</a> Docker 容器突然连接不上</h4><p>重启 Linux 无效, 重启 Docker 后解决</p><p>可能原因:</p><ol><li><p>宿主机的 IP_FORWARD 功能失效</p></li><li><p>端口没开放</p></li></ol><p>查看 IP_FORWARD 功能有没有启用(1 表示已经启用, 0 表示未启用)</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sysctl</span> net.ipv4.ip_forward
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>这里有可能显示是 1 但实际是 0; 将状态重置:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>systemctl restart network.service
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>手动写入:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">echo</span> <span class="token string">&#39;net.ipv4.ip_forward = 1&#39;</span> <span class="token operator">&gt;&gt;</span> /usr/lib/sysctl.d/50-default.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>加载配置文件:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sysctl</span> <span class="token parameter variable">-p</span> /usr/lib/sysctl.d/50-default.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>CentOS 7 下的一些其他相关命令:</p><p>查看 Docker 容器:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> <span class="token function">ps</span> <span class="token parameter variable">-a</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>有参数 <code>-a</code> 表示查看全部容器, 无参数表示查看正在运行的容器</p><p>查看开放的端口:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>firewall-cmd --list-ports
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>查看开放的服务:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>firewall-cmd --list-services
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>查看防火墙状态:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>systemctl status firewalld
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>关闭防火墙:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>systemctl stop firewalld
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>开启防火墙:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>systemctl start firewalld
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>打开指定端口:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>firewall-cmd <span class="token parameter variable">--permanent</span> --add-port<span class="token operator">=</span>端口号/协议
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>例如打开 8080 端口:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>firewall-cmd <span class="token parameter variable">--permanent</span> --add-port<span class="token operator">=</span><span class="token number">8080</span>/tcp
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>关闭端口:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>firewall-cmd <span class="token parameter variable">--permanent</span> --remove-port<span class="token operator">=</span>端口号/协议
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>重新载入生效:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>firewall-cmd <span class="token parameter variable">--reload</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>查询端口是否开放:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>firewall-cmd --query-port<span class="token operator">=</span>端口号/协议
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,48),y={id:"docker-中的数据丢失",tabindex:"-1"},x=n("a",{class:"header-anchor",href:"#docker-中的数据丢失","aria-hidden":"true"},"#",-1),E=t(`<p>Docker 中的 MySQL 因为一次异常停止, 在重启后所有数据全部丢失, 且查询 root 权限显示正常, 实际连建表权限都没有!</p><blockquote><p><strong>容器一定要挂载数据卷!</strong></p></blockquote><h4 id="nacos2-连接不上-端口未开放" tabindex="-1"><a class="header-anchor" href="#nacos2-连接不上-端口未开放" aria-hidden="true">#</a> Nacos2 连接不上/端口未开放</h4><p>先是连接不上 nacos, 需要补充依赖:</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-bootstrap<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.0.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>尝试连接 nacos 的时候报了一个关于 9848 端口的错误, nacos2 还需要开放该端口:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>firewall-cmd <span class="token parameter variable">--permanent</span> --add-port<span class="token operator">=</span><span class="token number">9848</span>/tcp
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>重新载入生效:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>firewall-cmd <span class="token parameter variable">--reload</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>如果是把 nacos 部署在 docker 中, 则需要重新创建容器并设置端口, 可以使用 idea 连接 docker, 但延迟较大</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211171222224.png" alt="image.png"></p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211171232265.png" alt="image.png"></p><p>删除 docker 容器命令:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> <span class="token function">rm</span> <span class="token parameter variable">-f</span> nacos
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>创建并运行 nacos 容器命令参考:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token punctuation">\\</span>
<span class="token parameter variable">--name</span> nacos <span class="token punctuation">\\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">MODE</span><span class="token operator">=</span>standalone <span class="token punctuation">\\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">JVM_XMS</span><span class="token operator">=</span>512m <span class="token punctuation">\\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">JVM_XMX</span><span class="token operator">=</span>512m <span class="token punctuation">\\</span>
<span class="token parameter variable">-p</span> <span class="token number">8848</span>:8848 <span class="token punctuation">\\</span>
<span class="token parameter variable">-p</span> <span class="token number">9848</span>:9848 <span class="token punctuation">\\</span>
<span class="token parameter variable">-d</span> nacos/nacos-server:2.0.2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>详细配置列表:</p>`,17),w={href:"https://github.com/nacos-group/nacos-docker/blob/master/README_ZH.md#%E5%B1%9E%E6%80%A7%E9%85%8D%E7%BD%AE%E5%88%97%E8%A1%A8",target:"_blank",rel:"noopener noreferrer"},I=t(`<p>重启 docker 命令:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>Systemctl restart <span class="token function">docker</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>idea 中显示 docker 状态有较大延迟, 没反应可尝试重新连接 docker</p><h4 id="idea-连不上-docker-中的-mysql5-7" tabindex="-1"><a class="header-anchor" href="#idea-连不上-docker-中的-mysql5-7" aria-hidden="true">#</a> idea 连不上 Docker 中的 MySQL5.7</h4><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211191918058.png" alt="image-20221119191826977"></p><p>需要添加配置</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>TLSv1,TLSv1.1,TLSv1.2,TLSv1.3
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211191918688.png" alt="image-20221119191758437"></p><blockquote><p><strong>记得点应用！</strong></p></blockquote><h2 id="商品服务" tabindex="-1"><a class="header-anchor" href="#商品服务" aria-hidden="true">#</a> 商品服务</h2><h3 id="递归查询父子节点" tabindex="-1"><a class="header-anchor" href="#递归查询父子节点" aria-hidden="true">#</a> 递归查询父子节点</h3><blockquote><p>不要删除或改动自动生成的代码!项目默认是以表格形式展示</p></blockquote><p>数据库父类的 catId 就是子类的 parentId;</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211181000192.png" alt="image-20221118100041911"></p><p>获取所有数据, 筛选出最高级父类;</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CategoryEntity</span><span class="token punctuation">&gt;</span></span> tree <span class="token operator">=</span> categoryService<span class="token punctuation">.</span><span class="token function">getTree</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CategoryDTO</span><span class="token punctuation">&gt;</span></span> dtoTree <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 全部数据</span>
        tree<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>t <span class="token operator">-&gt;</span> dtoTree<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">BeanUtil</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token class-name">CategoryDTO</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过父类 id 和子类 parentid 进行关联;</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// 1. 找到所有的一级分类</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CategoryDTO</span><span class="token punctuation">&gt;</span></span> leave1 <span class="token operator">=</span>
        dtoTree<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>r <span class="token operator">-&gt;</span> r<span class="token punctuation">.</span><span class="token function">getParentCid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
                <span class="token comment">// 2. 递归获取所有子菜单</span>
                <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>
                        r <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                            r<span class="token punctuation">.</span><span class="token function">setChildren</span><span class="token punctuation">(</span><span class="token function">getChildren</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> dtoTree<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token keyword">return</span> r<span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                <span class="token punctuation">)</span>
                <span class="token comment">// 3. 排序 踩坑 Integer 包装类赋值为 0 的情况下会自动转成 null</span>
                <span class="token punctuation">.</span><span class="token function">sorted</span><span class="token punctuation">(</span><span class="token class-name">Comparator</span><span class="token punctuation">.</span><span class="token function">comparingInt</span><span class="token punctuation">(</span>r <span class="token operator">-&gt;</span> <span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">getSort</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>利用递归进行多级查询</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CategoryDTO</span><span class="token punctuation">&gt;</span></span> <span class="token function">getChildren</span><span class="token punctuation">(</span><span class="token class-name">CategoryDTO</span> parent<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CategoryDTO</span><span class="token punctuation">&gt;</span></span> allData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span>
            allData<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>c <span class="token operator">-&gt;</span> c<span class="token punctuation">.</span><span class="token function">getParentCid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>parent<span class="token punctuation">.</span><span class="token function">getCatId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>p <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                        p<span class="token punctuation">.</span><span class="token function">setChildren</span><span class="token punctuation">(</span><span class="token function">getChildren</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> allData<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">return</span> p<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">sorted</span><span class="token punctuation">(</span><span class="token class-name">Comparator</span><span class="token punctuation">.</span><span class="token function">comparingInt</span><span class="token punctuation">(</span>r <span class="token operator">-&gt;</span> <span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">getSort</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>自动生成的代码没有遵循数据库设计规范(缺少逻辑删除, 创建时间, 更新时间这三个字段), 如果希望自动生成的的代码正常运行需要手动补加</p><p>如果后端依赖或者配置文件调整不当, 最终会导致项目默认的分页功能失效, 前端会一页展示所有数据</p></blockquote><h3 id="逻辑删除" tabindex="-1"><a class="header-anchor" href="#逻辑删除" aria-hidden="true">#</a> 逻辑删除</h3>`,22),S={href:"https://baomidou.com/pages/6b03c5/#%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95",target:"_blank",rel:"noopener noreferrer"},j=t(`<p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211220913005.png" alt="image-20221122091208793"></p><h3 id="gateway-路由配置" tabindex="-1"><a class="header-anchor" href="#gateway-路由配置" aria-hidden="true">#</a> Gateway 路由配置</h3><h4 id="负载均衡-错误-503" tabindex="-1"><a class="header-anchor" href="#负载均衡-错误-503" aria-hidden="true">#</a> 负载均衡/错误 503</h4><p>单独在 gateway 启用负载均衡需要添加 loadbalancer 依赖, 否则会报 <strong>503 错误</strong>:</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-loadbalancer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211181626349.png" alt="image-20221118162622309"></p><h4 id="跨域出现-origin-重复" tabindex="-1"><a class="header-anchor" href="#跨域出现-origin-重复" aria-hidden="true">#</a> 跨域出现 origin 重复</h4><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211181629661.png" alt="image-20221118162924623"></p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211181629239.png" alt="image-20221118162951157"></p><p>因为人人开源配置了默认的跨域</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211181716930.png" alt="image-20221118171602184"></p><p>可以将默认跨域注释掉或者使用 gateway 的配置解决</p><blockquote><p>在官方文档检索 <code>CORS</code> 可查找到相关信息</p></blockquote>`,13),A={href:"https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#the-deduperesponseheader-gatewayfilter-factory",target:"_blank",rel:"noopener noreferrer"},B=n("p",null,[n("img",{src:"https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211181623856.png",alt:"image-20221118162342771"})],-1);function F(q,D){const e=o("ExternalLinkIcon"),p=o("font");return i(),u("div",null,[d,n("p",null,[n("a",g,[a("人人开源/renren-security"),s(e)])]),k,n("p",null,[n("a",m,[a("人人开源/renren-ui"),s(e)])]),v,n("blockquote",null,[n("p",null,[n("strong",null,[s(p,{color:"red"},{default:c(()=>[a("依赖迁移的时候千万不要引错包, 有的依赖有 springboot 版本和 非 springboot 版本, 引入的版本不对不会有错误提示, 在运行时会提示无法自动装配")]),_:1})])]),n("p",null,[n("strong",null,[s(p,{color:"red"},{default:c(()=>[a("抽取工具类的时候要看看配置文件有没有配置也需要抽出来, 否则其他模块启动的时候可能会报一些不好定位错误的异常")]),_:1})])])]),h,n("blockquote",null,[b,n("p",null,[a("官方说明: "),n("a",f,[a("https://baomidou.com/pages/f84a74/#出现-invalid-bound-statement-not-found-异常"),s(e)])])]),_,n("h4",y,[x,a(),s(p,{color:"red"},{default:c(()=>[a("Docker 中的数据丢失!")]),_:1})]),E,n("p",null,[n("a",w,[a("github.com"),s(e)])]),I,n("p",null,[a("除了按照 "),n("a",S,[a("MyBatis-Plus"),s(e)]),a(" 官方文档的配置配好以外, 别忘记补充字段")]),j,n("p",null,[n("a",A,[a("https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#the-deduperesponseheader-gatewayfilter-factory"),s(e)])]),B])}const T=l(r,[["render",F],["__file","谷粒商城.html.vue"]]);export{T as default};
