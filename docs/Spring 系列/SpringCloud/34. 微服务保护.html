<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.53" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://SurplusFate.github.io/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/34.%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4.html"><meta property="og:site_name" content="空~"><meta property="og:title" content="34. 微服务保护"><meta property="og:type" content="article"><meta property="og:updated_time" content="2022-12-01T08:10:46.000Z"><meta property="og:locale" content="zh-CN"><meta property="article:published_time" content="2022-11-14T00:00:00.000Z"><meta property="article:modified_time" content="2022-12-01T08:10:46.000Z"><link rel="icon" href="/logo.png"><script type="text/javascript" src="/base.js"></script><link rel="stylesheet" type="text/css" href="//at.alicdn.com/t/c/font_3721935_vu3qq5p7wsp.css"><title>34. 微服务保护 | 空~</title><meta name="description" content="学习记录">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style.212c1d4b.css" as="style" /><link rel="stylesheet" href="/assets/style.212c1d4b.css" />
    <link rel="modulepreload" href="/assets/app.d6d367fd.js"><link rel="modulepreload" href="/assets/34. 微服务保护.html.5676805b.js"><link rel="modulepreload" href="/assets/_plugin-vue_export-helper.cdc0426e.js"><link rel="modulepreload" href="/assets/34. 微服务保护.html.8909761e.js"><link rel="prefetch" href="/assets/index.html.80e42b79.js" as="script" /><link rel="prefetch" href="/assets/index.html.282d080a.js" as="script" /><link rel="prefetch" href="/assets/1. VMware.html.2edc336e.js" as="script" /><link rel="prefetch" href="/assets/2. 文件管理.html.37a69cab.js" as="script" /><link rel="prefetch" href="/assets/3. 系统管理.html.33ab5912.js" as="script" /><link rel="prefetch" href="/assets/4. 用户和组.html.59cdd40a.js" as="script" /><link rel="prefetch" href="/assets/5. 软件包管理.html.f6a0d451.js" as="script" /><link rel="prefetch" href="/assets/6. JavaEE环境搭建.html.3aa39f75.js" as="script" /><link rel="prefetch" href="/assets/index.html.0b5fefd6.js" as="script" /><link rel="prefetch" href="/assets/1. Vue 核心.html.c44094e0.js" as="script" /><link rel="prefetch" href="/assets/2. 组件化编程.html.ae9b2474.js" as="script" /><link rel="prefetch" href="/assets/3. 脚手架.html.99ee1800.js" as="script" /><link rel="prefetch" href="/assets/index.html.087f61fc.js" as="script" /><link rel="prefetch" href="/assets/index.html.fd9faa9b.js" as="script" /><link rel="prefetch" href="/assets/@RestController 指定主路径无效踩坑.html.6616c0d2.js" as="script" /><link rel="prefetch" href="/assets/@XXmapping注解.html.f9adc0a8.js" as="script" /><link rel="prefetch" href="/assets/Cookie 存 JSON.html.aff20d72.js" as="script" /><link rel="prefetch" href="/assets/Filter 过滤器.html.2c4e4889.js" as="script" /><link rel="prefetch" href="/assets/SSM 环境搭建.html.1ca2f025.js" as="script" /><link rel="prefetch" href="/assets/TypeReference 获取泛型属性.html.bd40b590.js" as="script" /><link rel="prefetch" href="/assets/index.html.75ca7aaa.js" as="script" /><link rel="prefetch" href="/assets/resultType_int 返回值是 null.html.4c56b9d6.js" as="script" /><link rel="prefetch" href="/assets/sentinel 规则持久化.html.5963bb6b.js" as="script" /><link rel="prefetch" href="/assets/v-modeldisabled 和 disabled 踩坑.html.d6a5ddc0.js" as="script" /><link rel="prefetch" href="/assets/函数式编程.html.858dcfab.js" as="script" /><link rel="prefetch" href="/assets/原来 @Autowired 注解还可以这么玩？.html.4c73c2bb.js" as="script" /><link rel="prefetch" href="/assets/处理器方法的返回值.html.1aac030c.js" as="script" /><link rel="prefetch" href="/assets/请求转发与请求重定向.html.fc7b0cf5.js" as="script" /><link rel="prefetch" href="/assets/1.设计模式七大原则.html.f9bcc2f7.js" as="script" /><link rel="prefetch" href="/assets/2.创建型模式.html.d9a22853.js" as="script" /><link rel="prefetch" href="/assets/全局异常处理.html.bca1c06f.js" as="script" /><link rel="prefetch" href="/assets/分页查询.html.e4c96477.js" as="script" /><link rel="prefetch" href="/assets/用户中心.html.0564392e.js" as="script" /><link rel="prefetch" href="/assets/自定义消息转换器.html.7724099e.js" as="script" /><link rel="prefetch" href="/assets/自定义自动填充.html.05bac3ef.js" as="script" /><link rel="prefetch" href="/assets/谷粒商城.html.77e46954.js" as="script" /><link rel="prefetch" href="/assets/1. Java语言概述与开发环境.html.6cabd079.js" as="script" /><link rel="prefetch" href="/assets/10. 面向对象（下）.html.59f7badf.js" as="script" /><link rel="prefetch" href="/assets/11. 与运行环境交互.html.33ff2522.js" as="script" /><link rel="prefetch" href="/assets/12. Java集合.html.ef6b76f0.js" as="script" /><link rel="prefetch" href="/assets/13. 泛型.html.4287d762.js" as="script" /><link rel="prefetch" href="/assets/14. 函数式编程.html.37825560.js" as="script" /><link rel="prefetch" href="/assets/15. 异常处理.html.7945d2f9.js" as="script" /><link rel="prefetch" href="/assets/16. 注解.html.a75fa186.js" as="script" /><link rel="prefetch" href="/assets/17. IO流.html.e3037b63.js" as="script" /><link rel="prefetch" href="/assets/18. 多线程.html.7d62534b.js" as="script" /><link rel="prefetch" href="/assets/19. 类加载机制与反射.html.e4650e71.js" as="script" /><link rel="prefetch" href="/assets/2. 第一个java程序.html.c0935996.js" as="script" /><link rel="prefetch" href="/assets/3. Java程序的基本规则.html.1ef47372.js" as="script" /><link rel="prefetch" href="/assets/4. 数据类型.html.ab0f2c9e.js" as="script" /><link rel="prefetch" href="/assets/5. 运算符.html.3304ab09.js" as="script" /><link rel="prefetch" href="/assets/6. 流程控制.html.d10b18bd.js" as="script" /><link rel="prefetch" href="/assets/7. 面向对象（上）.html.fea71c5b.js" as="script" /><link rel="prefetch" href="/assets/8. 数组.html.a99a8121.js" as="script" /><link rel="prefetch" href="/assets/9. 数组的常见算法.html.cdda16bf.js" as="script" /><link rel="prefetch" href="/assets/1. 创建与管理数据库.html.b9c6ee50.js" as="script" /><link rel="prefetch" href="/assets/2. 创建与管理数据表.html.110b42f9.js" as="script" /><link rel="prefetch" href="/assets/3. 约束管理.html.a26c1da8.js" as="script" /><link rel="prefetch" href="/assets/4. 数据表的基本操作.html.b472da07.js" as="script" /><link rel="prefetch" href="/assets/5. 视图.html.e6cdda1c.js" as="script" /><link rel="prefetch" href="/assets/6. 索引.html.32b05a9b.js" as="script" /><link rel="prefetch" href="/assets/7. 事务.html.0c5e5967.js" as="script" /><link rel="prefetch" href="/assets/1. 准备.html.1e5bd9bb.js" as="script" /><link rel="prefetch" href="/assets/10. 注解.html.2d47dc44.js" as="script" /><link rel="prefetch" href="/assets/11. 复杂查询环境搭建.html.b8ad0dc5.js" as="script" /><link rel="prefetch" href="/assets/12. 动态 SQL.html.ac7ad455.js" as="script" /><link rel="prefetch" href="/assets/13. MybatisPlus-基础篇.html.e013ac9a.js" as="script" /><link rel="prefetch" href="/assets/14. MybatisPlus-高级篇.html.10febe80.js" as="script" /><link rel="prefetch" href="/assets/2. 使用.html.385db588.js" as="script" /><link rel="prefetch" href="/assets/3. 主要类介绍.html.d8c04776.js" as="script" /><link rel="prefetch" href="/assets/4. 配置文件详解.html.9c0628f4.js" as="script" /><link rel="prefetch" href="/assets/5. CRUD.html.9b339a18.js" as="script" /><link rel="prefetch" href="/assets/6. 配置 environments.html.5d71d706.js" as="script" /><link rel="prefetch" href="/assets/7. ResultMap 结果集映射.html.b94a2c0c.js" as="script" /><link rel="prefetch" href="/assets/8. 日志.html.b29e7e70.js" as="script" /><link rel="prefetch" href="/assets/9. 分页.html.39151e9c.js" as="script" /><link rel="prefetch" href="/assets/index.html.3aed8e38.js" as="script" /><link rel="prefetch" href="/assets/0. Maven.html.8e74bd03.js" as="script" /><link rel="prefetch" href="/assets/1. HTML.html.fd0a1241.js" as="script" /><link rel="prefetch" href="/assets/10. JavaBean.html.9ad71281.js" as="script" /><link rel="prefetch" href="/assets/11. MVC 模式与三层架构的区别.html.50343c55.js" as="script" /><link rel="prefetch" href="/assets/12. Filter.html.287d0448.js" as="script" /><link rel="prefetch" href="/assets/13. 监听器.html.3670a1b2.js" as="script" /><link rel="prefetch" href="/assets/14. JDBC.html.806787fe.js" as="script" /><link rel="prefetch" href="/assets/15. Ajax.html.fd04da23.js" as="script" /><link rel="prefetch" href="/assets/2. CSS.html.388a266e.js" as="script" /><link rel="prefetch" href="/assets/3. JavaScript.html.ed63c41a.js" as="script" /><link rel="prefetch" href="/assets/4. jQuery.html.2df912ac.js" as="script" /><link rel="prefetch" href="/assets/5. xml 和 json.html.d8f4e0f8.js" as="script" /><link rel="prefetch" href="/assets/6. tomcat.html.9871e4d6.js" as="script" /><link rel="prefetch" href="/assets/7. Servlet.html.c5b0a3e8.js" as="script" /><link rel="prefetch" href="/assets/8. Cookie 和 Session.html.7b873ee8.js" as="script" /><link rel="prefetch" href="/assets/9. JSP.html.83323785.js" as="script" /><link rel="prefetch" href="/assets/1. Redis 常见命令.html.a5deffce.js" as="script" /><link rel="prefetch" href="/assets/2. Redis 的 Java 客户端.html.d7ccb9c3.js" as="script" /><link rel="prefetch" href="/assets/index.html.bc834456.js" as="script" /><link rel="prefetch" href="/assets/1. 短信登录.html.5bade4c8.js" as="script" /><link rel="prefetch" href="/assets/10. 用户签到.html.e438e3a8.js" as="script" /><link rel="prefetch" href="/assets/11. UV统计.html.204065e2.js" as="script" /><link rel="prefetch" href="/assets/2. 商户查询缓存.html.6e7f0ec5.js" as="script" /><link rel="prefetch" href="/assets/3. 优惠券秒杀.html.697d92b9.js" as="script" /><link rel="prefetch" href="/assets/4. 分布式锁.html.e3ea3716.js" as="script" /><link rel="prefetch" href="/assets/5. 秒杀优化.html.bcdab385.js" as="script" /><link rel="prefetch" href="/assets/6. Redis 消息队列.html.afbad846.js" as="script" /><link rel="prefetch" href="/assets/7. 达人探店.html.68bd625f.js" as="script" /><link rel="prefetch" href="/assets/8. 好友关注.html.7e17cd57.js" as="script" /><link rel="prefetch" href="/assets/9. 附近商户.html.32c8ce93.js" as="script" /><link rel="prefetch" href="/assets/1. IOC.html.9c4fadf2.js" as="script" /><link rel="prefetch" href="/assets/10. 整合 Mybatis.html.14e6b6c3.js" as="script" /><link rel="prefetch" href="/assets/11. 事务.html.7b7f7366.js" as="script" /><link rel="prefetch" href="/assets/12.  web 项目中使用容器对象.html.2e65ea38.js" as="script" /><link rel="prefetch" href="/assets/2. Spring创建对象.html.8a5ccf7f.js" as="script" /><link rel="prefetch" href="/assets/3. DI 依赖注入.html.937373de.js" as="script" /><link rel="prefetch" href="/assets/4. Spring 配置.html.72d7495e.js" as="script" /><link rel="prefetch" href="/assets/5. Bean 自动装配.html.747ded3f.js" as="script" /><link rel="prefetch" href="/assets/6. 使用注解开发.html.c034ea17.js" as="script" /><link rel="prefetch" href="/assets/7. 使用 java 方式配置 Spring.html.5b6be305.js" as="script" /><link rel="prefetch" href="/assets/8. 代理模式.html.d84a7e15.js" as="script" /><link rel="prefetch" href="/assets/9. Spring AOP.html.cbb05fa0.js" as="script" /><link rel="prefetch" href="/assets/1. SpringBoot.html.57d1efde.js" as="script" /><link rel="prefetch" href="/assets/2. JavaConfig.html.1ee145c6.js" as="script" /><link rel="prefetch" href="/assets/3. Web组件.html.617537bd.js" as="script" /><link rel="prefetch" href="/assets/4. ORM 操作 MySQL.html.3378d7ec.js" as="script" /><link rel="prefetch" href="/assets/5. RESTful.html.4727682a.js" as="script" /><link rel="prefetch" href="/assets/6. 总结.html.7798d376.js" as="script" /><link rel="prefetch" href="/assets/index.html.f24698c0.js" as="script" /><link rel="prefetch" href="/assets/1. 认识微服务.html.2459315d.js" as="script" /><link rel="prefetch" href="/assets/10. 初识 Docker.html.41c5cbf4.js" as="script" /><link rel="prefetch" href="/assets/11. Centos 7 安装 Docker.html.1cf2990c.js" as="script" /><link rel="prefetch" href="/assets/12. Docker 基本操作.html.dc27cb8e.js" as="script" /><link rel="prefetch" href="/assets/13. Dockerfile 自定义镜像.html.980df827.js" as="script" /><link rel="prefetch" href="/assets/14. Docker-Compose.html.35a53dde.js" as="script" /><link rel="prefetch" href="/assets/15. Docker 镜像仓库.html.fc2ca0be.js" as="script" /><link rel="prefetch" href="/assets/16. 初识MQ.html.7d887d29.js" as="script" /><link rel="prefetch" href="/assets/17. RabbitMQ 安装.html.89520166.js" as="script" /><link rel="prefetch" href="/assets/18. MQ 快速入门.html.1b65915b.js" as="script" /><link rel="prefetch" href="/assets/19. SpringAMQP.html.c33c2beb.js" as="script" /><link rel="prefetch" href="/assets/2. 服务的远程调用.html.d4f7dfd9.js" as="script" /><link rel="prefetch" href="/assets/20. elasticsearch.html.02b1a095.js" as="script" /><link rel="prefetch" href="/assets/21. 安装 es、kibana.html.0bae21af.js" as="script" /><link rel="prefetch" href="/assets/22. 索引库操作.html.dc342fb1.js" as="script" /><link rel="prefetch" href="/assets/23. 文档操作.html.ebd11439.js" as="script" /><link rel="prefetch" href="/assets/24. RestAPI.html.e0c804ae.js" as="script" /><link rel="prefetch" href="/assets/25. RestClient 操作文档.html.ef4e0876.js" as="script" /><link rel="prefetch" href="/assets/26. DSL查询文档.html.31e4808f.js" as="script" /><link rel="prefetch" href="/assets/27. 搜索结果处理.html.23348339.js" as="script" /><link rel="prefetch" href="/assets/28. RestClient 查询文档.html.49235fd5.js" as="script" /><link rel="prefetch" href="/assets/29. 黑马旅游案例.html.0f1d41d3.js" as="script" /><link rel="prefetch" href="/assets/3. Eureka 注册中心.html.e0c56acf.js" as="script" /><link rel="prefetch" href="/assets/30. 数据聚合.html.abe0562e.js" as="script" /><link rel="prefetch" href="/assets/31. 自动补全.html.24728190.js" as="script" /><link rel="prefetch" href="/assets/32. 数据同步.html.1c66964f.js" as="script" /><link rel="prefetch" href="/assets/33. 集群.html.8528e8f9.js" as="script" /><link rel="prefetch" href="/assets/4. Ribbon 负载均衡.html.e9678323.js" as="script" /><link rel="prefetch" href="/assets/5. Nacos 注册中心.html.70cbf4b5.js" as="script" /><link rel="prefetch" href="/assets/6. Nacos 配置管理.html.a0e64c58.js" as="script" /><link rel="prefetch" href="/assets/7. Nacos 集群搭建.html.2f20cb72.js" as="script" /><link rel="prefetch" href="/assets/8. Feign 远程调用.html.11090ec7.js" as="script" /><link rel="prefetch" href="/assets/9. Gateway 服务网关.html.89a43b14.js" as="script" /><link rel="prefetch" href="/assets/1. 第一个SpringMVC程序.html.c0b37902.js" as="script" /><link rel="prefetch" href="/assets/10. 拦截器.html.705293e5.js" as="script" /><link rel="prefetch" href="/assets/2. 配置视图解析器.html.3ebe496e.js" as="script" /><link rel="prefetch" href="/assets/3. 控制请求方式.html.e2ed59c7.js" as="script" /><link rel="prefetch" href="/assets/4. 处理器方法的参数.html.1b58cfe2.js" as="script" /><link rel="prefetch" href="/assets/5. 处理器方法的返回值.html.ab584e80.js" as="script" /><link rel="prefetch" href="/assets/6. url-pattern.html.c38eadb0.js" as="script" /><link rel="prefetch" href="/assets/7. SSM整合.html.d60536e4.js" as="script" /><link rel="prefetch" href="/assets/8. 请求重定向和转发.html.aa173cc4.js" as="script" /><link rel="prefetch" href="/assets/9. 异常处理.html.80dd2695.js" as="script" /><link rel="prefetch" href="/assets/index.html.1a983f30.js" as="script" /><link rel="prefetch" href="/assets/ThreadLocal.html.c6ae8548.js" as="script" /><link rel="prefetch" href="/assets/1. Dubbo 框架.html.0796df22.js" as="script" /><link rel="prefetch" href="/assets/2. 直连方式.html.35aa9517.js" as="script" /><link rel="prefetch" href="/assets/3. 改造 Dubbo 项目.html.380888d7.js" as="script" /><link rel="prefetch" href="/assets/4. 常用标签.html.5de61e9a.js" as="script" /><link rel="prefetch" href="/assets/5. 注册中心-Zookeeper.html.060470d2.js" as="script" /><link rel="prefetch" href="/assets/6. 使用 Zookeeper.html.986075bf.js" as="script" /><link rel="prefetch" href="/assets/7. Dubbo 的配置.html.74341687.js" as="script" /><link rel="prefetch" href="/assets/8. 监控中心.html.b7b0cab2.js" as="script" /><link rel="prefetch" href="/assets/index.html.0f30df47.js" as="script" /><link rel="prefetch" href="/assets/404.html.326b14c4.js" as="script" /><link rel="prefetch" href="/assets/index.html.1a3b71b5.js" as="script" /><link rel="prefetch" href="/assets/index.html.1b974156.js" as="script" /><link rel="prefetch" href="/assets/index.html.651691e2.js" as="script" /><link rel="prefetch" href="/assets/index.html.e2606eb8.js" as="script" /><link rel="prefetch" href="/assets/index.html.735c2dab.js" as="script" /><link rel="prefetch" href="/assets/index.html.89fb31a6.js" as="script" /><link rel="prefetch" href="/assets/index.html.bc3d2b77.js" as="script" /><link rel="prefetch" href="/assets/index.html.1e23b2a6.js" as="script" /><link rel="prefetch" href="/assets/index.html.db5e3287.js" as="script" /><link rel="prefetch" href="/assets/index.html.25ee1129.js" as="script" /><link rel="prefetch" href="/assets/index.html.4722db9f.js" as="script" /><link rel="prefetch" href="/assets/index.html.4072d6ac.js" as="script" /><link rel="prefetch" href="/assets/index.html.7ac11d6e.js" as="script" /><link rel="prefetch" href="/assets/index.html.019f9158.js" as="script" /><link rel="prefetch" href="/assets/index.html.d70ec3fa.js" as="script" /><link rel="prefetch" href="/assets/index.html.b1c40ad6.js" as="script" /><link rel="prefetch" href="/assets/index.html.f0db9e83.js" as="script" /><link rel="prefetch" href="/assets/index.html.c363841e.js" as="script" /><link rel="prefetch" href="/assets/index.html.5dc734dc.js" as="script" /><link rel="prefetch" href="/assets/index.html.565f195f.js" as="script" /><link rel="prefetch" href="/assets/index.html.25880373.js" as="script" /><link rel="prefetch" href="/assets/index.html.23de77b1.js" as="script" /><link rel="prefetch" href="/assets/index.html.848c3940.js" as="script" /><link rel="prefetch" href="/assets/1. VMware.html.765687ab.js" as="script" /><link rel="prefetch" href="/assets/2. 文件管理.html.d97c4882.js" as="script" /><link rel="prefetch" href="/assets/3. 系统管理.html.b345620a.js" as="script" /><link rel="prefetch" href="/assets/4. 用户和组.html.c454940b.js" as="script" /><link rel="prefetch" href="/assets/5. 软件包管理.html.d55b5bbb.js" as="script" /><link rel="prefetch" href="/assets/6. JavaEE环境搭建.html.9b2c9440.js" as="script" /><link rel="prefetch" href="/assets/index.html.d1feb937.js" as="script" /><link rel="prefetch" href="/assets/1. Vue 核心.html.0bdfc233.js" as="script" /><link rel="prefetch" href="/assets/2. 组件化编程.html.9e2cd648.js" as="script" /><link rel="prefetch" href="/assets/3. 脚手架.html.93c64fac.js" as="script" /><link rel="prefetch" href="/assets/index.html.d5310d1d.js" as="script" /><link rel="prefetch" href="/assets/index.html.75f22939.js" as="script" /><link rel="prefetch" href="/assets/@RestController 指定主路径无效踩坑.html.5333c20e.js" as="script" /><link rel="prefetch" href="/assets/@XXmapping注解.html.aacfcb9f.js" as="script" /><link rel="prefetch" href="/assets/Cookie 存 JSON.html.fca9d101.js" as="script" /><link rel="prefetch" href="/assets/Filter 过滤器.html.789d4b63.js" as="script" /><link rel="prefetch" href="/assets/SSM 环境搭建.html.8579ea06.js" as="script" /><link rel="prefetch" href="/assets/TypeReference 获取泛型属性.html.937927d3.js" as="script" /><link rel="prefetch" href="/assets/index.html.330f14ae.js" as="script" /><link rel="prefetch" href="/assets/resultType_int 返回值是 null.html.26512993.js" as="script" /><link rel="prefetch" href="/assets/sentinel 规则持久化.html.35624930.js" as="script" /><link rel="prefetch" href="/assets/v-modeldisabled 和 disabled 踩坑.html.9378821b.js" as="script" /><link rel="prefetch" href="/assets/函数式编程.html.498affc5.js" as="script" /><link rel="prefetch" href="/assets/原来 @Autowired 注解还可以这么玩？.html.5dfcb760.js" as="script" /><link rel="prefetch" href="/assets/处理器方法的返回值.html.7998aadf.js" as="script" /><link rel="prefetch" href="/assets/请求转发与请求重定向.html.a0d8ddad.js" as="script" /><link rel="prefetch" href="/assets/1.设计模式七大原则.html.985c0fba.js" as="script" /><link rel="prefetch" href="/assets/2.创建型模式.html.ad12a6c0.js" as="script" /><link rel="prefetch" href="/assets/全局异常处理.html.04a85afa.js" as="script" /><link rel="prefetch" href="/assets/分页查询.html.6f4fb33b.js" as="script" /><link rel="prefetch" href="/assets/用户中心.html.a69761d6.js" as="script" /><link rel="prefetch" href="/assets/自定义消息转换器.html.1d64d5b7.js" as="script" /><link rel="prefetch" href="/assets/自定义自动填充.html.6041bf58.js" as="script" /><link rel="prefetch" href="/assets/谷粒商城.html.223431b5.js" as="script" /><link rel="prefetch" href="/assets/1. Java语言概述与开发环境.html.f2fba372.js" as="script" /><link rel="prefetch" href="/assets/10. 面向对象（下）.html.904fb901.js" as="script" /><link rel="prefetch" href="/assets/11. 与运行环境交互.html.a725b6cf.js" as="script" /><link rel="prefetch" href="/assets/12. Java集合.html.3926c9b7.js" as="script" /><link rel="prefetch" href="/assets/13. 泛型.html.f22b6d38.js" as="script" /><link rel="prefetch" href="/assets/14. 函数式编程.html.0f9a4beb.js" as="script" /><link rel="prefetch" href="/assets/15. 异常处理.html.e66e40b5.js" as="script" /><link rel="prefetch" href="/assets/16. 注解.html.1c56aa4f.js" as="script" /><link rel="prefetch" href="/assets/17. IO流.html.d86ee9e5.js" as="script" /><link rel="prefetch" href="/assets/18. 多线程.html.3aee1473.js" as="script" /><link rel="prefetch" href="/assets/19. 类加载机制与反射.html.9591beca.js" as="script" /><link rel="prefetch" href="/assets/2. 第一个java程序.html.68e26cfc.js" as="script" /><link rel="prefetch" href="/assets/3. Java程序的基本规则.html.8cb40ec5.js" as="script" /><link rel="prefetch" href="/assets/4. 数据类型.html.e808e72c.js" as="script" /><link rel="prefetch" href="/assets/5. 运算符.html.9bd48e14.js" as="script" /><link rel="prefetch" href="/assets/6. 流程控制.html.a2995941.js" as="script" /><link rel="prefetch" href="/assets/7. 面向对象（上）.html.43c51ad1.js" as="script" /><link rel="prefetch" href="/assets/8. 数组.html.78551c73.js" as="script" /><link rel="prefetch" href="/assets/9. 数组的常见算法.html.3dac62aa.js" as="script" /><link rel="prefetch" href="/assets/1. 创建与管理数据库.html.9ca20cee.js" as="script" /><link rel="prefetch" href="/assets/2. 创建与管理数据表.html.2ab3b7e9.js" as="script" /><link rel="prefetch" href="/assets/3. 约束管理.html.4004d716.js" as="script" /><link rel="prefetch" href="/assets/4. 数据表的基本操作.html.a2d48c17.js" as="script" /><link rel="prefetch" href="/assets/5. 视图.html.fd964024.js" as="script" /><link rel="prefetch" href="/assets/6. 索引.html.54ba4f85.js" as="script" /><link rel="prefetch" href="/assets/7. 事务.html.29eeb637.js" as="script" /><link rel="prefetch" href="/assets/1. 准备.html.cc79ffa6.js" as="script" /><link rel="prefetch" href="/assets/10. 注解.html.4f9a8c7d.js" as="script" /><link rel="prefetch" href="/assets/11. 复杂查询环境搭建.html.f7fee393.js" as="script" /><link rel="prefetch" href="/assets/12. 动态 SQL.html.2db5b3e7.js" as="script" /><link rel="prefetch" href="/assets/13. MybatisPlus-基础篇.html.1351f23a.js" as="script" /><link rel="prefetch" href="/assets/14. MybatisPlus-高级篇.html.af93dbce.js" as="script" /><link rel="prefetch" href="/assets/2. 使用.html.880a2235.js" as="script" /><link rel="prefetch" href="/assets/3. 主要类介绍.html.b1b84651.js" as="script" /><link rel="prefetch" href="/assets/4. 配置文件详解.html.39a8a41a.js" as="script" /><link rel="prefetch" href="/assets/5. CRUD.html.0f0a15ba.js" as="script" /><link rel="prefetch" href="/assets/6. 配置 environments.html.71c3e9d2.js" as="script" /><link rel="prefetch" href="/assets/7. ResultMap 结果集映射.html.dbf1043e.js" as="script" /><link rel="prefetch" href="/assets/8. 日志.html.47ea221c.js" as="script" /><link rel="prefetch" href="/assets/9. 分页.html.e0bcf4fb.js" as="script" /><link rel="prefetch" href="/assets/index.html.f09f5f90.js" as="script" /><link rel="prefetch" href="/assets/0. Maven.html.07d4f45e.js" as="script" /><link rel="prefetch" href="/assets/1. HTML.html.3990e37f.js" as="script" /><link rel="prefetch" href="/assets/10. JavaBean.html.c252fa92.js" as="script" /><link rel="prefetch" href="/assets/11. MVC 模式与三层架构的区别.html.07284c6c.js" as="script" /><link rel="prefetch" href="/assets/12. Filter.html.5ac4efb9.js" as="script" /><link rel="prefetch" href="/assets/13. 监听器.html.121bf9bd.js" as="script" /><link rel="prefetch" href="/assets/14. JDBC.html.d4fc5c8c.js" as="script" /><link rel="prefetch" href="/assets/15. Ajax.html.34d98194.js" as="script" /><link rel="prefetch" href="/assets/2. CSS.html.00dd5ef7.js" as="script" /><link rel="prefetch" href="/assets/3. JavaScript.html.1c722ad1.js" as="script" /><link rel="prefetch" href="/assets/4. jQuery.html.0b0e3379.js" as="script" /><link rel="prefetch" href="/assets/5. xml 和 json.html.231678b0.js" as="script" /><link rel="prefetch" href="/assets/6. tomcat.html.582499ff.js" as="script" /><link rel="prefetch" href="/assets/7. Servlet.html.c21123a3.js" as="script" /><link rel="prefetch" href="/assets/8. Cookie 和 Session.html.50bd45bf.js" as="script" /><link rel="prefetch" href="/assets/9. JSP.html.109f2f5c.js" as="script" /><link rel="prefetch" href="/assets/1. Redis 常见命令.html.3d9f94c8.js" as="script" /><link rel="prefetch" href="/assets/2. Redis 的 Java 客户端.html.7a2e352d.js" as="script" /><link rel="prefetch" href="/assets/index.html.2f2bc64e.js" as="script" /><link rel="prefetch" href="/assets/1. 短信登录.html.7a500239.js" as="script" /><link rel="prefetch" href="/assets/10. 用户签到.html.ab6d8d3f.js" as="script" /><link rel="prefetch" href="/assets/11. UV统计.html.c1e8901f.js" as="script" /><link rel="prefetch" href="/assets/2. 商户查询缓存.html.2a840fae.js" as="script" /><link rel="prefetch" href="/assets/3. 优惠券秒杀.html.77bc3f28.js" as="script" /><link rel="prefetch" href="/assets/4. 分布式锁.html.67f607e0.js" as="script" /><link rel="prefetch" href="/assets/5. 秒杀优化.html.6eeb92c2.js" as="script" /><link rel="prefetch" href="/assets/6. Redis 消息队列.html.5868b933.js" as="script" /><link rel="prefetch" href="/assets/7. 达人探店.html.fb270e6c.js" as="script" /><link rel="prefetch" href="/assets/8. 好友关注.html.b7d09d63.js" as="script" /><link rel="prefetch" href="/assets/9. 附近商户.html.ad5a0215.js" as="script" /><link rel="prefetch" href="/assets/1. IOC.html.e10162dd.js" as="script" /><link rel="prefetch" href="/assets/10. 整合 Mybatis.html.05faafa7.js" as="script" /><link rel="prefetch" href="/assets/11. 事务.html.802b399c.js" as="script" /><link rel="prefetch" href="/assets/12.  web 项目中使用容器对象.html.f708c26b.js" as="script" /><link rel="prefetch" href="/assets/2. Spring创建对象.html.dff76b44.js" as="script" /><link rel="prefetch" href="/assets/3. DI 依赖注入.html.45abc3a5.js" as="script" /><link rel="prefetch" href="/assets/4. Spring 配置.html.66df6bff.js" as="script" /><link rel="prefetch" href="/assets/5. Bean 自动装配.html.2f120d56.js" as="script" /><link rel="prefetch" href="/assets/6. 使用注解开发.html.7acfd691.js" as="script" /><link rel="prefetch" href="/assets/7. 使用 java 方式配置 Spring.html.755827af.js" as="script" /><link rel="prefetch" href="/assets/8. 代理模式.html.f8fca6f2.js" as="script" /><link rel="prefetch" href="/assets/9. Spring AOP.html.d179a88d.js" as="script" /><link rel="prefetch" href="/assets/1. SpringBoot.html.eaadeeaf.js" as="script" /><link rel="prefetch" href="/assets/2. JavaConfig.html.f213a673.js" as="script" /><link rel="prefetch" href="/assets/3. Web组件.html.24395cd9.js" as="script" /><link rel="prefetch" href="/assets/4. ORM 操作 MySQL.html.6deba81a.js" as="script" /><link rel="prefetch" href="/assets/5. RESTful.html.98457ec7.js" as="script" /><link rel="prefetch" href="/assets/6. 总结.html.ad9e8616.js" as="script" /><link rel="prefetch" href="/assets/index.html.7ac9d5b6.js" as="script" /><link rel="prefetch" href="/assets/1. 认识微服务.html.a5063106.js" as="script" /><link rel="prefetch" href="/assets/10. 初识 Docker.html.8caf6ebd.js" as="script" /><link rel="prefetch" href="/assets/11. Centos 7 安装 Docker.html.5c792cd0.js" as="script" /><link rel="prefetch" href="/assets/12. Docker 基本操作.html.99c2b2e7.js" as="script" /><link rel="prefetch" href="/assets/13. Dockerfile 自定义镜像.html.6a994d48.js" as="script" /><link rel="prefetch" href="/assets/14. Docker-Compose.html.f96156ad.js" as="script" /><link rel="prefetch" href="/assets/15. Docker 镜像仓库.html.bb35b839.js" as="script" /><link rel="prefetch" href="/assets/16. 初识MQ.html.dab86329.js" as="script" /><link rel="prefetch" href="/assets/17. RabbitMQ 安装.html.4d691749.js" as="script" /><link rel="prefetch" href="/assets/18. MQ 快速入门.html.91356f6a.js" as="script" /><link rel="prefetch" href="/assets/19. SpringAMQP.html.f5f286bc.js" as="script" /><link rel="prefetch" href="/assets/2. 服务的远程调用.html.a9f7bb18.js" as="script" /><link rel="prefetch" href="/assets/20. elasticsearch.html.b80e127c.js" as="script" /><link rel="prefetch" href="/assets/21. 安装 es、kibana.html.6205cb44.js" as="script" /><link rel="prefetch" href="/assets/22. 索引库操作.html.e949325e.js" as="script" /><link rel="prefetch" href="/assets/23. 文档操作.html.507826d8.js" as="script" /><link rel="prefetch" href="/assets/24. RestAPI.html.d400396a.js" as="script" /><link rel="prefetch" href="/assets/25. RestClient 操作文档.html.cbbfd47d.js" as="script" /><link rel="prefetch" href="/assets/26. DSL查询文档.html.419c756c.js" as="script" /><link rel="prefetch" href="/assets/27. 搜索结果处理.html.450cdfbc.js" as="script" /><link rel="prefetch" href="/assets/28. RestClient 查询文档.html.a1deddc0.js" as="script" /><link rel="prefetch" href="/assets/29. 黑马旅游案例.html.591ad1af.js" as="script" /><link rel="prefetch" href="/assets/3. Eureka 注册中心.html.851fbc30.js" as="script" /><link rel="prefetch" href="/assets/30. 数据聚合.html.ae055f0f.js" as="script" /><link rel="prefetch" href="/assets/31. 自动补全.html.a14b13cc.js" as="script" /><link rel="prefetch" href="/assets/32. 数据同步.html.f85878d2.js" as="script" /><link rel="prefetch" href="/assets/33. 集群.html.fc86227f.js" as="script" /><link rel="prefetch" href="/assets/4. Ribbon 负载均衡.html.aa37917a.js" as="script" /><link rel="prefetch" href="/assets/5. Nacos 注册中心.html.b65887e9.js" as="script" /><link rel="prefetch" href="/assets/6. Nacos 配置管理.html.27f302c6.js" as="script" /><link rel="prefetch" href="/assets/7. Nacos 集群搭建.html.80203801.js" as="script" /><link rel="prefetch" href="/assets/8. Feign 远程调用.html.ea80c08c.js" as="script" /><link rel="prefetch" href="/assets/9. Gateway 服务网关.html.8e74ad30.js" as="script" /><link rel="prefetch" href="/assets/1. 第一个SpringMVC程序.html.b4ded7bc.js" as="script" /><link rel="prefetch" href="/assets/10. 拦截器.html.5b3dd069.js" as="script" /><link rel="prefetch" href="/assets/2. 配置视图解析器.html.eafceaca.js" as="script" /><link rel="prefetch" href="/assets/3. 控制请求方式.html.f8738e7c.js" as="script" /><link rel="prefetch" href="/assets/4. 处理器方法的参数.html.a8bf6c65.js" as="script" /><link rel="prefetch" href="/assets/5. 处理器方法的返回值.html.ad523aba.js" as="script" /><link rel="prefetch" href="/assets/6. url-pattern.html.974a35a2.js" as="script" /><link rel="prefetch" href="/assets/7. SSM整合.html.0f15be10.js" as="script" /><link rel="prefetch" href="/assets/8. 请求重定向和转发.html.c32e9745.js" as="script" /><link rel="prefetch" href="/assets/9. 异常处理.html.227ea1d4.js" as="script" /><link rel="prefetch" href="/assets/index.html.99094a3f.js" as="script" /><link rel="prefetch" href="/assets/ThreadLocal.html.d57e9cfb.js" as="script" /><link rel="prefetch" href="/assets/1. Dubbo 框架.html.915752e9.js" as="script" /><link rel="prefetch" href="/assets/2. 直连方式.html.5ceeaf75.js" as="script" /><link rel="prefetch" href="/assets/3. 改造 Dubbo 项目.html.a006ace3.js" as="script" /><link rel="prefetch" href="/assets/4. 常用标签.html.de1ca3cf.js" as="script" /><link rel="prefetch" href="/assets/5. 注册中心-Zookeeper.html.dc29cd15.js" as="script" /><link rel="prefetch" href="/assets/6. 使用 Zookeeper.html.9aa121ed.js" as="script" /><link rel="prefetch" href="/assets/7. Dubbo 的配置.html.76e5597c.js" as="script" /><link rel="prefetch" href="/assets/8. 监控中心.html.8925e0d5.js" as="script" /><link rel="prefetch" href="/assets/index.html.13952278.js" as="script" /><link rel="prefetch" href="/assets/404.html.d2e787a3.js" as="script" /><link rel="prefetch" href="/assets/index.html.8c64f3c0.js" as="script" /><link rel="prefetch" href="/assets/index.html.acb605c6.js" as="script" /><link rel="prefetch" href="/assets/index.html.ad9c01cc.js" as="script" /><link rel="prefetch" href="/assets/index.html.267c1d8a.js" as="script" /><link rel="prefetch" href="/assets/index.html.f0966a5c.js" as="script" /><link rel="prefetch" href="/assets/index.html.e1a1debb.js" as="script" /><link rel="prefetch" href="/assets/index.html.25a2a3e5.js" as="script" /><link rel="prefetch" href="/assets/index.html.bae195e9.js" as="script" /><link rel="prefetch" href="/assets/index.html.3f1b6999.js" as="script" /><link rel="prefetch" href="/assets/index.html.bcdc4fcd.js" as="script" /><link rel="prefetch" href="/assets/index.html.3a450f69.js" as="script" /><link rel="prefetch" href="/assets/index.html.cfc710da.js" as="script" /><link rel="prefetch" href="/assets/index.html.c8569a51.js" as="script" /><link rel="prefetch" href="/assets/index.html.06df55a6.js" as="script" /><link rel="prefetch" href="/assets/index.html.05e29a38.js" as="script" /><link rel="prefetch" href="/assets/index.html.3cd442dd.js" as="script" /><link rel="prefetch" href="/assets/index.html.f3749220.js" as="script" /><link rel="prefetch" href="/assets/index.html.fed3d770.js" as="script" /><link rel="prefetch" href="/assets/index.html.cc714488.js" as="script" /><link rel="prefetch" href="/assets/index.html.573f1825.js" as="script" /><link rel="prefetch" href="/assets/index.html.5d9d4beb.js" as="script" /><link rel="prefetch" href="/assets/photoswipe.esm.a73472bf.js" as="script" />
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to content</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/" class="brand"><img class="logo" src="/logo.svg" alt="空~"><!----><span class="site-name hide-in-pad">空~</span></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/" class="nav-link" aria-label="主页"><span class="icon iconfont icon-home"></span>主页<!----></a></div><div class="nav-item hide-in-mobile"><a href="/docs/guide/" class="nav-link" aria-label="学习指南"><span class="icon iconfont icon-creative"></span>学习指南<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Java 基础"><span class="title"><span class="icon iconfont icon-java"></span>Java 基础</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/docs/Java%20%E5%9F%BA%E7%A1%80/Java/1.%20Java%E8%AF%AD%E8%A8%80%E6%A6%82%E8%BF%B0%E4%B8%8E%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83.html" class="nav-link" aria-label="JavaSE"><span class="icon iconfont icon-java"></span>JavaSE<!----></a></li><li class="dropdown-item"><a href="/docs/Java%20%E5%9F%BA%E7%A1%80/MySQL/1.%20%E5%88%9B%E5%BB%BA%E4%B8%8E%E7%AE%A1%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93.html" class="nav-link" aria-label="MySQL"><span class="icon iconfont icon-mysql"></span>MySQL<!----></a></li><li class="dropdown-item"><a href="/docs/Java%20%E5%9F%BA%E7%A1%80/javaWeb/0.%20Maven.html" class="nav-link" aria-label="JavaWeb"><span class="icon iconfont icon-Apache"></span>JavaWeb<!----></a></li><li class="dropdown-item"><a href="/docs/Java%20%E5%9F%BA%E7%A1%80/Mybatis/" class="nav-link" aria-label="Mybatis"><span class="icon iconfont icon-stack"></span>Mybatis<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Spring系列"><span class="title"><span class="icon iconfont icon-stack"></span>Spring系列</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/docs/Spring%20%E7%B3%BB%E5%88%97/Spring/1.%20IOC.html" class="nav-link" aria-label="Spring"><span class="icon iconfont icon-module"></span>Spring<!----></a></li><li class="dropdown-item"><a href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringMVC/" class="nav-link" aria-label="SpringMVC"><span class="icon iconfont icon-module"></span>SpringMVC<!----></a></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>SpringBoot</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringBoot/" class="nav-link" aria-label="SpringBoot"><span class="icon iconfont icon-module"></span>SpringBoot<!----></a></li><li class="dropdown-subitem"><a href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringBoot/Dubbo/" class="nav-link" aria-label="Dubbo"><span class="icon iconfont icon-tool"></span>Dubbo<!----></a></li></ul></li><li class="dropdown-item"><a href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/1.%20%E8%AE%A4%E8%AF%86%E5%BE%AE%E6%9C%8D%E5%8A%A1.html" class="nav-link" aria-label="SpringCloud"><span class="icon iconfont icon-module"></span>SpringCloud<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="/docs/Git/" class="nav-link" aria-label="Git"><span class="icon iconfont icon-git"></span>Git<!----></a></div><div class="nav-item hide-in-mobile"><a href="/docs/Vue/" class="nav-link" aria-label="Vue"><span class="icon iconfont icon-vue"></span>Vue<!----></a></div><div class="nav-item hide-in-mobile"><a href="/docs/Linux/" class="nav-link" aria-label="Linux"><span class="icon iconfont icon-linux"></span>Linux<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Redis"><span class="title"><span class="icon iconfont icon-redis"></span>Redis</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/docs/Redis/Redis%20%E5%9F%BA%E7%A1%80/" class="nav-link" aria-label="Redis 基础"><span class="icon iconfont icon-redis"></span>Redis 基础<!----></a></li><li class="dropdown-item"><a href="/docs/Redis/Redis%20%E5%AE%9E%E6%88%98/1.%20%E7%9F%AD%E4%BF%A1%E7%99%BB%E5%BD%95.html" class="nav-link" aria-label="Redis 实战"><span class="icon iconfont icon-redis"></span>Redis 实战<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="/docs/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/1.%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B8%83%E5%A4%A7%E5%8E%9F%E5%88%99.html" class="nav-link" aria-label="设计模式"><span class="icon iconfont icon-tool"></span>设计模式<!----></a></div><div class="nav-item hide-in-mobile"><a href="/docs/%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E.html" class="nav-link" aria-label="项目笔记"><span class="icon iconfont icon-tool"></span>项目笔记<!----></a></div><div class="nav-item hide-in-mobile"><a href="/docs/%E5%B0%8F%E8%AE%B0/" class="nav-link" aria-label="小记"><span class="icon iconfont icon-write"></span>小记<!----></a></div></nav><!--[--><!----><!--]--></div><div class="navbar-right"><!--[--><!----><!--]--><!----><div class="nav-item"><a class="repo-link" href="https://github.com/SurplusFate/SurplusFate.github.io" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button class="outlook-button" tabindex="-1" ariahidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><form class="search-box" role="search"><input type="search" placeholder="Search" autocomplete="off" spellcheck="false" value><!----></form><!--[--><!----><!--]--><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><a href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/1.%20%E8%AE%A4%E8%AF%86%E5%BE%AE%E6%9C%8D%E5%8A%A1.html" class="nav-link sidebar-link sidebar-page" aria-label="1. 认识微服务"><span class="icon iconfont icon-note"></span>1. 认识微服务<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/2.%20%E6%9C%8D%E5%8A%A1%E7%9A%84%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8.html" class="nav-link sidebar-link sidebar-page" aria-label="2. 服务拆分和远程调用"><span class="icon iconfont icon-note"></span>2. 服务拆分和远程调用<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/3.%20Eureka%20%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83.html" class="nav-link sidebar-link sidebar-page" aria-label="3. Eureka 注册中心"><span class="icon iconfont icon-note"></span>3. Eureka 注册中心<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/4.%20Ribbon%20%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1.html" class="nav-link sidebar-link sidebar-page" aria-label="4. Ribbon 负载均衡"><span class="icon iconfont icon-note"></span>4. Ribbon 负载均衡<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/5.%20Nacos%20%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83.html" class="nav-link sidebar-link sidebar-page" aria-label="5. Nacos 注册中心"><span class="icon iconfont icon-note"></span>5. Nacos 注册中心<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/6.%20Nacos%20%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86.html" class="nav-link sidebar-link sidebar-page" aria-label="6. Nacos 配置管理"><span class="icon iconfont icon-note"></span>6. Nacos 配置管理<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/7.%20Nacos%20%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA.html" class="nav-link sidebar-link sidebar-page" aria-label="7. Nacos 集群搭建"><span class="icon iconfont icon-note"></span>7. Nacos 集群搭建<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/8.%20Feign%20%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8.html" class="nav-link sidebar-link sidebar-page" aria-label="8. Feign 远程调用"><span class="icon iconfont icon-note"></span>8. Feign 远程调用<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/9.%20Gateway%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E5%85%B3.html" class="nav-link sidebar-link sidebar-page" aria-label="9. Gateway 服务网关"><span class="icon iconfont icon-note"></span>9. Gateway 服务网关<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/10.%20%E5%88%9D%E8%AF%86%20Docker.html" class="nav-link sidebar-link sidebar-page" aria-label="10. 初识 Docker"><span class="icon iconfont icon-note"></span>10. 初识 Docker<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/11.%20Centos%207%20%E5%AE%89%E8%A3%85%20Docker.html" class="nav-link sidebar-link sidebar-page" aria-label="11. Centos 安装 Docker"><span class="icon iconfont icon-note"></span>11. Centos 安装 Docker<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/12.%20Docker%20%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C.html" class="nav-link sidebar-link sidebar-page" aria-label="12. Docker 的基本操作"><span class="icon iconfont icon-note"></span>12. Docker 的基本操作<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/13.%20Dockerfile%20%E8%87%AA%E5%AE%9A%E4%B9%89%E9%95%9C%E5%83%8F.html" class="nav-link sidebar-link sidebar-page" aria-label="13. Dockerfile 自定义镜像"><span class="icon iconfont icon-note"></span>13. Dockerfile 自定义镜像<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/14.%20Docker-Compose.html" class="nav-link sidebar-link sidebar-page" aria-label="14. Docker-Compose"><span class="icon iconfont icon-note"></span>14. Docker-Compose<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/15.%20Docker%20%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93.html" class="nav-link sidebar-link sidebar-page" aria-label="15. Docker 镜像仓库"><span class="icon iconfont icon-note"></span>15. Docker 镜像仓库<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/16.%20%E5%88%9D%E8%AF%86MQ.html" class="nav-link sidebar-link sidebar-page" aria-label="16.初识 MQ"><span class="icon iconfont icon-note"></span>16.初识 MQ<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/17.%20RabbitMQ%20%E5%AE%89%E8%A3%85.html" class="nav-link sidebar-link sidebar-page" aria-label="17. RabbitMQ 部署指南"><span class="icon iconfont icon-note"></span>17. RabbitMQ 部署指南<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/18.%20MQ%20%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8.html" class="nav-link sidebar-link sidebar-page" aria-label="18. MQ 快速入门"><span class="icon iconfont icon-note"></span>18. MQ 快速入门<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/19.%20SpringAMQP.html" class="nav-link sidebar-link sidebar-page" aria-label="19. SpringAMQP"><span class="icon iconfont icon-note"></span>19. SpringAMQP<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/20.%20elasticsearch.html" class="nav-link sidebar-link sidebar-page" aria-label="20. elasticsearch"><span class="icon iconfont icon-note"></span>20. elasticsearch<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/21.%20%E5%AE%89%E8%A3%85%20es%E3%80%81kibana.html" class="nav-link sidebar-link sidebar-page" aria-label="21. 安装 es、kibana"><span class="icon iconfont icon-note"></span>21. 安装 es、kibana<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/22.%20%E7%B4%A2%E5%BC%95%E5%BA%93%E6%93%8D%E4%BD%9C.html" class="nav-link sidebar-link sidebar-page" aria-label="22. 索引库操作"><span class="icon iconfont icon-note"></span>22. 索引库操作<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/23.%20%E6%96%87%E6%A1%A3%E6%93%8D%E4%BD%9C.html" class="nav-link sidebar-link sidebar-page" aria-label="23. 文档操作"><span class="icon iconfont icon-note"></span>23. 文档操作<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/24.%20RestAPI.html" class="nav-link sidebar-link sidebar-page" aria-label="24. RestAPI"><span class="icon iconfont icon-note"></span>24. RestAPI<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/25.%20RestClient%20%E6%93%8D%E4%BD%9C%E6%96%87%E6%A1%A3.html" class="nav-link sidebar-link sidebar-page" aria-label="25. RestClient 操作文档"><span class="icon iconfont icon-note"></span>25. RestClient 操作文档<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/26.%20DSL%E6%9F%A5%E8%AF%A2%E6%96%87%E6%A1%A3.html" class="nav-link sidebar-link sidebar-page" aria-label="26. DSL 查询文档"><span class="icon iconfont icon-note"></span>26. DSL 查询文档<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/27.%20%E6%90%9C%E7%B4%A2%E7%BB%93%E6%9E%9C%E5%A4%84%E7%90%86.html" class="nav-link sidebar-link sidebar-page" aria-label="27. 搜索结果处理"><span class="icon iconfont icon-note"></span>27. 搜索结果处理<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/28.%20RestClient%20%E6%9F%A5%E8%AF%A2%E6%96%87%E6%A1%A3.html" class="nav-link sidebar-link sidebar-page" aria-label="28. RestClient 查询文档"><span class="icon iconfont icon-note"></span>28. RestClient 查询文档<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/29.%20%E9%BB%91%E9%A9%AC%E6%97%85%E6%B8%B8%E6%A1%88%E4%BE%8B.html" class="nav-link sidebar-link sidebar-page" aria-label="29. 黑马旅游案例"><span class="icon iconfont icon-note"></span>29. 黑马旅游案例<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/30.%20%E6%95%B0%E6%8D%AE%E8%81%9A%E5%90%88.html" class="nav-link sidebar-link sidebar-page" aria-label="30. 数据聚合"><span class="icon iconfont icon-note"></span>30. 数据聚合<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/31.%20%E8%87%AA%E5%8A%A8%E8%A1%A5%E5%85%A8.html" class="nav-link sidebar-link sidebar-page" aria-label="31. 自动补全"><span class="icon iconfont icon-note"></span>31. 自动补全<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/32.%20%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5.html" class="nav-link sidebar-link sidebar-page" aria-label="32. 数据同步"><span class="icon iconfont icon-note"></span>32. 数据同步<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/33.%20%E9%9B%86%E7%BE%A4.html" class="nav-link sidebar-link sidebar-page" aria-label="33. 集群"><span class="icon iconfont icon-note"></span>33. 集群<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/34.%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="34. 微服务保护"><span class="icon iconfont icon-note"></span>34. 微服务保护<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/34.%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4.html#_1-初识-sentinel" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.初识 Sentinel"><!---->1.初识 Sentinel<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/34.%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4.html#_1-1-雪崩问题及解决方案" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.1.雪崩问题及解决方案"><!---->1.1.雪崩问题及解决方案<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/34.%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4.html#_1-2-服务保护技术对比" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.2.服务保护技术对比"><!---->1.2.服务保护技术对比<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/34.%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4.html#_1-3-sentinel-介绍和安装" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.3.Sentinel 介绍和安装"><!---->1.3.Sentinel 介绍和安装<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/34.%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4.html#_1-4-微服务整合-sentinel" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.4.微服务整合 Sentinel"><!---->1.4.微服务整合 Sentinel<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/34.%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4.html#_2-流量控制" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.流量控制"><!---->2.流量控制<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/34.%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4.html#_2-1-簇点链路" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.1.簇点链路"><!---->2.1.簇点链路<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/34.%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4.html#_2-1-快速入门" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.1.快速入门"><!---->2.1.快速入门<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/34.%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4.html#_2-2-流控模式" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.2.流控模式"><!---->2.2.流控模式<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/34.%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4.html#_2-3-流控效果" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.3.流控效果"><!---->2.3.流控效果<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/34.%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4.html#_2-4-热点参数限流" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.4.热点参数限流"><!---->2.4.热点参数限流<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/34.%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4.html#_2-4-3-案例" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.4.3.案例"><!---->2.4.3.案例<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/34.%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4.html#_3-隔离和降级" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.隔离和降级"><!---->3.隔离和降级<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/34.%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4.html#_3-1-feignclient-整合-sentinel" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.1.FeignClient 整合 Sentinel"><!---->3.1.FeignClient 整合 Sentinel<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/34.%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4.html#_3-2-线程隔离-舱壁模式" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.2.线程隔离（舱壁模式）"><!---->3.2.线程隔离（舱壁模式）<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/34.%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4.html#_3-3-熔断降级" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.3.熔断降级"><!---->3.3.熔断降级<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/34.%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4.html#_4-授权规则" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4.授权规则"><!---->4.授权规则<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/34.%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4.html#_4-1-授权规则" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4.1.授权规则"><!---->4.1.授权规则<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/34.%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4.html#_4-2-自定义异常结果" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4.2.自定义异常结果"><!---->4.2.自定义异常结果<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/34.%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4.html#_5-规则持久化" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5.规则持久化"><!---->5.规则持久化<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/34.%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4.html#_5-1-规则管理模式" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5.1.规则管理模式"><!---->5.1.规则管理模式<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/34.%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4.html#_5-2-实现-push-模式" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5.2.实现 push 模式"><!---->5.2.实现 push 模式<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li></ul><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><span class="icon iconfont icon-note"></span>34. 微服务保护</h1><div class="page-info"><span class="author-info" aria-label="作者🖊" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="author-item" href="https://SurplusFate.github.io" target="_blank" rel="noopener noreferrer">空~</a></span><span property="author" content="空~"></span></span><!----><span class="date-info" aria-label="写作日期📅" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span>2022年11月14日</span><meta property="datePublished" content="2022-11-14T00:00:00.000Z"></span><span class="category-info" aria-label="分类🌈" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><ul class="categories-wrapper"><li><span class="category category7 clickable" role="navigation">SpringCloud</span></li></ul><meta property="articleSection" content="SpringCloud"></span><!----><span class="reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 32 分钟</span><meta property="timeRequired" content="PT32M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">此页内容</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/34.%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4.html#_1-初识-sentinel" class="router-link-active router-link-exact-active toc-link level2">1.初识 Sentinel</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/34.%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4.html#_1-1-雪崩问题及解决方案" class="router-link-active router-link-exact-active toc-link level3">1.1.雪崩问题及解决方案</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/34.%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4.html#_1-2-服务保护技术对比" class="router-link-active router-link-exact-active toc-link level3">1.2.服务保护技术对比</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/34.%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4.html#_1-3-sentinel-介绍和安装" class="router-link-active router-link-exact-active toc-link level3">1.3.Sentinel 介绍和安装</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/34.%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4.html#_1-4-微服务整合-sentinel" class="router-link-active router-link-exact-active toc-link level3">1.4.微服务整合 Sentinel</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/34.%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4.html#_2-流量控制" class="router-link-active router-link-exact-active toc-link level2">2.流量控制</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/34.%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4.html#_2-1-簇点链路" class="router-link-active router-link-exact-active toc-link level3">2.1.簇点链路</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/34.%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4.html#_2-1-快速入门" class="router-link-active router-link-exact-active toc-link level3">2.1.快速入门</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/34.%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4.html#_2-2-流控模式" class="router-link-active router-link-exact-active toc-link level3">2.2.流控模式</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/34.%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4.html#_2-3-流控效果" class="router-link-active router-link-exact-active toc-link level3">2.3.流控效果</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/34.%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4.html#_2-4-热点参数限流" class="router-link-active router-link-exact-active toc-link level3">2.4.热点参数限流</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/34.%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4.html#_2-4-3-案例" class="router-link-active router-link-exact-active toc-link level3">2.4.3.案例</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/34.%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4.html#_3-隔离和降级" class="router-link-active router-link-exact-active toc-link level2">3.隔离和降级</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/34.%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4.html#_3-1-feignclient-整合-sentinel" class="router-link-active router-link-exact-active toc-link level3">3.1.FeignClient 整合 Sentinel</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/34.%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4.html#_3-2-线程隔离-舱壁模式" class="router-link-active router-link-exact-active toc-link level3">3.2.线程隔离（舱壁模式）</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/34.%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4.html#_3-3-熔断降级" class="router-link-active router-link-exact-active toc-link level3">3.3.熔断降级</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/34.%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4.html#_4-授权规则" class="router-link-active router-link-exact-active toc-link level2">4.授权规则</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/34.%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4.html#_4-1-授权规则" class="router-link-active router-link-exact-active toc-link level3">4.1.授权规则</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/34.%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4.html#_4-2-自定义异常结果" class="router-link-active router-link-exact-active toc-link level3">4.2.自定义异常结果</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/34.%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4.html#_5-规则持久化" class="router-link-active router-link-exact-active toc-link level2">5.规则持久化</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/34.%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4.html#_5-1-规则管理模式" class="router-link-active router-link-exact-active toc-link level3">5.1.规则管理模式</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/34.%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4.html#_5-2-实现-push-模式" class="router-link-active router-link-exact-active toc-link level3">5.2.实现 push 模式</a></li><!----><!--]--></ul><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h1 id="_34-微服务保护" tabindex="-1"><a class="header-anchor" href="#_34-微服务保护" aria-hidden="true">#</a> 34. 微服务保护</h1><h2 id="_1-初识-sentinel" tabindex="-1"><a class="header-anchor" href="#_1-初识-sentinel" aria-hidden="true">#</a> 1.初识 Sentinel</h2><h3 id="_1-1-雪崩问题及解决方案" tabindex="-1"><a class="header-anchor" href="#_1-1-雪崩问题及解决方案" aria-hidden="true">#</a> 1.1.雪崩问题及解决方案</h3><h4 id="_1-1-1-雪崩问题" tabindex="-1"><a class="header-anchor" href="#_1-1-1-雪崩问题" aria-hidden="true">#</a> 1.1.1.雪崩问题</h4><p>微服务中，服务间调用关系错综复杂，一个微服务往往依赖于多个其它微服务。</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141109731.png" alt="1533829099748"></p><p>如图，如果服务提供者 I 发生了故障，当前的应用的部分业务因为依赖于服务 I，因此也会被阻塞。此时，其它不依赖于服务 I 的业务似乎不受影响。</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141110767.png" alt="1533829198240"></p><p>但是，依赖服务 I 的业务请求被阻塞，用户不会得到响应，则 tomcat 的这个线程不会释放，于是越来越多的用户请求到来，越来越多的线程会阻塞：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141110678.png" alt="1533829307389"></p><p>服务器支持的线程和并发数有限，请求一直阻塞，会导致服务器资源耗尽，从而导致所有其它服务都不可用，那么当前服务也就不可用了。</p><p>那么，依赖于当前服务的其它服务随着时间的推移，最终也都会变的不可用，形成级联失败，雪崩就发生了：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141110153.png" alt="image-20210715172710340"></p><h4 id="_1-1-2-超时处理" tabindex="-1"><a class="header-anchor" href="#_1-1-2-超时处理" aria-hidden="true">#</a> 1.1.2.超时处理</h4><p>解决雪崩问题的常见方式有四种：</p><p>•超时处理：设定超时时间，请求超过一定时间没有响应就返回错误信息，不会无休止等待</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141111421.png" alt="image-20210715172820438"></p><h4 id="_1-1-3-仓壁模式" tabindex="-1"><a class="header-anchor" href="#_1-1-3-仓壁模式" aria-hidden="true">#</a> 1.1.3.仓壁模式</h4><p>方案 2：仓壁模式</p><p>仓壁模式来源于船舱的设计：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141111278.png" alt="image-20210715172946352"></p><p>船舱都会被隔板分离为多个独立空间，当船体破损时，只会导致部分空间进入，将故障控制在一定范围内，避免整个船体都被淹没。</p><p>于此类似，我们可以限定每个业务能使用的线程数，避免耗尽整个 tomcat 的资源，因此也叫线程隔离。</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141254133.png" alt="image-20210715173215243"></p><h4 id="_1-1-4-断路器" tabindex="-1"><a class="header-anchor" href="#_1-1-4-断路器" aria-hidden="true">#</a> 1.1.4.断路器</h4><p>断路器模式：由<strong>断路器</strong>统计业务执行的异常比例，如果超出阈值则会<strong>熔断</strong>该业务，拦截访问该业务的一切请求。</p><p>断路器会统计访问某个服务的请求数量，异常比例：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141111302.png" alt="image-20210715173327075"></p><p>当发现访问服务 D 的请求异常比例过高时，认为服务 D 有导致雪崩的风险，会拦截访问服务 D 的一切请求，形成熔断：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141111597.png" alt="image-20210715173428073"></p><h4 id="_1-1-5-限流" tabindex="-1"><a class="header-anchor" href="#_1-1-5-限流" aria-hidden="true">#</a> 1.1.5.限流</h4><p><strong>流量控制</strong>：限制业务访问的 QPS，避免服务因流量的突增而故障。</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141111159.png" alt="image-20210715173555158"></p><h4 id="_1-1-6-总结" tabindex="-1"><a class="header-anchor" href="#_1-1-6-总结" aria-hidden="true">#</a> 1.1.6.总结</h4><p>什么是雪崩问题？</p><ul><li>微服务之间相互调用，因为调用链中的一个服务故障，引起整个链路都无法访问的情况。</li></ul><p>可以认为：</p><p><strong>限流</strong>是对服务的保护，避免因瞬间高并发流量而导致服务故障，进而避免雪崩。是一种<strong>预防</strong>措施。</p><p><strong>超时处理、线程隔离、降级熔断</strong>是在部分服务故障时，将故障控制在一定范围，避免雪崩。是一种<strong>补救</strong>措施。</p><h3 id="_1-2-服务保护技术对比" tabindex="-1"><a class="header-anchor" href="#_1-2-服务保护技术对比" aria-hidden="true">#</a> 1.2.服务保护技术对比</h3><p>在 SpringCloud 当中支持多种服务保护技术：</p><ul><li><a href="https://github.com/Netflix/Hystrix" target="_blank" rel="noopener noreferrer">Netfix Hystrix<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://github.com/alibaba/Sentinel" target="_blank" rel="noopener noreferrer">Sentinel<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://github.com/resilience4j/resilience4j" target="_blank" rel="noopener noreferrer">Resilience4J<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><p>早期比较流行的是 Hystrix 框架，但目前国内实用最广泛的还是阿里巴巴的 Sentinel 框架，这里我们做下对比：</p><table><thead><tr><th></th><th><strong>Sentinel</strong></th><th><strong>Hystrix</strong></th></tr></thead><tbody><tr><td>隔离策略</td><td>信号量隔离</td><td>线程池隔离/信号量隔离</td></tr><tr><td>熔断降级策略</td><td>基于慢调用比例或异常比例</td><td>基于失败比率</td></tr><tr><td>实时指标实现</td><td>滑动窗口</td><td>滑动窗口（基于 RxJava）</td></tr><tr><td>规则配置</td><td>支持多种数据源</td><td>支持多种数据源</td></tr><tr><td>扩展性</td><td>多个扩展点</td><td>插件的形式</td></tr><tr><td>基于注解的支持</td><td>支持</td><td>支持</td></tr><tr><td>限流</td><td>基于 QPS，支持基于调用关系的限流</td><td>有限的支持</td></tr><tr><td>流量整形</td><td>支持慢启动、匀速排队模式</td><td>不支持</td></tr><tr><td>系统自适应保护</td><td>支持</td><td>不支持</td></tr><tr><td>控制台</td><td>开箱即用，可配置规则、查看秒级监控、机器发现等</td><td>不完善</td></tr><tr><td>常见框架的适配</td><td>Servlet、Spring Cloud、Dubbo、gRPC 等</td><td>Servlet、Spring Cloud Netflix</td></tr></tbody></table><h3 id="_1-3-sentinel-介绍和安装" tabindex="-1"><a class="header-anchor" href="#_1-3-sentinel-介绍和安装" aria-hidden="true">#</a> 1.3.Sentinel 介绍和安装</h3><h4 id="_1-3-1-初识-sentinel" tabindex="-1"><a class="header-anchor" href="#_1-3-1-初识-sentinel" aria-hidden="true">#</a> 1.3.1.初识 Sentinel</h4><p>Sentinel 是阿里巴巴开源的一款微服务流量控制组件。官网地址：<a href="https://sentinelguard.io/zh-cn/index.html" target="_blank" rel="noopener noreferrer">https://sentinelguard.io/zh-cn/index.html<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>Sentinel 具有以下特征:</p><p>•<strong>丰富的应用场景</strong>：Sentinel 承接了阿里巴巴近 10 年的双十一大促流量的核心场景，例如秒杀（即突发流量控制在系统容量可以承受的范围）、消息削峰填谷、集群流量控制、实时熔断下游不可用应用等。</p><p>•<strong>完备的实时监控</strong>：Sentinel 同时提供实时的监控功能。您可以在控制台中看到接入应用的单台机器秒级数据，甚至 500 台以下规模的集群的汇总运行情况。</p><p>•<strong>广泛的开源生态</strong>：Sentinel 提供开箱即用的与其它开源框架/库的整合模块，例如与 Spring Cloud、Dubbo、gRPC 的整合。您只需要引入相应的依赖并进行简单的配置即可快速地接入 Sentinel。</p><p>•<strong>完善的</strong> <strong>SPI</strong> <strong>扩展点</strong>：Sentinel 提供简单易用、完善的 SPI 扩展接口。您可以通过实现扩展接口来快速地定制逻辑。例如定制规则管理、适配动态数据源等。</p><h4 id="_1-3-2-安装-sentinel" tabindex="-1"><a class="header-anchor" href="#_1-3-2-安装-sentinel" aria-hidden="true">#</a> 1.3.2.安装 Sentinel</h4><p>1）下载</p><p>sentinel 官方提供了 UI 控制台，方便我们对系统做限流设置。大家可以在<a href="https://github.com/alibaba/Sentinel/releases" target="_blank" rel="noopener noreferrer">GitHub<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>下载。</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141114811.png" alt="image-20210715174252531"></p><p>2）运行</p><p>将 jar 包放到任意非中文目录，执行命令：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">java</span> <span class="token parameter variable">-jar</span> sentinel-dashboard-1.8.1.jar
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>如果要修改 Sentinel 的默认端口、账户、密码，可以通过下列配置：</p><table><thead><tr><th><strong>配置项</strong></th><th><strong>默认值</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td>server.port</td><td>8080</td><td>服务端口</td></tr><tr><td>sentinel.dashboard.auth.username</td><td>sentinel</td><td>默认用户名</td></tr><tr><td>sentinel.dashboard.auth.password</td><td>sentinel</td><td>默认密码</td></tr></tbody></table><p>例如，修改端口：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">java</span> <span class="token parameter variable">-Dserver.port</span><span class="token operator">=</span><span class="token number">8090</span> <span class="token parameter variable">-jar</span> sentinel-dashboard-1.8.1.jar
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>3）访问</p><p>访问 <a href="http://localhost:8080" target="_blank" rel="noopener noreferrer">http://localhost:8080<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 页面，就可以看到 sentinel 的控制台了：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141116407.png" alt="image-20210715190827846"></p><p>需要输入账号和密码，默认都是：sentinel</p><p>登录后，发现一片空白，什么都没有：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141116025.png" alt="image-20210715191134448"></p><p>这是因为我们还没有与微服务整合。</p><h3 id="_1-4-微服务整合-sentinel" tabindex="-1"><a class="header-anchor" href="#_1-4-微服务整合-sentinel" aria-hidden="true">#</a> 1.4.微服务整合 Sentinel</h3><p>我们在 order-service 中整合 sentinel，并连接 sentinel 的控制台，步骤如下：</p><p>1）引入 sentinel 依赖</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!--sentinel--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-sentinel<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2）配置控制台</p><p>修改 application.yaml 文件，添加下面内容：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8088</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">sentinel</span><span class="token punctuation">:</span>
      <span class="token key atrule">transport</span><span class="token punctuation">:</span>
        <span class="token key atrule">dashboard</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8080</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3）访问 order-service 的任意端点</p><p>打开浏览器，访问 <a href="http://localhost:8088/order/101" target="_blank" rel="noopener noreferrer">http://localhost:8088/order/101<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>，这样才能触发 sentinel 的监控。</p><p>然后再访问 sentinel 的控制台，查看效果：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141119306.png" alt="image-20210715191241799"></p><h2 id="_2-流量控制" tabindex="-1"><a class="header-anchor" href="#_2-流量控制" aria-hidden="true">#</a> 2.流量控制</h2><p>雪崩问题虽然有四种方案，但是限流是避免服务因突发的流量而发生故障，是对微服务雪崩问题的预防。我们先学习这种模式。</p><h3 id="_2-1-簇点链路" tabindex="-1"><a class="header-anchor" href="#_2-1-簇点链路" aria-hidden="true">#</a> 2.1.簇点链路</h3><p>当请求进入微服务时，首先会访问 DispatcherServlet，然后进入 Controller、Service、Mapper，这样的一个调用链就叫做<strong>簇点链路</strong>。簇点链路中被监控的每一个接口就是一个<strong>资源</strong>。</p><p>默认情况下 sentinel 会监控 SpringMVC 的每一个端点（Endpoint，也就是 controller 中的方法），因此 SpringMVC 的每一个端点（Endpoint）就是调用链路中的一个资源。</p><p>例如，我们刚才访问的 order-service 中的 OrderController 中的端点：/order/{orderId}</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141139211.png" alt="image-20210715191757319"></p><p>流控、熔断等都是针对簇点链路中的资源来设置的，因此我们可以点击对应资源后面的按钮来设置规则：</p><ul><li>流控：流量控制</li><li>降级：降级熔断</li><li>热点：热点参数限流，是限流的一种</li><li>授权：请求的权限控制</li></ul><h3 id="_2-1-快速入门" tabindex="-1"><a class="header-anchor" href="#_2-1-快速入门" aria-hidden="true">#</a> 2.1.快速入门</h3><h4 id="_2-1-1-示例" tabindex="-1"><a class="header-anchor" href="#_2-1-1-示例" aria-hidden="true">#</a> 2.1.1.示例</h4><p>点击资源/order/{orderId}后面的流控按钮，就可以弹出表单。</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141139451.png" alt="image-20210715191757319"></p><p>表单中可以填写限流规则，如下：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141139013.png" alt="image-20210715192010657"></p><p>其含义是限制 /order/{orderId}这个资源的单机 QPS 为 1，即每秒只允许 1 次请求，超出的请求会被拦截并报错。</p><h4 id="_2-1-2-练习" tabindex="-1"><a class="header-anchor" href="#_2-1-2-练习" aria-hidden="true">#</a> 2.1.2.练习</h4><p>需求：给 /order/{orderId}这个资源设置流控规则，QPS 不能超过 5，然后测试。</p><p>1）首先在 sentinel 控制台添加限流规则</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141140317.png" alt="image-20210715192455429"></p><p>2）利用 jmeter 测试</p><p>选择：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141149080.png" alt="image-20210715200635414"></p><p>20 个用户，2 秒内运行完，QPS 是 10，超过了 5.</p><p>选中<code>流控入门，QPS&lt;5</code>右键运行：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141149155.png" alt="image-20210715200804594"></p><blockquote><p>注意，不要点击菜单中的执行按钮来运行。</p></blockquote><p>结果：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141149057.png" alt="image-20210715200853671"></p><p>可以看到，成功的请求每次只有 5 个</p><h3 id="_2-2-流控模式" tabindex="-1"><a class="header-anchor" href="#_2-2-流控模式" aria-hidden="true">#</a> 2.2.流控模式</h3><p>在添加限流规则时，点击高级选项，可以选择三种<strong>流控模式</strong>：</p><ul><li>直接：统计当前资源的请求，触发阈值时对当前资源直接限流，也是默认的模式</li><li>关联：统计与当前资源相关的另一个资源，触发阈值时，对当前资源限流</li><li>链路：统计从指定链路访问到本资源的请求，触发阈值时，对指定链路限流</li></ul><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141150009.png" alt="image-20210715201827886"></p><p>快速入门测试的就是直接模式。</p><h4 id="_2-2-1-关联模式" tabindex="-1"><a class="header-anchor" href="#_2-2-1-关联模式" aria-hidden="true">#</a> 2.2.1.关联模式</h4><p><strong>关联模式</strong>：统计与当前资源相关的另一个资源，触发阈值时，对当前资源限流</p><p><strong>配置规则</strong>：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141150880.png" alt="image-20210715202540786"></p><p><strong>语法说明</strong>：当/write 资源访问量触发阈值时，就会对/read 资源限流，避免影响/write 资源。</p><p><strong>使用场景</strong>：比如用户支付时需要修改订单状态，同时用户要查询订单。查询和修改操作会争抢数据库锁，产生竞争。业务需求是优先支付和更新订单的业务，因此当修改订单业务触发阈值时，需要对查询订单业务限流。</p><p><strong>需求说明</strong>：</p><ul><li><p>在 OrderController 新建两个端点：/order/query 和/order/update，无需实现业务</p></li><li><p>配置流控规则，当/order/ update 资源被访问的 QPS 超过 5 时，对/order/query 请求限流</p></li></ul><p>1）定义/order/query 端点，模拟订单查询</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/query&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">queryOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;查询订单成功&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2）定义/order/update 端点，模拟订单更新</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/update&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">updateOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;更新订单成功&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>重启服务，查看 sentinel 控制台的簇点链路：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141150036.png" alt="image-20210716101805951"></p><p>3）配置流控规则</p><p>对哪个端点限流，就点击哪个端点后面的按钮。我们是对订单查询/order/query 限流，因此点击它后面的按钮：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141150125.png" alt="image-20210716101934499"></p><p>在表单中填写流控规则：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141151519.png" alt="image-20210716102103814"></p><p>4）在 Jmeter 测试</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141151308.png" alt="image-20210716102416266"></p><p>可以看到 1000 个用户，100 秒，因此 QPS 为 10，超过了我们设定的阈值：5</p><p>查看 http 请求：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141151802.png" alt="image-20210716102532554"></p><p>请求的目标是/order/update，这样这个断点就会触发阈值。</p><p>但限流的目标是/order/query，我们在浏览器访问，可以发现：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141151714.png" alt="image-20210716102636030"></p><p>确实被限流了。</p><p>5）总结</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141151360.png" alt="image-20210716103143002"></p><h4 id="_2-2-2-链路模式" tabindex="-1"><a class="header-anchor" href="#_2-2-2-链路模式" aria-hidden="true">#</a> 2.2.2.链路模式</h4><p><strong>链路模式</strong>：只针对从指定链路访问到本资源的请求做统计，判断是否超过阈值。</p><p><strong>配置示例</strong>：</p><p>例如有两条请求链路：</p><ul><li><p>/test1 --&gt; /common</p></li><li><p>/test2 --&gt; /common</p></li></ul><p>如果只希望统计从/test2 进入到/common 的请求，则可以这样配置：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141206293.png" alt="image-20210716103536346"></p><p><strong>实战案例:</strong></p><p>需求：有查询订单和创建订单业务，两者都需要查询商品。针对从查询订单进入到查询商品的请求统计，并设置限流。</p><p>步骤：</p><ol><li><p>在 OrderService 中添加一个 queryGoods 方法，不用实现业务</p></li><li><p>在 OrderController 中，改造/order/query 端点，调用 OrderService 中的 queryGoods 方法</p></li><li><p>在 OrderController 中添加一个/order/save 的端点，调用 OrderService 的 queryGoods 方法</p></li><li><p>给 queryGoods 设置限流规则，从/order/query 进入 queryGoods 的方法限制 QPS 必须小于 2</p></li></ol><p>实现：</p><h5 id="_1-添加查询商品方法" tabindex="-1"><a class="header-anchor" href="#_1-添加查询商品方法" aria-hidden="true">#</a> 1）添加查询商品方法</h5><p>在 order-service 服务中，给 OrderService 类添加一个 queryGoods 方法：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">queryGoods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;查询商品&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_2-查询订单时-查询商品" tabindex="-1"><a class="header-anchor" href="#_2-查询订单时-查询商品" aria-hidden="true">#</a> 2）查询订单时，查询商品</h5><p>在 order-service 的 OrderController 中，修改/order/query 端点的业务逻辑：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/query&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">queryOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 查询商品</span>
    orderService<span class="token punctuation">.</span><span class="token function">queryGoods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 查询订单</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;查询订单&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string">&quot;查询订单成功&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3-新增订单-查询商品" tabindex="-1"><a class="header-anchor" href="#_3-新增订单-查询商品" aria-hidden="true">#</a> 3）新增订单，查询商品</h5><p>在 order-service 的 OrderController 中，修改/order/save 端点，模拟新增订单：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/save&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">saveOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 查询商品</span>
    orderService<span class="token punctuation">.</span><span class="token function">queryGoods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 查询订单</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;新增订单&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string">&quot;新增订单成功&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_4-给查询商品添加资源标记" tabindex="-1"><a class="header-anchor" href="#_4-给查询商品添加资源标记" aria-hidden="true">#</a> 4）给查询商品添加资源标记</h5><p>默认情况下，OrderService 中的方法是不被 Sentinel 监控的，需要我们自己通过注解来标记要监控的方法。</p><p>给 OrderService 的 queryGoods 方法添加@SentinelResource 注解：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@SentinelResource</span><span class="token punctuation">(</span><span class="token string">&quot;goods&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">queryGoods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;查询商品&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>链路模式中，是对不同来源的两个链路做监控。但是 sentinel 默认会给进入 SpringMVC 的所有请求设置同一个 root 资源，会导致链路模式失效。</p><p>我们需要关闭这种对 SpringMVC 的资源聚合，修改 order-service 服务的 application.yml 文件：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">sentinel</span><span class="token punctuation">:</span>
      <span class="token key atrule">web-context-unify</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token comment"># 关闭context整合</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>重启服务，访问/order/query 和/order/save，可以查看到 sentinel 的簇点链路规则中，出现了新的资源：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141207199.png" alt="image-20210716105227163"></p><h5 id="_5-添加流控规则" tabindex="-1"><a class="header-anchor" href="#_5-添加流控规则" aria-hidden="true">#</a> 5）添加流控规则</h5><p>点击 goods 资源后面的流控按钮，在弹出的表单中填写下面信息：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141207678.png" alt="image-20210716105408723"></p><p>只统计从/order/query 进入/goods 的资源，QPS 阈值为 2，超出则被限流。</p><h5 id="_6-jmeter-测试" tabindex="-1"><a class="header-anchor" href="#_6-jmeter-测试" aria-hidden="true">#</a> 6）Jmeter 测试</h5><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141207711.png" alt="image-20210716105612312"></p><p>可以看到这里 200 个用户，50 秒内发完，QPS 为 4，超过了我们设定的阈值 2</p><p>一个 http 请求是访问/order/save：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141208444.png" alt="image-20210716105812789"></p><p>运行的结果：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141208027.png" alt="image-20210716110027064"></p><p>完全不受影响。</p><p>另一个是访问/order/query：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141208262.png" alt="image-20210716105855951"></p><p>运行结果：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141208758.png" alt="image-20210716105956401"></p><p>每次只有 2 个通过。</p><h4 id="_2-2-3-总结" tabindex="-1"><a class="header-anchor" href="#_2-2-3-总结" aria-hidden="true">#</a> 2.2.3.总结</h4><p>流控模式有哪些？</p><p>•直接：对当前资源限流</p><p>•关联：高优先级资源触发阈值，对低优先级资源限流。</p><p>•链路：阈值统计时，只统计从指定资源进入当前资源的请求，是对请求来源的限流</p><h3 id="_2-3-流控效果" tabindex="-1"><a class="header-anchor" href="#_2-3-流控效果" aria-hidden="true">#</a> 2.3.流控效果</h3><p>在流控的高级选项中，还有一个流控效果选项：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141208708.png" alt="image-20210716110225104"></p><p>流控效果是指请求达到流控阈值时应该采取的措施，包括三种：</p><ul><li><p>快速失败：达到阈值后，新的请求会被立即拒绝并抛出 FlowException 异常。是默认的处理方式。</p></li><li><p>warm up：预热模式，对超出阈值的请求同样是拒绝并抛出异常。但这种模式阈值会动态变化，从一个较小值逐渐增加到最大阈值。</p></li><li><p>排队等待：让所有的请求按照先后次序排队执行，两个请求的间隔不能小于指定时长</p></li></ul><h4 id="_2-3-1-warm-up" tabindex="-1"><a class="header-anchor" href="#_2-3-1-warm-up" aria-hidden="true">#</a> 2.3.1.warm up</h4><p>阈值一般是一个微服务能承担的最大 QPS，但是一个服务刚刚启动时，一切资源尚未初始化（<strong>冷启动</strong>），如果直接将 QPS 跑到最大值，可能导致服务瞬间宕机。</p><p>warm up 也叫<strong>预热模式</strong>，是应对服务冷启动的一种方案。请求阈值初始值是 maxThreshold / coldFactor，持续指定时长后，逐渐提高到 maxThreshold 值。而 coldFactor 的默认值是 3.</p><p>例如，我设置 QPS 的 maxThreshold 为 10，预热时间为 5 秒，那么初始阈值就是 10 / 3 ，也就是 3，然后在 5 秒后逐渐增长到 10.</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141209046.png" alt="image-20210716110629796"></p><p><strong>案例:</strong></p><p>需求：给/order/{orderId}这个资源设置限流，最大 QPS 为 10，利用 warm up 效果，预热时长为 5 秒</p><h5 id="_1-配置流控规则" tabindex="-1"><a class="header-anchor" href="#_1-配置流控规则" aria-hidden="true">#</a> 1）配置流控规则</h5><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141209729.png" alt="image-20210716111012387"></p><h5 id="_2-jmeter-测试" tabindex="-1"><a class="header-anchor" href="#_2-jmeter-测试" aria-hidden="true">#</a> 2）Jmeter 测试</h5><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141210694.png" alt="image-20210716111136699"></p><p>QPS 为 10.</p><p>刚刚启动时，大部分请求失败，成功的只有 3 个，说明 QPS 被限定在 3：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141210237.png" alt="image-20210716111303701"></p><p>随着时间推移，成功比例越来越高：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141210642.png" alt="image-20210716111404717"></p><p>到 Sentinel 控制台查看实时监控：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141210141.png" alt="image-20210716111526480"></p><p>一段时间后：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141210103.png" alt="image-20210716111658541"></p><h4 id="_2-3-2-排队等待" tabindex="-1"><a class="header-anchor" href="#_2-3-2-排队等待" aria-hidden="true">#</a> 2.3.2.排队等待</h4><p>当请求超过 QPS 阈值时，快速失败和 warm up 会拒绝新的请求并抛出异常。</p><p>而排队等待则是让所有请求进入一个队列中，然后按照阈值允许的时间间隔依次执行。后来的请求必须等待前面执行完成，如果请求预期的等待时间超出最大时长，则会被拒绝。</p><p>工作原理</p><p>例如：QPS = 5，意味着每 200ms 处理一个队列中的请求；timeout = 2000，意味着<strong>预期等待时长</strong>超过 2000ms 的请求会被拒绝并抛出异常。</p><p>那什么叫做预期等待时长呢？</p><p>比如现在一下子来了 12 个请求，因为每 200ms 执行一个请求，那么：</p><ul><li>第 6 个请求的<strong>预期等待时长</strong> = 200 * （6 - 1） = 1000ms</li><li>第 12 个请求的预期等待时长 = 200 * （12-1） = 2200ms</li></ul><p>现在，第 1 秒同时接收到 10 个请求，但第 2 秒只有 1 个请求，此时 QPS 的曲线这样的：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141210471.png" alt="image-20210716113147176"></p><p>如果使用队列模式做流控，所有进入的请求都要排队，以固定的 200ms 的间隔执行，QPS 会变的很平滑：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141210456.png" alt="image-20210716113426524"></p><p>平滑的 QPS 曲线，对于服务器来说是更友好的。</p><p><strong>案例:</strong></p><p>需求：给/order/{orderId}这个资源设置限流，最大 QPS 为 10，利用排队的流控效果，超时时长设置为 5s</p><h5 id="_1-添加流控规则" tabindex="-1"><a class="header-anchor" href="#_1-添加流控规则" aria-hidden="true">#</a> 1）添加流控规则</h5><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141210931.png" alt="image-20210716114048918"></p><h5 id="_2-jmeter-测试-1" tabindex="-1"><a class="header-anchor" href="#_2-jmeter-测试-1" aria-hidden="true">#</a> 2）Jmeter 测试</h5><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141210203.png" alt="image-20210716114243558"></p><p>QPS 为 15，已经超过了我们设定的 10。</p><p>如果是之前的 快速失败、warmup 模式，超出的请求应该会直接报错。</p><p>但是我们看看队列模式的运行结果：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141210895.png" alt="image-20210716114429361"></p><p>全部都通过了。</p><p>再去 sentinel 查看实时监控的 QPS 曲线：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141210181.png" alt="image-20210716114522935"></p><p>QPS 非常平滑，一致保持在 10，但是超出的请求没有被拒绝，而是放入队列。因此<strong>响应时间</strong>（等待时间）会越来越长。</p><p>当队列满了以后，才会有部分请求失败：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141210027.png" alt="image-20210716114651137"></p><h4 id="_2-3-3-总结" tabindex="-1"><a class="header-anchor" href="#_2-3-3-总结" aria-hidden="true">#</a> 2.3.3.总结</h4><p>流控效果有哪些？</p><ul><li><p>快速失败：QPS 超过阈值时，拒绝新的请求</p></li><li><p>warm up： QPS 超过阈值时，拒绝新的请求；QPS 阈值是逐渐提升的，可以避免冷启动时高并发导致服务宕机。</p></li><li><p>排队等待：请求会进入队列，按照阈值允许的时间间隔依次执行请求；如果请求预期等待时长大于超时时间，直接拒绝</p></li></ul><h3 id="_2-4-热点参数限流" tabindex="-1"><a class="header-anchor" href="#_2-4-热点参数限流" aria-hidden="true">#</a> 2.4.热点参数限流</h3><p>之前的限流是统计访问某个资源的所有请求，判断是否超过 QPS 阈值。而热点参数限流是<strong>分别统计参数值相同的请求</strong>，判断是否超过 QPS 阈值。</p><h4 id="_2-4-1-全局参数限流" tabindex="-1"><a class="header-anchor" href="#_2-4-1-全局参数限流" aria-hidden="true">#</a> 2.4.1.全局参数限流</h4><p>例如，一个根据 id 查询商品的接口：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141212305.png" alt="image-20210716115014663"></p><p>访问/goods/{id}的请求中，id 参数值会有变化，热点参数限流会根据参数值分别统计 QPS，统计结果：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141212822.png" alt="image-20210716115131463"></p><p>当 id=1 的请求触发阈值被限流时，id 值不为 1 的请求不受影响。</p><p>配置示例：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141212876.png" alt="image-20210716115232426"></p><p>代表的含义是：对 hot 这个资源的 0 号参数（第一个参数）做统计，每 1 秒<strong>相同参数值</strong>的请求数不能超过 5</p><h4 id="_2-4-2-热点参数限流" tabindex="-1"><a class="header-anchor" href="#_2-4-2-热点参数限流" aria-hidden="true">#</a> 2.4.2.热点参数限流</h4><p>刚才的配置中，对查询商品这个接口的所有商品一视同仁，QPS 都限定为 5.</p><p>而在实际开发中，可能部分商品是热点商品，例如秒杀商品，我们希望这部分商品的 QPS 限制与其它商品不一样，高一些。那就需要配置热点参数限流的高级选项了：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141213865.png" alt="image-20210716115717523"></p><p>结合上一个配置，这里的含义是对 0 号的 long 类型参数限流，每 1 秒相同参数的 QPS 不能超过 5，有两个例外：</p><p>•如果参数值是 100，则每 1 秒允许的 QPS 为 10</p><p>•如果参数值是 101，则每 1 秒允许的 QPS 为 15</p><h3 id="_2-4-3-案例" tabindex="-1"><a class="header-anchor" href="#_2-4-3-案例" aria-hidden="true">#</a> 2.4.3.案例</h3><p><strong>案例需求</strong>：给/order/{orderId}这个资源添加热点参数限流，规则如下：</p><p>•默认的热点参数规则是每 1 秒请求量不超过 2</p><p>•给 102 这个参数设置例外：每 1 秒请求量不超过 4</p><p>•给 103 这个参数设置例外：每 1 秒请求量不超过 10</p><p><strong>注意事项</strong>：热点参数限流对默认的 SpringMVC 资源无效，需要利用@SentinelResource 注解标记资源</p><h4 id="_1-标记资源" tabindex="-1"><a class="header-anchor" href="#_1-标记资源" aria-hidden="true">#</a> 1）标记资源</h4><p>给 order-service 中的 OrderController 中的/order/{orderId}资源添加注解：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141213724.png" alt="image-20210716120033572"></p><h4 id="_2-热点参数限流规则" tabindex="-1"><a class="header-anchor" href="#_2-热点参数限流规则" aria-hidden="true">#</a> 2）热点参数限流规则</h4><p>访问该接口，可以看到我们标记的 hot 资源出现了：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141214085.png" alt="image-20210716120208509"></p><p>这里不要点击 hot 后面的按钮，页面有 BUG</p><p>点击左侧菜单中<strong>热点规则</strong>菜单：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141214479.png" alt="image-20210716120319009"></p><p>点击新增，填写表单：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141214210.png" alt="image-20210716120536714"></p><h4 id="_3-jmeter-测试" tabindex="-1"><a class="header-anchor" href="#_3-jmeter-测试" aria-hidden="true">#</a> 3）Jmeter 测试</h4><p>选择《热点参数限流 QPS1》：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141214253.png" alt="image-20210716120754527"></p><p>这里发起请求的 QPS 为 5.</p><p>包含 3 个 http 请求：</p><p>普通参数，QPS 阈值为 2</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141214758.png" alt="image-20210716120840501"></p><p>运行结果：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141214388.png" alt="image-20210716121105567"></p><p>例外项，QPS 阈值为 4</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141214336.png" alt="image-20210716120900365"></p><p>运行结果：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141214789.png" alt="image-20210716121201630"></p><p>例外项，QPS 阈值为 10</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141214220.png" alt="image-20210716120919131"></p><p>运行结果：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141214516.png" alt="image-20210716121220305"></p><h2 id="_3-隔离和降级" tabindex="-1"><a class="header-anchor" href="#_3-隔离和降级" aria-hidden="true">#</a> 3.隔离和降级</h2><p>限流是一种预防措施，虽然限流可以尽量避免因高并发而引起的服务故障，但服务还会因为其它原因而故障。</p><p>而要将这些故障控制在一定范围，避免雪崩，就要靠<strong>线程隔离</strong>（舱壁模式）和<strong>熔断降级</strong>手段了。</p><p><strong>线程隔离</strong>：调用者在调用服务提供者时，给每个调用的请求分配独立线程池，出现故障时，最多消耗这个线程池内资源，避免把调用者的所有资源耗尽。</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141221266.png" alt="image-20210715173215243"></p><p><strong>熔断降级</strong>：是在调用方这边加入断路器，统计对服务提供者的调用，如果调用的失败比例过高，则熔断该业务，不允许访问该服务的提供者了。</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141221414.png" alt="image-20210715173428073"></p><p>可以看到，不管是线程隔离还是熔断降级，都是对<strong>客户端</strong>（调用方）的保护。需要在<strong>调用方</strong> 发起远程调用时做线程隔离、或者服务熔断。</p><p>而我们的微服务远程调用都是基于 Feign 来完成的，因此我们需要将 Feign 与 Sentinel 整合，在 Feign 里面实现线程隔离和服务熔断。</p><h3 id="_3-1-feignclient-整合-sentinel" tabindex="-1"><a class="header-anchor" href="#_3-1-feignclient-整合-sentinel" aria-hidden="true">#</a> 3.1.FeignClient 整合 Sentinel</h3><p>SpringCloud 中，微服务调用都是通过 Feign 来实现的，因此做客户端保护必须整合 Feign 和 Sentinel。</p><h4 id="_3-1-1-修改配置-开启-sentinel-功能" tabindex="-1"><a class="header-anchor" href="#_3-1-1-修改配置-开启-sentinel-功能" aria-hidden="true">#</a> 3.1.1.修改配置，开启 sentinel 功能</h4><p>修改 OrderService 的 application.yml 文件，开启 Feign 的 Sentinel 功能：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">feign</span><span class="token punctuation">:</span>
  <span class="token key atrule">sentinel</span><span class="token punctuation">:</span>
    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># 开启feign对sentinel的支持</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-1-2-编写失败降级逻辑" tabindex="-1"><a class="header-anchor" href="#_3-1-2-编写失败降级逻辑" aria-hidden="true">#</a> 3.1.2.编写失败降级逻辑</h4><p>业务失败后，不能直接报错，而应该返回用户一个友好提示或者默认结果，这个就是失败降级逻辑。</p><p>给 FeignClient 编写失败后的降级逻辑</p><p>① 方式一：FallbackClass，无法对远程调用的异常做处理</p><p>② 方式二：FallbackFactory，可以对远程调用的异常做处理，我们选择这种</p><p>这里我们演示方式二的失败降级处理。</p><p><strong>步骤一</strong>：在 feing-api 项目中定义类，实现 FallbackFactory：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141222556.png" alt="image-20210716122403502"></p><p>代码：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>itcast<span class="token punctuation">.</span>feign<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>fallback</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>itcast<span class="token punctuation">.</span>feign<span class="token punctuation">.</span>clients<span class="token punctuation">.</span></span><span class="token class-name">UserClient</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>itcast<span class="token punctuation">.</span>feign<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">User</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">feign<span class="token punctuation">.</span>hystrix<span class="token punctuation">.</span></span><span class="token class-name">FallbackFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserClientFallbackFactory</span> <span class="token keyword">implements</span> <span class="token class-name">FallbackFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserClient</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">UserClient</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> throwable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">UserClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;查询用户异常&quot;</span><span class="token punctuation">,</span> throwable<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>步骤二</strong>：在 feing-api 项目中的 DefaultFeignConfiguration 类中将 UserClientFallbackFactory 注册为一个 Bean：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">UserClientFallbackFactory</span> <span class="token function">userClientFallbackFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">UserClientFallbackFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>步骤三</strong>：在 feing-api 项目中的 UserClient 接口中使用 UserClientFallbackFactory：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>itcast<span class="token punctuation">.</span>feign<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>fallback<span class="token punctuation">.</span></span><span class="token class-name">UserClientFallbackFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>itcast<span class="token punctuation">.</span>feign<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">User</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>openfeign<span class="token punctuation">.</span></span><span class="token class-name">FeignClient</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PathVariable</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;userservice&quot;</span><span class="token punctuation">,</span> fallbackFactory <span class="token operator">=</span> <span class="token class-name">UserClientFallbackFactory</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserClient</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/user/{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">User</span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>重启后，访问一次订单查询业务，然后查看 sentinel 控制台，可以看到新的簇点链路：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141222997.png" alt="image-20210716123705780"></p><h4 id="_3-1-3-总结" tabindex="-1"><a class="header-anchor" href="#_3-1-3-总结" aria-hidden="true">#</a> 3.1.3.总结</h4><p>Sentinel 支持的雪崩解决方案：</p><ul><li>线程隔离（仓壁模式）</li><li>降级熔断</li></ul><p>Feign 整合 Sentinel 的步骤：</p><ul><li>在 application.yml 中配置：feign.sentienl.enable=true</li><li>给 FeignClient 编写 FallbackFactory 并注册为 Bean</li><li>将 FallbackFactory 配置到 FeignClient</li></ul><h3 id="_3-2-线程隔离-舱壁模式" tabindex="-1"><a class="header-anchor" href="#_3-2-线程隔离-舱壁模式" aria-hidden="true">#</a> 3.2.线程隔离（舱壁模式）</h3><h4 id="_3-2-1-线程隔离的实现方式" tabindex="-1"><a class="header-anchor" href="#_3-2-1-线程隔离的实现方式" aria-hidden="true">#</a> 3.2.1.线程隔离的实现方式</h4><p>线程隔离有两种方式实现：</p><ul><li><p>线程池隔离</p></li><li><p>信号量隔离（Sentinel 默认采用）</p></li></ul><p>如图：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141222212.png" alt="image-20210716123036937"></p><p><strong>线程池隔离</strong>：给每个服务调用业务分配一个线程池，利用线程池本身实现隔离效果</p><p><strong>信号量隔离</strong>：不创建线程池，而是计数器模式，记录业务使用的线程数量，达到信号量上限时，禁止新的请求。</p><p>两者的优缺点：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141223594.png" alt="image-20210716123240518"></p><h4 id="_3-2-2-sentinel-的线程隔离" tabindex="-1"><a class="header-anchor" href="#_3-2-2-sentinel-的线程隔离" aria-hidden="true">#</a> 3.2.2.sentinel 的线程隔离</h4><p><strong>用法说明</strong>：</p><p>在添加限流规则时，可以选择两种阈值类型：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141223704.png" alt="image-20210716123411217"></p><ul><li><p>QPS：就是每秒的请求数，在快速入门中已经演示过</p></li><li><p>线程数：是该资源能使用用的 tomcat 线程数的最大值。也就是通过限制线程数量，实现<strong>线程隔离</strong>（舱壁模式）。</p></li></ul><p><strong>案例需求</strong>：给 order-service 服务中的 UserClient 的查询用户接口设置流控规则，线程数不能超过 2。然后利用 jemeter 测试。</p><h5 id="_1-配置隔离规则" tabindex="-1"><a class="header-anchor" href="#_1-配置隔离规则" aria-hidden="true">#</a> 1）配置隔离规则</h5><p>选择 feign 接口后面的流控按钮：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141223770.png" alt="image-20210716123831992"></p><p>填写表单：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141223209.png" alt="image-20210716123936844"></p><h5 id="_2-jmeter-测试-2" tabindex="-1"><a class="header-anchor" href="#_2-jmeter-测试-2" aria-hidden="true">#</a> 2）Jmeter 测试</h5><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141223098.png" alt="image-20210716124229894"></p><p>一次发生 10 个请求，有较大概率并发线程数超过 2，而超出的请求会走之前定义的失败降级逻辑。</p><p>查看运行结果：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141224749.png" alt="image-20210716124147820"></p><p>发现虽然结果都是通过了，不过部分请求得到的响应是降级返回的 null 信息。</p><h4 id="_3-2-3-总结" tabindex="-1"><a class="header-anchor" href="#_3-2-3-总结" aria-hidden="true">#</a> 3.2.3.总结</h4><p>线程隔离的两种手段是？</p><ul><li><p>信号量隔离</p></li><li><p>线程池隔离</p></li></ul><p>信号量隔离的特点是？</p><ul><li>基于计数器模式，简单，开销小</li></ul><p>线程池隔离的特点是？</p><ul><li>基于线程池模式，有额外开销，但隔离控制更强</li></ul><h3 id="_3-3-熔断降级" tabindex="-1"><a class="header-anchor" href="#_3-3-熔断降级" aria-hidden="true">#</a> 3.3.熔断降级</h3><p>熔断降级是解决雪崩问题的重要手段。其思路是由<strong>断路器</strong>统计服务调用的异常比例、慢请求比例，如果超出阈值则会<strong>熔断</strong>该服务。即拦截访问该服务的一切请求；而当服务恢复时，断路器会放行访问该服务的请求。</p><p>断路器控制熔断和放行是通过状态机来完成的：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141224020.png" alt="image-20210716130958518"></p><p>状态机包括三个状态：</p><ul><li>closed：关闭状态，断路器放行所有请求，并开始统计异常比例、慢请求比例。超过阈值则切换到 open 状态</li><li>open：打开状态，服务调用被<strong>熔断</strong>，访问被熔断服务的请求会被拒绝，快速失败，直接走降级逻辑。Open 状态 5 秒后会进入 half-open 状态</li><li>half-open：半开状态，放行一次请求，根据执行结果来判断接下来的操作。 <ul><li>请求成功：则切换到 closed 状态</li><li>请求失败：则切换到 open 状态</li></ul></li></ul><p>断路器熔断策略有三种：慢调用、异常比例、异常数</p><h4 id="_3-3-1-慢调用" tabindex="-1"><a class="header-anchor" href="#_3-3-1-慢调用" aria-hidden="true">#</a> 3.3.1.慢调用</h4><p><strong>慢调用</strong>：业务的响应时长（RT）大于指定时长的请求认定为慢调用请求。在指定时间内，如果请求数量超过设定的最小数量，慢调用比例大于设定的阈值，则触发熔断。</p><p>例如：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141224958.png" alt="image-20210716145934347"></p><p>解读：RT 超过 500ms 的调用是慢调用，统计最近 10000ms 内的请求，如果请求量超过 10 次，并且慢调用比例不低于 0.5，则触发熔断，熔断时长为 5 秒。然后进入 half-open 状态，放行一次请求做测试。</p><p><strong>案例:</strong></p><p>需求：给 UserClient 的查询用户接口设置降级规则，慢调用的 RT 阈值为 50ms，统计时间为 1 秒，最小请求数量为 5，失败阈值比例为 0.4，熔断时长为 5</p><h5 id="_1-设置慢调用" tabindex="-1"><a class="header-anchor" href="#_1-设置慢调用" aria-hidden="true">#</a> 1）设置慢调用</h5><p>修改 user-service 中的/user/{id}这个接口的业务。通过休眠模拟一个延迟时间：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141224130.png" alt="image-20210716150234787"></p><p>此时，orderId=101 的订单，关联的是 id 为 1 的用户，调用时长为 60ms：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141224242.png" alt="image-20210716150510956"></p><p>orderId=102 的订单，关联的是 id 为 2 的用户，调用时长为非常短；</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141225369.png" alt="image-20210716150605208"></p><h5 id="_2-设置熔断规则" tabindex="-1"><a class="header-anchor" href="#_2-设置熔断规则" aria-hidden="true">#</a> 2）设置熔断规则</h5><p>下面，给 feign 接口设置降级规则：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141225376.png" alt="image-20210716150654094"></p><p>规则：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141225075.png" alt="image-20210716150740434"></p><p>超过 50ms 的请求都会被认为是慢请求</p><h5 id="_3-测试" tabindex="-1"><a class="header-anchor" href="#_3-测试" aria-hidden="true">#</a> 3）测试</h5><p>在浏览器访问：<a href="http://localhost:8088/order/101" target="_blank" rel="noopener noreferrer">http://localhost:8088/order/101<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>，快速刷新 5 次，可以发现：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141225965.png" alt="image-20210716150911004"></p><p>触发了熔断，请求时长缩短至 5ms，快速失败了，并且走降级逻辑，返回的 null</p><p>在浏览器访问：<a href="http://localhost:8088/order/102" target="_blank" rel="noopener noreferrer">http://localhost:8088/order/102<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>，竟然也被熔断了：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141225173.png" alt="image-20210716151107785"></p><h4 id="_3-3-2-异常比例、异常数" tabindex="-1"><a class="header-anchor" href="#_3-3-2-异常比例、异常数" aria-hidden="true">#</a> 3.3.2.异常比例、异常数</h4><p><strong>异常比例或异常数</strong>：统计指定时间内的调用，如果调用次数超过指定请求数，并且出现异常的比例达到设定的比例阈值（或超过指定异常数），则触发熔断。</p><p>例如，一个异常比例设置：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141225332.png" alt="image-20210716131430682"></p><p>解读：统计最近 1000ms 内的请求，如果请求量超过 10 次，并且异常比例不低于 0.4，则触发熔断。</p><p>一个异常数设置：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141225912.png" alt="image-20210716131522912"></p><p>解读：统计最近 1000ms 内的请求，如果请求量超过 10 次，并且异常比例不低于 2 次，则触发熔断。</p><p><strong>案例:</strong></p><p>需求：给 UserClient 的查询用户接口设置降级规则，统计时间为 1 秒，最小请求数量为 5，失败阈值比例为 0.4，熔断时长为 5s</p><h5 id="_1-设置异常请求" tabindex="-1"><a class="header-anchor" href="#_1-设置异常请求" aria-hidden="true">#</a> 1）设置异常请求</h5><p>首先，修改 user-service 中的/user/{id}这个接口的业务。手动抛出异常，以触发异常比例的熔断：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141226999.png" alt="image-20210716151348183"></p><p>也就是说，id 为 2 时，就会触发异常</p><h5 id="_2-设置熔断规则-1" tabindex="-1"><a class="header-anchor" href="#_2-设置熔断规则-1" aria-hidden="true">#</a> 2）设置熔断规则</h5><p>下面，给 feign 接口设置降级规则：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141226989.png" alt="image-20210716150654094"></p><p>规则：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141226786.png" alt="image-20210716151538785"></p><p>在 5 次请求中，只要异常比例超过 0.4，也就是有 2 次以上的异常，就会触发熔断。</p><h5 id="_3-测试-1" tabindex="-1"><a class="header-anchor" href="#_3-测试-1" aria-hidden="true">#</a> 3）测试</h5><p>在浏览器快速访问：<a href="http://localhost:8088/order/102" target="_blank" rel="noopener noreferrer">http://localhost:8088/order/102<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>，快速刷新 5 次，触发熔断：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141226761.png" alt="image-20210716151722916"></p><p>此时，我们去访问本来应该正常的 103：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141226714.png" alt="image-20210716151844817"></p><h2 id="_4-授权规则" tabindex="-1"><a class="header-anchor" href="#_4-授权规则" aria-hidden="true">#</a> 4.授权规则</h2><p>授权规则可以对请求方来源做判断和控制。</p><h3 id="_4-1-授权规则" tabindex="-1"><a class="header-anchor" href="#_4-1-授权规则" aria-hidden="true">#</a> 4.1.授权规则</h3><h4 id="_4-1-1-基本规则" tabindex="-1"><a class="header-anchor" href="#_4-1-1-基本规则" aria-hidden="true">#</a> 4.1.1.基本规则</h4><p>授权规则可以对调用方的来源做控制，有白名单和黑名单两种方式。</p><ul><li><p>白名单：来源（origin）在白名单内的调用者允许访问</p></li><li><p>黑名单：来源（origin）在黑名单内的调用者不允许访问</p></li></ul><p>点击左侧菜单的授权，可以看到授权规则：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141226995.png" alt="image-20210716152010750"></p><ul><li><p>资源名：就是受保护的资源，例如/order/{orderId}</p></li><li><p>流控应用：是来源者的名单，</p><ul><li>如果是勾选白名单，则名单中的来源被许可访问。</li><li>如果是勾选黑名单，则名单中的来源被禁止访问。</li></ul></li></ul><p>比如：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141226383.png" alt="image-20210716152349191"></p><p>我们允许请求从 gateway 到 order-service，不允许浏览器访问 order-service，那么白名单中就要填写<strong>网关的来源名称（origin）</strong>。</p><h4 id="_4-1-2-如何获取-origin" tabindex="-1"><a class="header-anchor" href="#_4-1-2-如何获取-origin" aria-hidden="true">#</a> 4.1.2.如何获取 origin</h4><p>Sentinel 是通过 RequestOriginParser 这个接口的 parseOrigin 来获取请求的来源的。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">RequestOriginParser</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * 从请求request对象中获取origin，获取方式自定义
     */</span>
    <span class="token class-name">String</span> <span class="token function">parseOrigin</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这个方法的作用就是从 request 对象中，获取请求者的 origin 值并返回。</p><p>默认情况下，sentinel 不管请求者从哪里来，返回值永远是 default，也就是说一切请求的来源都被认为是一样的值 default。</p><p>因此，我们需要自定义这个接口的实现，让<strong>不同的请求，返回不同的 origin</strong>。</p><p>例如 order-service 服务中，我们定义一个 RequestOriginParser 的实现类：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>itcast<span class="token punctuation">.</span>order<span class="token punctuation">.</span>sentinel</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>adapter<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>webmvc<span class="token punctuation">.</span>callback<span class="token punctuation">.</span></span><span class="token class-name">RequestOriginParser</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">StringUtils</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HeaderOriginParser</span> <span class="token keyword">implements</span> <span class="token class-name">RequestOriginParser</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">parseOrigin</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1.获取请求头</span>
        <span class="token class-name">String</span> origin <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token string">&quot;origin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2.非空判断</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>origin<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            origin <span class="token operator">=</span> <span class="token string">&quot;blank&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> origin<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们会尝试从 request-header 中获取 origin 值。</p><h4 id="_4-1-3-给网关添加请求头" tabindex="-1"><a class="header-anchor" href="#_4-1-3-给网关添加请求头" aria-hidden="true">#</a> 4.1.3.给网关添加请求头</h4><p>既然获取请求 origin 的方式是从 reques-header 中获取 origin 值，我们必须让<strong>所有从 gateway 路由到微服务的请求都带上 origin 头</strong>。</p><p>这个需要利用之前学习的一个 GatewayFilter 来实现，AddRequestHeaderGatewayFilter。</p><p>修改 gateway 服务中的 application.yml，添加一个 defaultFilter：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">default-filters</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> AddRequestHeader=origin<span class="token punctuation">,</span>gateway
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
        <span class="token comment"># ...略</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这样，从 gateway 路由的所有请求都会带上 origin 头，值为 gateway。而从其它地方到达微服务的请求则没有这个头。</p><h4 id="_4-1-4-配置授权规则" tabindex="-1"><a class="header-anchor" href="#_4-1-4-配置授权规则" aria-hidden="true">#</a> 4.1.4.配置授权规则</h4><p>接下来，我们添加一个授权规则，放行 origin 值为 gateway 的请求。</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141226703.png" alt="image-20210716153250134"></p><p>配置如下：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141226998.png" alt="image-20210716153301069"></p><p>现在，我们直接跳过网关，访问 order-service 服务：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141226394.png" alt="image-20210716153348396"></p><p>通过网关访问：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141227979.png" alt="image-20210716153434095"></p><h3 id="_4-2-自定义异常结果" tabindex="-1"><a class="header-anchor" href="#_4-2-自定义异常结果" aria-hidden="true">#</a> 4.2.自定义异常结果</h3><p>默认情况下，发生限流、降级、授权拦截时，都会抛出异常到调用方。异常结果都是 flow limmiting（限流）。这样不够友好，无法得知是限流还是降级还是授权拦截。</p><h4 id="_4-2-1-异常类型" tabindex="-1"><a class="header-anchor" href="#_4-2-1-异常类型" aria-hidden="true">#</a> 4.2.1.异常类型</h4><p>而如果要自定义异常时的返回结果，需要实现 BlockExceptionHandler 接口：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">BlockExceptionHandler</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * 处理请求被限流、降级、授权拦截时抛出的异常：BlockException
     */</span>
    <span class="token keyword">void</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">BlockException</span> e<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这个方法有三个参数：</p><ul><li>HttpServletRequest request：request 对象</li><li>HttpServletResponse response：response 对象</li><li>BlockException e：被 sentinel 拦截时抛出的异常</li></ul><p>这里的 BlockException 包含多个不同的子类：</p><table><thead><tr><th><strong>异常</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td>FlowException</td><td>限流异常</td></tr><tr><td>ParamFlowException</td><td>热点参数限流的异常</td></tr><tr><td>DegradeException</td><td>降级异常</td></tr><tr><td>AuthorityException</td><td>授权规则异常</td></tr><tr><td>SystemBlockException</td><td>系统规则异常</td></tr></tbody></table><h4 id="_4-2-2-自定义异常处理" tabindex="-1"><a class="header-anchor" href="#_4-2-2-自定义异常处理" aria-hidden="true">#</a> 4.2.2.自定义异常处理</h4><p>下面，我们就在 order-service 定义一个自定义异常处理类：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>itcast<span class="token punctuation">.</span>order<span class="token punctuation">.</span>sentinel</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>adapter<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>webmvc<span class="token punctuation">.</span>callback<span class="token punctuation">.</span></span><span class="token class-name">BlockExceptionHandler</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>slots<span class="token punctuation">.</span>block<span class="token punctuation">.</span></span><span class="token class-name">BlockException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>slots<span class="token punctuation">.</span>block<span class="token punctuation">.</span>authority<span class="token punctuation">.</span></span><span class="token class-name">AuthorityException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>slots<span class="token punctuation">.</span>block<span class="token punctuation">.</span>degrade<span class="token punctuation">.</span></span><span class="token class-name">DegradeException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>slots<span class="token punctuation">.</span>block<span class="token punctuation">.</span>flow<span class="token punctuation">.</span></span><span class="token class-name">FlowException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>slots<span class="token punctuation">.</span>block<span class="token punctuation">.</span>flow<span class="token punctuation">.</span>param<span class="token punctuation">.</span></span><span class="token class-name">ParamFlowException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletResponse</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SentinelExceptionHandler</span> <span class="token keyword">implements</span> <span class="token class-name">BlockExceptionHandler</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">BlockException</span> e<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> msg <span class="token operator">=</span> <span class="token string">&quot;未知异常&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> status <span class="token operator">=</span> <span class="token number">429</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token keyword">instanceof</span> <span class="token class-name">FlowException</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            msg <span class="token operator">=</span> <span class="token string">&quot;请求被限流了&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token keyword">instanceof</span> <span class="token class-name">ParamFlowException</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            msg <span class="token operator">=</span> <span class="token string">&quot;请求被热点参数限流&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token keyword">instanceof</span> <span class="token class-name">DegradeException</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            msg <span class="token operator">=</span> <span class="token string">&quot;请求被降级了&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token keyword">instanceof</span> <span class="token class-name">AuthorityException</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            msg <span class="token operator">=</span> <span class="token string">&quot;没有权限访问&quot;</span><span class="token punctuation">;</span>
            status <span class="token operator">=</span> <span class="token number">401</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;application/json;charset=utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;{\&quot;msg\&quot;: &quot;</span> <span class="token operator">+</span> msg <span class="token operator">+</span> <span class="token string">&quot;, \&quot;status\&quot;: &quot;</span> <span class="token operator">+</span> status <span class="token operator">+</span> <span class="token string">&quot;}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>重启测试，在不同场景下，会返回不同的异常消息.</p><p>限流：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141227689.png" alt="image-20210716153938887"></p><p>授权拦截时：</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141227696.png" alt="image-20210716154012736"></p><h2 id="_5-规则持久化" tabindex="-1"><a class="header-anchor" href="#_5-规则持久化" aria-hidden="true">#</a> 5.规则持久化</h2><p>现在，sentinel 的所有规则都是内存存储，重启后所有规则都会丢失。在生产环境下，我们必须确保这些规则的持久化，避免丢失。</p><h3 id="_5-1-规则管理模式" tabindex="-1"><a class="header-anchor" href="#_5-1-规则管理模式" aria-hidden="true">#</a> 5.1.规则管理模式</h3><p>规则是否能持久化，取决于规则管理模式，sentinel 支持三种规则管理模式：</p><ul><li>原始模式：Sentinel 的默认模式，将规则保存在内存，重启服务会丢失。</li><li>pull 模式</li><li>push 模式</li></ul><h4 id="_5-1-1-pull-模式" tabindex="-1"><a class="header-anchor" href="#_5-1-1-pull-模式" aria-hidden="true">#</a> 5.1.1.pull 模式</h4><p>pull 模式：控制台将配置的规则推送到 Sentinel 客户端，而客户端会将配置规则保存在本地文件或数据库中。以后会定时去本地文件或数据库中查询，更新本地规则。</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141227429.png" alt="image-20210716154155238"></p><h4 id="_5-1-2-push-模式" tabindex="-1"><a class="header-anchor" href="#_5-1-2-push-模式" aria-hidden="true">#</a> 5.1.2.push 模式</h4><p>push 模式：控制台将配置规则推送到远程配置中心，例如 Nacos。Sentinel 客户端监听 Nacos，获取配置变更的推送消息，完成本地配置更新。</p><p><img src="https://gcore.jsdelivr.net/gh/SurplusFate/guide_img@main/img/202211141227501.png" alt="image-20210716154215456"></p><h3 id="_5-2-实现-push-模式" tabindex="-1"><a class="header-anchor" href="#_5-2-实现-push-模式" aria-hidden="true">#</a> 5.2.实现 push 模式</h3><p><a href="https://surplusfate.github.io/docs/%E5%B0%8F%E8%AE%B0/sentinel%20%E8%A7%84%E5%88%99%E6%8C%81%E4%B9%85%E5%8C%96.html" target="_blank" rel="noopener noreferrer">Sentinel 规则持久化 | 空~ (surplusfate.github.io)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/SurplusFate/SurplusFate.github.io/edit/main/src/docs/Spring 系列/SpringCloud/34. 微服务保护.md" rel="noopener noreferrer" target="_blank" aria-label="编辑此页" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item update-time"><span class="label">上次编辑于: </span><!----></div><!----></footer><nav class="page-nav"><a href="/docs/Spring%20%E7%B3%BB%E5%88%97/SpringCloud/33.%20%E9%9B%86%E7%BE%A4.html" class="nav-link prev" aria-label="33. 集群"><div class="hint"><span class="arrow left"></span>上一页</div><div class="link"><span class="icon iconfont icon-note"></span>33. 集群</div></a><!----></nav><!----><!----><!--]--></main><!--]--><!----><!--]--></div><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app.d6d367fd.js" defer></script>
  </body>
</html>
