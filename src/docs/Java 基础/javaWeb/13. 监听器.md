---
icon: note
date: 2022-08-29
order: 13
category:
  - JavaWeb
---

# 13. 监听器

监听器 Listener 就是在 application，session，request 三个对象创建，销毁，或者往其中添加修改删除属性时自动执行代码的功能组件。Listener 是 Servlet 的监听器，可以监听客户端的请求，服务端的操作等。

- 编写一个监听器

  实现监听器的接口

```java
//统计网站在线人数 ： 统计session
public class OnlineCountListener implements HttpSessionListener {

    //创建session监听： 看你的一举一动
    //一旦创建Session就会触发一次这个事件！
    public void sessionCreated(HttpSessionEvent se) {
        ServletContext ctx = se.getSession().getServletContext();

        System.out.println(se.getSession().getId());

        Integer onlineCount = (Integer) ctx.getAttribute("OnlineCount");

        if (onlineCount==null){
            onlineCount = new Integer(1);
        }else {
            int count = onlineCount.intValue();
            onlineCount = new Integer(count+1);
        }

        ctx.setAttribute("OnlineCount",onlineCount);

    }

    //销毁session监听
    //一旦销毁Session就会触发一次这个事件！
    public void sessionDestroyed(HttpSessionEvent se) {
        ServletContext ctx = se.getSession().getServletContext();

        Integer onlineCount = (Integer) ctx.getAttribute("OnlineCount");

        if (onlineCount==null){
            onlineCount = new Integer(0);
        }else {
            int count = onlineCount.intValue();
            onlineCount = new Integer(count-1);
        }

        ctx.setAttribute("OnlineCount",onlineCount);

    }
```

Session销毁：

>    1. 手动销毁  getSession().invalidate();
>    2. 自动销毁

- web.xml 中注册监听器

   ```xml
   <!--注册监听器-->
   <listener>
   <listener-class>com.kuang.listener.OnlineCountListener</listener-class>
   </listener>
   ```
